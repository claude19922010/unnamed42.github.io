<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>BUG研发中心</title>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://unnamed42.github.io/"/>
  <updated>2017-03-16T13:45:15.000Z</updated>
  <id>https://unnamed42.github.io/</id>
  
  <author>
    <name>Dr. A. Clef</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>中国政治坐标系测试（北大未名版）</title>
    <link href="https://unnamed42.github.io/2017-03-16-%E4%B8%AD%E5%9B%BD%E6%94%BF%E6%B2%BB%E5%9D%90%E6%A0%87%E7%B3%BB%E6%B5%8B%E8%AF%95.html"/>
    <id>https://unnamed42.github.io/2017-03-16-中国政治坐标系测试.html</id>
    <published>2017-03-16T13:12:46.000Z</published>
    <updated>2017-03-16T13:45:15.000Z</updated>
    
    <content type="html"><![CDATA[<p>本测试转载自政治坐标测试北大未名版之<a href="http://www.zuobiao.me/zuobiao2015/index.php/survey/index" target="_blank" rel="external">中国政治坐标系测试</a>。可惜的是，原网站似乎已经被干掉了，因此该测试的题目及数据处理逻辑源自<a href="http://www.mwjx.com/mwjx/iq_tests/tests_politics.html" target="_blank" rel="external">另一个网站</a>。</p><a id="more"></a><hr><script type="text/javascript">$(function(){$("#submit").click(function(){var t=0,a=0,n=0;$('#questions input[name^="c"]:checked').each(function(){t+=parseInt($(this).attr("data-x")),a+=parseInt($(this).attr("data-y")),n+=parseInt($(this).attr("data-z"))}),t=Math.round(t)/20,a=Math.round(a)/20,n=Math.round(n)/10,$("#answer").html("政治立场坐标（左翼<->右翼）"+t+"，经济立场坐标（左翼<->右翼）"+a+"，文化立场坐标（保守<->自由）"+n)})})</script><style>.red{color:red}#wrapper{text-align:center}</style><p>以下测试模仿著名的英文“<a href="https://www.politicalcompass.org/test" target="_blank" rel="external">政治指南针</a>”测试建立。题目经北大未名BBS读书版网友集体讨论创作，版权属于北大未名BBS读书版及相关网友。本blog对该测试的准确性及所造成的一切后果不负责。测试结果不能作为任何学术研究的依据。题目的陈述本身不代表出题人看法。本测试为匿名，本网站不收集任何测试者个人信息。</p><p>本测试的目的是反映答题者政治、经济与社会观念“左与右”的坐标。本测试系统建立于中国政治价值体系基础之上，试图充分反映中国的特殊国情与政治文化。很多问题反映的并非严格意义上的西方政治语汇中的“左右”，而是中国现实语境中的“左右”。测试题目的陈述尽量满足中立性，即，每条陈述都不存在严格意义上的对错，同意或反对都代表彼此平等的看法。<span class="red">请注意，这套题目的目的是区分理念而不是操作手法，也就是说，问题在于你在理想中是否支持，而不是在现实困难面前是否可行。请不要因为具体条件的缺乏而去设想种种复杂背景情况，从而动摇自己意识形态上的坚持。如果犹豫不定，请选择自己的第一直觉。</span></p><p>题目共五十道，必须全部回答。选项中没有中立项，这是为了迫使你选出你心里的倾向而不是回避你不愿意考虑的问题。</p><form id="questions"><ol><li>如果人民没有受过民主教育，他们是不应该拥有普选权的。<br><input name="c1" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c1" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c1" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c1" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>令人沮丧的是，经济学家越来越成为富人的代言人。<br><input name="c2" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c2" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c2" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c2" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>人权高于主权。<br><input name="c3" type="radio" data-x="-2" data-y="0" data-z="0" checked>强烈反对<br><input name="c3" type="radio" data-x="-1" data-y="0" data-z="0">反对<br><input name="c3" type="radio" data-x="1" data-y="0" data-z="0">同意<br><input name="c3" type="radio" data-x="2" data-y="0" data-z="0">强烈同意<br></li><li>不应指责两个成年人自愿的婚前性行为。<br><input name="c4" type="radio" data-x="0" data-y="0" data-z="-2" checked>强烈反对<br><input name="c4" type="radio" data-x="0" data-y="0" data-z="-1">反对<br><input name="c4" type="radio" data-x="0" data-y="0" data-z="1">同意<br><input name="c4" type="radio" data-x="0" data-y="0" data-z="2">强烈同意<br></li><li>中国近年来经济发展的成果很多都被一小群人占有了，大多数人没得到什么好处。<br><input name="c5" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c5" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c5" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c5" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>发生重大社会安全事件时，即使认为信息公开会导致骚乱的风险，政府仍应该开放信息传播。<br><input name="c6" type="radio" data-x="-2" data-y="0" data-z="0" checked>强烈反对<br><input name="c6" type="radio" data-x="-1" data-y="0" data-z="0">反对<br><input name="c6" type="radio" data-x="1" data-y="0" data-z="0">同意<br><input name="c6" type="radio" data-x="2" data-y="0" data-z="0">强烈同意<br></li><li>在重大工程项目的决策中，个人利益应该为社会利益让路。<br><input name="c7" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c7" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c7" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c7" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>西方的多党制不适合中国国情。<br><input name="c8" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c8" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c8" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c8" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>不应当谈论或者在公开的文字中记录自己的长辈的缺点。<br><input name="c9" type="radio" data-x="0" data-y="0" data-z="2" checked>强烈反对<br><input name="c9" type="radio" data-x="0" data-y="0" data-z="1">反对<br><input name="c9" type="radio" data-x="0" data-y="0" data-z="-1">同意<br><input name="c9" type="radio" data-x="0" data-y="0" data-z="-2">强烈同意<br></li><li>浪费粮食也是个人的自由。<br><input name="c10" type="radio" data-x="0" data-y="-2" data-z="0" checked>强烈反对<br><input name="c10" type="radio" data-x="0" data-y="-1" data-z="0">反对<br><input name="c10" type="radio" data-x="0" data-y="1" data-z="0">同意<br><input name="c10" type="radio" data-x="0" data-y="2" data-z="0">强烈同意<br></li><li>在中国照搬西方式的言论自由会导致社会失序。<br><input name="c11" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c11" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c11" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c11" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>现代中国社会需要儒家思想。<br><input name="c12" type="radio" data-x="0" data-y="0" data-z="2" checked>强烈反对<br><input name="c12" type="radio" data-x="0" data-y="0" data-z="1">反对<br><input name="c12" type="radio" data-x="0" data-y="0" data-z="-1">同意<br><input name="c12" type="radio" data-x="0" data-y="0" data-z="-2">强烈同意<br></li><li>为保障社会公平，对富人征税应采用更高的税率。<br><input name="c13" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c13" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c13" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c13" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>由高校自主考试招生比全国统一考试招生更好。<br><input name="c14" type="radio" data-x="-2" data-y="0" data-z="0" checked>强烈反对<br><input name="c14" type="radio" data-x="-1" data-y="0" data-z="0">反对<br><input name="c14" type="radio" data-x="1" data-y="0" data-z="0">同意<br><input name="c14" type="radio" data-x="2" data-y="0" data-z="0">强烈同意<br></li><li>应当对国外同类产品征收高额关税来保护国内民族工业。<br><input name="c15" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c15" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c15" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c15" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>应该容许宗教人士在非宗教场所公开传教。<br><input name="c16" type="radio" data-x="-2" data-y="0" data-z="0" checked>强烈反对<br><input name="c16" type="radio" data-x="-1" data-y="0" data-z="0">反对<br><input name="c16" type="radio" data-x="1" data-y="0" data-z="0">同意<br><input name="c16" type="radio" data-x="2" data-y="0" data-z="0">强烈同意<br></li><li>任何艺术作品，只要有很多人愿意花钱去欣赏，就不能说它毫无艺术价值。<br><input name="c17" type="radio" data-x="0" data-y="0" data-z="-2" checked>强烈反对<br><input name="c17" type="radio" data-x="0" data-y="0" data-z="-1">反对<br><input name="c17" type="radio" data-x="0" data-y="0" data-z="1">同意<br><input name="c17" type="radio" data-x="0" data-y="0" data-z="2">强烈同意<br></li><li>在华外国资本应该受到限制，不能任意发展。<br><input name="c18" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c18" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c18" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c18" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>无论中小学生或大学生，都应参加由国家统一安排的军训。<br><input name="c19" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c19" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c19" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c19" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>集体财产比私有财产更应当保护。<br><input name="c20" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c20" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c20" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c20" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>试图控制房地产价格的行为是不可行的，会破坏经济发展，给社会带来危害。<br><input name="c21" type="radio" data-x="0" data-y="-2" data-z="0" checked>强烈反对<br><input name="c21" type="radio" data-x="0" data-y="-1" data-z="0">反对<br><input name="c21" type="radio" data-x="0" data-y="1" data-z="0">同意<br><input name="c21" type="radio" data-x="0" data-y="2" data-z="0">强烈同意<br></li><li>国家的统一和领土完整是社会的最高利益。<br><input name="c22" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c22" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c22" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c22" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>改善低收入者生活的首要手段是国家给予财政补贴和扶持。<br><input name="c23" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c23" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c23" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c23" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>以美国为首的西方国家不可能真正容许中国崛起成为一流强国。<br><input name="c24" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c24" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c24" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c24" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>个人有权利决定自己要不要孩子，要几个孩子。<br><input name="c25" type="radio" data-x="0" data-y="0" data-z="-2" checked>强烈反对<br><input name="c25" type="radio" data-x="0" data-y="0" data-z="-1">反对<br><input name="c25" type="radio" data-x="0" data-y="0" data-z="1">同意<br><input name="c25" type="radio" data-x="0" data-y="0" data-z="2">强烈同意<br></li><li>即使会导致国有资产的减少，国有企业也不应该在市场竞争中享有特殊的保护。<br><input name="c26" type="radio" data-x="0" data-y="-2" data-z="0" checked>强烈反对<br><input name="c26" type="radio" data-x="0" data-y="-1" data-z="0">反对<br><input name="c26" type="radio" data-x="0" data-y="1" data-z="0">同意<br><input name="c26" type="radio" data-x="0" data-y="2" data-z="0">强烈同意<br></li><li>应当保证代表全体人民利益的官方新闻机构的存在。<br><input name="c27" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c27" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c27" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c27" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>高收入者应该公开自己的经济来源。<br><input name="c28" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c28" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c28" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c28" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>国家领导人的形象可以出现在漫画中。<br><input name="c29" type="radio" data-x="-2" data-y="0" data-z="0" checked>强烈反对<br><input name="c29" type="radio" data-x="-1" data-y="0" data-z="0">反对<br><input name="c29" type="radio" data-x="1" data-y="0" data-z="0">同意<br><input name="c29" type="radio" data-x="2" data-y="0" data-z="0">强烈同意<br></li><li>周易八卦是老祖宗智慧的结晶，能够有效的解释很多事情。<br><input name="c30" type="radio" data-x="0" data-y="0" data-z="2" checked>强烈反对<br><input name="c30" type="radio" data-x="0" data-y="0" data-z="1">反对<br><input name="c30" type="radio" data-x="0" data-y="0" data-z="-1">同意<br><input name="c30" type="radio" data-x="0" data-y="0" data-z="-2">强烈同意<br></li><li>劫富济贫是行侠仗义。<br><input name="c31" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c31" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c31" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c31" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>当法律未能充分制止罪恶行为时，通过极端手段对犯罪进行制裁是可以容忍的。<br><input name="c32" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c32" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c32" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c32" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>中国传统医学具有一些现代主流医学不能比拟的优势。<br><input name="c33" type="radio" data-x="0" data-y="0" data-z="2" checked>强烈反对<br><input name="c33" type="radio" data-x="0" data-y="0" data-z="1">反对<br><input name="c33" type="radio" data-x="0" data-y="0" data-z="-1">同意<br><input name="c33" type="radio" data-x="0" data-y="0" data-z="-2">强烈同意<br></li><li>与其让公有制企业亏损破产，不如转卖给资本家。<br><input name="c34" type="radio" data-x="0" data-y="-2" data-z="0" checked>强烈反对<br><input name="c34" type="radio" data-x="0" data-y="-1" data-z="0">反对<br><input name="c34" type="radio" data-x="0" data-y="1" data-z="0">同意<br><input name="c34" type="radio" data-x="0" data-y="2" data-z="0">强烈同意<br></li><li>国家没有义务进行对外援助。<br><input name="c35" type="radio" data-x="-2" data-y="0" data-z="0" checked>强烈反对<br><input name="c35" type="radio" data-x="-1" data-y="0" data-z="0">反对<br><input name="c35" type="radio" data-x="1" data-y="0" data-z="0">同意<br><input name="c35" type="radio" data-x="2" data-y="0" data-z="0">强烈同意<br></li><li>以及其他重要国计民生的领域，必须全部由国有企业掌控。<br><input name="c36" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c36" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c36" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c36" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>如果国家综合实力许可，那么中国有权为了维护自己的利益而采取任何行动。<br><input name="c37" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c37" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c37" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c37" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>电视机构应当尽量制作格调高雅的节目，而不是只追求高收视率。<br><input name="c38" type="radio" data-x="0" data-y="0" data-z="2" checked>强烈反对<br><input name="c38" type="radio" data-x="0" data-y="0" data-z="1">反对<br><input name="c38" type="radio" data-x="0" data-y="0" data-z="-1">同意<br><input name="c38" type="radio" data-x="0" data-y="0" data-z="-2">强烈同意<br></li><li>资本积累的过程总是伴随着对普通劳动人民利益的伤害。<br><input name="c39" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c39" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c39" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c39" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>条件允许的话应该武力攻台，台独者死不足惜。<br><input name="c40" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c40" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c40" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c40" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>将传统文化的经典作品作为儿童的主要读物是值得称赞的。<br><input name="c41" type="radio" data-x="0" data-y="0" data-z="2" checked>强烈反对<br><input name="c41" type="radio" data-x="0" data-y="0" data-z="1">反对<br><input name="c41" type="radio" data-x="0" data-y="0" data-z="-1">同意<br><input name="c41" type="radio" data-x="0" data-y="0" data-z="-2">强烈同意<br></li><li>即使中国的市场经济出现危机或萧条，也不应当考虑退回计划经济体制。<br><input name="c42" type="radio" data-x="0" data-y="-2" data-z="0" checked>强烈反对<br><input name="c42" type="radio" data-x="0" data-y="-1" data-z="0">反对<br><input name="c42" type="radio" data-x="0" data-y="1" data-z="0">同意<br><input name="c42" type="radio" data-x="0" data-y="2" data-z="0">强烈同意<br></li><li>军队应当国家化。<br><input name="c43" type="radio" data-x="-2" data-y="0" data-z="0" checked>强烈反对<br><input name="c43" type="radio" data-x="-1" data-y="0" data-z="0">反对<br><input name="c43" type="radio" data-x="1" data-y="0" data-z="0">同意<br><input name="c43" type="radio" data-x="2" data-y="0" data-z="0">强烈同意<br></li><li>政府应当提高粮食收购价格以增加农民收入。<br><input name="c44" type="radio" data-x="0" data-y="2" data-z="0" checked>强烈反对<br><input name="c44" type="radio" data-x="0" data-y="1" data-z="0">反对<br><input name="c44" type="radio" data-x="0" data-y="-1" data-z="0">同意<br><input name="c44" type="radio" data-x="0" data-y="-2" data-z="0">强烈同意<br></li><li>应该允许公民在获得外国国籍之后依然保留中国国籍。<br><input name="c45" type="radio" data-x="-2" data-y="0" data-z="0" checked>强烈反对<br><input name="c45" type="radio" data-x="-1" data-y="0" data-z="0">反对<br><input name="c45" type="radio" data-x="1" data-y="0" data-z="0">同意<br><input name="c45" type="radio" data-x="2" data-y="0" data-z="0">强烈同意<br></li><li>同性恋对社会没有危害，人们应该接纳同性恋者。<br><input name="c46" type="radio" data-x="0" data-y="0" data-z="-2" checked>强烈反对<br><input name="c46" type="radio" data-x="0" data-y="0" data-z="-1">反对<br><input name="c46" type="radio" data-x="0" data-y="0" data-z="1">同意<br><input name="c46" type="radio" data-x="0" data-y="0" data-z="2">强烈同意<br></li><li>能在国际市场上买到的先进科技产品，我们没必要自行研制。<br><input name="c47" type="radio" data-x="0" data-y="-2" data-z="0" checked>强烈反对<br><input name="c47" type="radio" data-x="0" data-y="-1" data-z="0">反对<br><input name="c47" type="radio" data-x="0" data-y="1" data-z="0">同意<br><input name="c47" type="radio" data-x="0" data-y="2" data-z="0">强烈同意<br></li><li>哪怕经历了违反程序规定的审讯和取证过程，罪大恶极的人也应被处以死刑。<br><input name="c48" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c48" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c48" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c48" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li><li>政府不应当干预猪肉价格。<br><input name="c49" type="radio" data-x="0" data-y="-2" data-z="0" checked>强烈反对<br><input name="c49" type="radio" data-x="0" data-y="-1" data-z="0">反对<br><input name="c49" type="radio" data-x="0" data-y="1" data-z="0">同意<br><input name="c49" type="radio" data-x="0" data-y="2" data-z="0">强烈同意<br></li><li>国家应当采取措施培养和支持体育健儿在各种国际比赛场合为国争光。<br><input name="c50" type="radio" data-x="2" data-y="0" data-z="0" checked>强烈反对<br><input name="c50" type="radio" data-x="1" data-y="0" data-z="0">反对<br><input name="c50" type="radio" data-x="-1" data-y="0" data-z="0">同意<br><input name="c50" type="radio" data-x="-2" data-y="0" data-z="0">强烈同意<br></li></ol></form><div id="wrapper"><button id="submit" type="button" class="button button-inverse button-rounded">提交</button><br><span id="answer" class="red"></span></div><hr><p>X坐标反映政治观念，负值为左(<a href="https://en.wikipedia.org/wiki/Authoritarianism" target="_blank" rel="external">独裁主义</a>)，正值为右(<a href="https://en.wikipedia.org/wiki/Libertarianism" target="_blank" rel="external">自由意志主义</a>)。<br>Y坐标反映经济观念，负值为左(<a href="https://en.wikipedia.org/wiki/Communism" target="_blank" rel="external">共产主义</a>, <a href="https://en.wikipedia.org/wiki/Collectivism" target="_blank" rel="external">集体主义</a>)，正值为右(<a href="https://en.wikipedia.org/wiki/Neoliberalism" target="_blank" rel="external">新自由主义</a>)。<br>Z坐标反映社会文化观念，负值为<a href="https://en.wikipedia.org/wiki/Conservatism" target="_blank" rel="external">保守主义</a>，正值为<a href="https://en.wikipedia.org/wiki/Liberalism" target="_blank" rel="external">自由主义</a>。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本测试转载自政治坐标测试北大未名版之&lt;a href=&quot;http://www.zuobiao.me/zuobiao2015/index.php/survey/index&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;中国政治坐标系测试&lt;/a&gt;。可惜的是，原网站似乎已经被干掉了，因此该测试的题目及数据处理逻辑源自&lt;a href=&quot;http://www.mwjx.com/mwjx/iq_tests/tests_politics.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;另一个网站&lt;/a&gt;。&lt;/p&gt;
    
    </summary>
    
      <category term="杂项" scheme="https://unnamed42.github.io/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="测试" scheme="https://unnamed42.github.io/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>基于Github Issue的博客评论系统</title>
    <link href="https://unnamed42.github.io/2017-02-20-%E5%9F%BA%E4%BA%8EGithub-Issue%E7%9A%84%E5%8D%9A%E5%AE%A2%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F.html"/>
    <id>https://unnamed42.github.io/2017-02-20-基于Github-Issue的博客评论系统.html</id>
    <published>2017-02-20T08:24:30.000Z</published>
    <updated>2017-02-20T10:02:11.000Z</updated>
    
    <content type="html"><![CDATA[<p>Testing now</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Testing now&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>Hexo折腾笔记</title>
    <link href="https://unnamed42.github.io/2016-09-10-Hexo%E6%8A%98%E8%85%BE%E7%AC%94%E8%AE%B0.html"/>
    <id>https://unnamed42.github.io/2016-09-10-Hexo折腾笔记.html</id>
    <published>2016-09-10T13:14:06.000Z</published>
    <updated>2017-04-22T13:44:02.000Z</updated>
    
    <content type="html"><![CDATA[<p>身为一名预备程序员，对于自己使用的工具自然要有折腾的欲望。从今年<sup class="footnote-ref"><a href="#fn1" id="fnref1">[1]</a></sup>七八月以来，就一直在想着如何折腾折腾Hexo. 再加上很喜欢<a href="https://mufeng.me/wordpress-mobile-theme-kunkka.html" target="_blank" rel="external">Kunkka</a>（其Github源已404，估计被作者自己删除了）这个Wordpress的主题，想着把它移植到Hexo上来。就在这里记载一下碰到的问题和解决方案吧。</p><p>UPDATE 2016/10/28: 修改了部分用词</p><a id="more"></a><h2 id="主题的创建">主题的创建</h2><p>方便起见，我在主题中插入了<a href="https://jquery.com/" target="_blank" rel="external">jQuery</a>和<a href="http://fontawesome.io/" target="_blank" rel="external">FontAwesome</a>. 实际上，没有这两样我浑身难受。</p><h3 id="主题模板引擎">主题模板引擎</h3><p>Hexo主要提供了三款模板引擎，分别是<a href="http://www.embeddedjs.com/" target="_blank" rel="external">EJS</a>, <a href="https://naltatis.github.io/jade-syntax-docs/" target="_blank" rel="external">Jade</a>(现名<a href="https://pugjs.org/api/getting-started.html" target="_blank" rel="external">Pug</a>), <a href="http://www.swig.org/" target="_blank" rel="external">Swig</a>.</p><p>我个人看来，Jade代码结构优雅（和Python一样，不优雅不让跑），但是代码结构和HTML文档相去甚远，非常不直观。这也就意味着，要使用它不光要学习HTML, 还得特别地去学习Jade语法。而且据我本人少量的测试而言，Jade的主题和EJS的主题相比生成速度慢了几倍。EJS duang的一下就生成完了，Jade你还能在终端里看着它慢慢地一行一行的输出生成了xxx文件。</p><p>而EJS和Swig两个相比，在我使用的功能上我感觉不出什么差别。两个都和世界上最好的语言<sup class="footnote-ref"><a href="#fn2" id="fnref2">[2]</a></sup>一样，动态生成的部分穿插在HTML当中。不过，Swig在npm上已经没人维护了。</p><p>我本人使用的是EJS, 它脚本部分全盘使用Javascript语法，生成快，学起来也快，而且在之前有<ruby>改进<rp>(</rp><rt>xiā gǎi</rt><rp>)</rp></ruby><a href="https://github.com/unnamed42/hexo-theme-Anisina" target="_blank" rel="external">Anisina</a>的经验（它是用EJS写的）。最最重要的是，我使用的文本编辑器<a href="https://kate-editor.org/" target="_blank" rel="external">Kate</a>有它的高亮文件。这一点非常非常非常重要。</p><h3 id="主题css预处理器">主题CSS预处理器</h3><p>Hexo 所支持的CSS预处理器有<a href="http://sass-lang.com/" target="_blank" rel="external">Sass</a>, <a href="http://stylus-lang.com/" target="_blank" rel="external">Stylus</a>, <a href="http://lesscss.org/" target="_blank" rel="external">Less</a>三款。另两个我没用过，不过Stylus功能绝对够多够强，够用了。</p><p>你要是不嫌麻烦，也可以不使用预处理器，直接莽原生CSS也是可以的。</p><h3 id="主题结构">主题结构</h3><p>这些在Hexo的文档(<a href="https://hexo.io/docs/themes.html" target="_blank" rel="external">Theme</a>, <a href="https://hexo.io/docs/templates.html" target="_blank" rel="external">Template</a>)里都有描写，虽然不是很详细，但也够用了。</p><h2 id="hexo主题相关">Hexo主题相关</h2><h3 id="回到顶部-按钮">“回到顶部”按钮</h3><h4 id="按钮样式">按钮样式</h4><p>刚开始我是仿自<a href="https://github.com/tufu9441/maupassant-hexo" target="_blank" rel="external">Maupassant</a>使用一个小按钮来实现“回到顶部”，而且当滚动到一定位置时才出现。</p><p>这一个按钮由以下部分组成：</p><figure class="highlight plain"><figcaption><span>totop.ejs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;totop&quot; class&gt;</div><div class="line">    &lt;button class=&quot;button button-square button-small&quot; title=&lt;%- __(&apos;to_top&apos;)%&gt;&gt;&lt;i class=&quot;fa fa-chevron-up&quot;&gt;&lt;/i&gt;&lt;/button&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure><p><code>button</code>, <code>button-square</code>, <code>button-small</code>是我引自<a href="http://www.bootcss.com/p/buttons/" target="_blank" rel="external">BUTTONS</a>的按钮样式（感谢<a href="https://github.com/MaoKwen" target="_blank" rel="external">@maokwen</a>的推荐），你也可以使用其他的按钮样式。</p><figure class="highlight css"><figcaption><span>totop.css</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#totop</span> &#123;</div><div class="line">  <span class="attribute">position</span>: fixed;</div><div class="line">  <span class="attribute">bottom</span>: <span class="number">50px</span>;</div><div class="line">  <span class="attribute">right</span>: <span class="number">50px</span>;</div><div class="line">  <span class="attribute">display</span>: block;</div><div class="line">  <span class="attribute">visibility</span>: hidden;</div><div class="line">  <span class="attribute">opacity</span>: <span class="number">0</span>;</div><div class="line">  <span class="attribute">-webkit-transition</span>: visibility <span class="number">0.2s</span>, opacity <span class="number">0.2s</span> linear;</div><div class="line">     <span class="attribute">-moz-transition</span>: visibility <span class="number">0.2s</span>, opacity <span class="number">0.2s</span> linear;</div><div class="line">          <span class="attribute">transition</span>: visibility <span class="number">0.2s</span>, opacity <span class="number">0.2s</span> linear;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#totop</span><span class="selector-class">.display</span> &#123;</div><div class="line">  <span class="attribute">visibility</span>: visible;</div><div class="line">  <span class="attribute">opacity</span>: <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight js"><figcaption><span>totop.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">$</span>) </span>&#123; </div><div class="line"><span class="comment">// When to show the scroll link</span></div><div class="line"><span class="comment">// higher number = scroll link appears further down the page   </span></div><div class="line"><span class="keyword">var</span> upperLimit = <span class="number">500</span>;</div><div class="line"></div><div class="line"><span class="comment">// Our scroll link element</span></div><div class="line"><span class="keyword">var</span> scrollElem = $(<span class="string">'#totop'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Scroll to top speed</span></div><div class="line"><span class="keyword">var</span> scrollSpeed = <span class="number">500</span>;</div><div class="line"></div><div class="line"><span class="comment">// Show and hide the scroll to top link based on scroll position   </span></div><div class="line">$(<span class="built_in">window</span>).scroll(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> ( $(<span class="built_in">document</span>).scrollTop() &gt; upperLimit ) &#123;</div><div class="line">        $(scrollElem).addClass(<span class="string">"display"</span>); <span class="comment">// fade back in           </span></div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        $(scrollElem).removeClass(<span class="string">"display"</span>); <span class="comment">// fade out</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">// Scroll to top animation on click</span></div><div class="line">$(scrollElem).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $(<span class="string">'html, body'</span>).animate(&#123;<span class="attr">scrollTop</span>:<span class="number">0</span>&#125;, scrollSpeed); <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">&#125;);</div><div class="line">&#125;)(jQuery);</div></pre></td></tr></table></figure><p>将其插入到合适的地方即可。</p><h4 id="百分比样式">百分比样式</h4><p>后来看见了lijiancheng0614的<a href="https://lijiancheng0614.github.io/2015/08/15/2015_08_15_Migrate_to_Hexo/#%E6%B7%BB%E5%8A%A0gotop" target="_blank" rel="external">百分比样式</a>，我感觉它更强，于是换用了这个。</p><p>这个按钮是一个圆形按钮，并且有一个实时更新的圆形进度条显示你当前阅读进度。虽然功能更强，但代码量更大，性能损耗更多。具体如何取舍看你自己了。</p><figure class="highlight plain"><figcaption><span>totop.ejs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div id=&quot;backtoTop&quot; data-action=&quot;gototop&quot; title=&quot;&lt;%- __(&apos;to_top&apos;) %&gt;&quot;&gt;</div><div class="line">    &lt;canvas id=&quot;backtoTopCanvas&quot; width=&quot;48&quot; height=&quot;48&quot;&gt;&lt;/canvas&gt;</div><div class="line">    &lt;div class=&quot;percentage&quot;&gt;&lt;/div&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure><figure class="highlight stylus"><figcaption><span>totop.styl</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="number">#bac</span>ktoTop &#123;</div><div class="line">    <span class="attribute">background-color</span>: <span class="number">#eee</span>;</div><div class="line">    <span class="attribute">border-radius</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">bottom</span>: <span class="number">5%</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">48px</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">48px</span>;</div><div class="line">    <span class="attribute">position</span>: fixed;</div><div class="line">    <span class="attribute">right</span>: -<span class="number">100px</span>;</div><div class="line">    <span class="attribute">z-index</span>: <span class="number">99</span>;</div><div class="line">    -webkit-<span class="attribute">transition</span>: <span class="number">0.5s</span>;</div><div class="line">       -moz-<span class="attribute">transition</span>: <span class="number">0.5s</span>;</div><div class="line">            <span class="attribute">transition</span>: <span class="number">0.5s</span>;</div><div class="line">    &amp;<span class="selector-class">.display</span> &#123;<span class="attribute">right</span>: <span class="number">10px</span>;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.percentage</span> &#123;</div><div class="line">    <span class="attribute">font-size</span>: <span class="number">16px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">48px</span>;</div><div class="line">    <span class="attribute">line-height</span>: <span class="number">48px</span>;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">text-align</span>: center;</div><div class="line">    <span class="attribute">top</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">48px</span>;</div><div class="line">    <span class="attribute">color</span>: <span class="number">#555</span>;</div><div class="line">    <span class="attribute">cursor</span>: pointer;</div><div class="line">    &amp;:before &#123;<span class="attribute">content</span>:attr(data-percent);&#125;</div><div class="line"><span class="comment">/*    &amp;:hover:before &#123;</span></div><div class="line">        display: inline-block;</div><div class="line">        font: normal normal normal 14px/1 FontAwesome;</div><div class="line">        font-size: inherit;</div><div class="line">        text-rendering: auto;</div><div class="line">        -webkit-font-smoothing: antialiased;</div><div class="line">        -moz-osx-font-smoothing: grayscale;</div><div class="line">        content: "\f176";</div><div class="line">    &#125;*/</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>被注释内容和下面<code>totop.js</code>最后的<code>hover()</code>不能同时用。如果上面的注释取消掉的话，下面的<code>hover()</code>就得整个删掉。其实两个的效果是相同的，都是在触发按钮的<code>hover</code>事件时给它改成图标。</p><figure class="highlight js"><figcaption><span>totop.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> bigfa_scroll = &#123;</div><div class="line">    <span class="attr">drawCircle</span>: <span class="function"><span class="keyword">function</span>(<span class="params">id, percentage, color</span>) </span>&#123;</div><div class="line">        <span class="keyword">var</span> width = $(id).width();</div><div class="line">        <span class="keyword">var</span> height = $(id).height();</div><div class="line">        <span class="keyword">var</span> radius = <span class="built_in">parseInt</span>(width / <span class="number">2.20</span>);</div><div class="line">        <span class="keyword">var</span> position = width;</div><div class="line">        <span class="keyword">var</span> positionBy2 = position / <span class="number">2</span>;</div><div class="line">        <span class="keyword">var</span> bg = $(id)[<span class="number">0</span>];</div><div class="line">        id = id.split(<span class="string">"#"</span>);</div><div class="line">        <span class="keyword">var</span> ctx = bg.getContext(<span class="string">"2d"</span>);</div><div class="line">        <span class="keyword">var</span> imd = <span class="literal">null</span>;</div><div class="line">        <span class="keyword">var</span> circ = <span class="built_in">Math</span>.PI * <span class="number">2</span>;</div><div class="line">        <span class="keyword">var</span> quart = <span class="built_in">Math</span>.PI / <span class="number">2</span>;</div><div class="line">        ctx.clearRect(<span class="number">0</span>, <span class="number">0</span>, width, height);</div><div class="line">        ctx.beginPath();</div><div class="line">        ctx.strokeStyle = color;</div><div class="line">        ctx.lineCap = <span class="string">"square"</span>;</div><div class="line">        ctx.closePath();</div><div class="line">        ctx.fill();</div><div class="line">        ctx.lineWidth = <span class="number">3</span>;</div><div class="line">        imd = ctx.getImageData(<span class="number">0</span>, <span class="number">0</span>, position, position);</div><div class="line">        <span class="keyword">var</span> draw = <span class="function"><span class="keyword">function</span>(<span class="params">current, ctxPass</span>) </span>&#123;</div><div class="line">            ctxPass.putImageData(imd, <span class="number">0</span>, <span class="number">0</span>);</div><div class="line">            ctxPass.beginPath();</div><div class="line">            ctxPass.arc(positionBy2, positionBy2, radius, -(quart), ((circ) * current) - quart, <span class="literal">false</span>);</div><div class="line">            ctxPass.stroke();</div><div class="line">        &#125;</div><div class="line">        draw(percentage / <span class="number">100</span>, ctx);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">backToTop</span>: <span class="function"><span class="keyword">function</span>(<span class="params">$this</span>) </span>&#123;</div><div class="line">        $<span class="keyword">this</span>.click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            $(<span class="string">"body,html"</span>).animate(&#123;</div><div class="line">                <span class="attr">scrollTop</span>: <span class="number">0</span></div><div class="line">            &#125;,</div><div class="line">            <span class="number">800</span>);</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        &#125;);</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">scrollHook</span>: <span class="function"><span class="keyword">function</span>(<span class="params">$this, color</span>) </span>&#123;</div><div class="line">        color = color ? color: <span class="string">"#000000"</span>;</div><div class="line">        $<span class="keyword">this</span>.scroll(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">var</span> docHeight = ($(<span class="built_in">document</span>).height() - $(<span class="built_in">window</span>).height()),</div><div class="line">            $windowObj = $<span class="keyword">this</span>,</div><div class="line">            $per = $(<span class="string">".percentage"</span>),</div><div class="line">            percentage = <span class="number">0</span>;</div><div class="line">            defaultScroll = $windowObj.scrollTop();</div><div class="line">            percentage = <span class="built_in">parseInt</span>((defaultScroll / docHeight) * <span class="number">100</span>);</div><div class="line">            <span class="keyword">var</span> backToTop = $(<span class="string">"#backtoTop"</span>);</div><div class="line">            <span class="keyword">if</span> (backToTop.length &gt; <span class="number">0</span>) &#123;</div><div class="line">                <span class="keyword">if</span> ($windowObj.scrollTop() &gt; <span class="number">200</span>) &#123;</div><div class="line">                    backToTop.addClass(<span class="string">"display"</span>);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    backToTop.removeClass(<span class="string">"display"</span>);</div><div class="line">                &#125;</div><div class="line">                $per.attr(<span class="string">"data-percent"</span>, percentage);</div><div class="line">                bigfa_scroll.drawCircle(<span class="string">"#backtoTopCanvas"</span>, percentage, color);</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> T = bigfa_scroll,</div><div class="line">        totop = $(<span class="string">"#backtoTop"</span>),</div><div class="line">        percent = totop.children(<span class="string">".percentage"</span>);</div><div class="line">    T.backToTop(totop);</div><div class="line">    T.scrollHook($(<span class="built_in">window</span>), <span class="string">"#99ccff"</span>);</div><div class="line">    percent.hover(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        percent.addClass(<span class="string">"fa-long-arrow-up"</span>);</div><div class="line">        percent.css(&#123;<span class="string">"font-family"</span>:<span class="string">"FontAwesome"</span>&#125;);</div><div class="line">    &#125;,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        percent.removeClass(<span class="string">"fa-long-arrow-up"</span>);</div><div class="line">        percent.removeAttr(<span class="string">"style"</span>);</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>将其插入到合适的地方即可。</p><h3 id="目录样式">目录样式</h3><p>首先，来探索Hexo自带helper<code>toc()</code>生成的目录的HTML（该部分目录摘自我的博客<a href="https://unnamed42.github.io/2016-06-22-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86-%E6%A0%88.html">二叉树的遍历-栈</a>）：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"toc"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-2"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#直接遍历算法"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>直接遍历算法<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"toc-child "</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-3"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#有关约定"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>有关约定<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-3"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#使用系统栈"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>使用系统栈<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"toc-child "</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#前序遍历"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>前序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#中序遍历"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>中序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#后序遍历"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>后序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-3"</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#使用自定义栈"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>使用自定义栈<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"toc-child "</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#前序遍历-v2"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>前序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#中序遍历-v2"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>中序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-4"</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#后序遍历-v2"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>后序遍历<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"toc-child"</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"toc-item toc-level-5"</span>&gt;</span></div><div class="line">                                <span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"toc-link"</span> <span class="attr">href</span>=<span class="string">"#仙术"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"toc-text"</span>&gt;</span>仙术<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                        <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">ol</span>&gt;</span></div></pre></td></tr></table></figure><p>分层非常明显。每个链接的目的地就是对应的heading, heading的id就是链接地址去掉<code>#</code>. 各个markdown渲染器生成的结果虽然会有些许不同，但链接和id一定是对应的（Hexo的<code>toc()</code>就是根据heading的id来生成目录的，不对应的话要么没有目录，要么链接目的地是<code>undefined</code>）。</p><p>除此之外，还可以给目录做个外层包装。在本主题中，目录被包裹在<code>&lt;div id=&quot;toc&quot;&gt;&lt;/div&gt;</code>内。</p><p>我给目录定下了几个样式上的目标：</p><ol><li><p>跟随页面滚动</p></li><li><p>当滚动到某个标题时，目录的对应链接要被高亮。</p></li></ol><p>跟随页面滚动这个比较好做，保持<code>position: fixed</code>然后设置好<code>left</code>/<code>right</code>, <code>top</code>/<code>bottom</code>就好。但是仍然会有些许问题，比如滚动到文章底部时目录还能继续向下跟随移动，而且<code>top</code>无法自适应变化(在本主题中，导航栏高55px, 目录希望距离顶部35px因此<code>top</code>的初值是90px. 而90px的<code>top</code>滚动到文章区时无疑太大了)。像这样动态设置位置，只能依赖脚本。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> toc = $(<span class="string">"#toc"</span>), post = $(<span class="string">".post-body"</span>);</div><div class="line">    <span class="keyword">var</span> post_height = post.position().top + post.outerHeight(),</div><div class="line">        toc_height = toc.height(),</div><div class="line">        pos_max = post_height - toc_height;</div><div class="line">    $(<span class="built_in">window</span>).scroll(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> scroll_top = $(<span class="built_in">window</span>).scrollTop();</div><div class="line">        toc.css(<span class="string">"top"</span>, scroll_top&lt;<span class="number">55</span>? <span class="number">90</span>-scroll_top: (pos_max&gt;scroll_top? <span class="number">35</span>: pos_max-scroll_top));</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>其中，<code>post-body</code>是包裹文章的<code>div</code>, <code>post_height</code>就是文章区域底部的位置。使用这段脚本，就可以解决问题1了。</p><p>问题2的解决就比较麻烦了，好在有别的插件可用。经过我一番搜寻，实现了类似于Bootstrap里<code>scrollspy()</code>类似功能的轮子不少，但是没几个能用的（也许是我不会用？）。在Github上面的那几个（<a href="https://github.com/r3plica/Scrollspy" target="_blank" rel="external">r3plica/Scrollspy</a>, <a href="https://github.com/thesmart/jquery-scrollspy" target="_blank" rel="external">thesmart/jquery-scrollspy</a>, <a href="https://github.com/softwarespot/jquery-scrollspy" target="_blank" rel="external">softwarespot/jquery-scrollspy</a>, <a href="https://github.com/sxalexander/jquery-scrollspy" target="_blank" rel="external">sxalexander/jquery-scrollspy</a>）都没有起效；而<a href="https://github.com/jgallen23/toc" target="_blank" rel="external">jgallen23/toc</a>虽然有点小bug但也能用，不过最大的问题是，它的目录是附送的代码动态生成的，我要是配合它还得改css. 出于一种懒人的心态，我没有去用它。最终，我还是屈服于Bootstrap的淫威之下。</p><p>在代码里插入Bootstrap的<a href="http://getbootstrap.com/javascript/#scrollspy" target="_blank" rel="external">scrollspy.js</a>, 然后写这么一段脚本：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $(<span class="string">"#toc ol"</span>).addClass(<span class="string">"nav"</span>);</div><div class="line">    $(<span class="string">"body"</span>).scrollspy(&#123;<span class="attr">target</span>:<span class="string">"#toc"</span><span class="comment">/* ,offset:40 */</span>&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>注释里那段是可选的，加与不加随意。而添加<code>nav</code>这个class, 是因为目前的Bootstrap使用<code>scrollspy()</code>的时候要求目标有<code>nav</code>这个class, 在开发中的v4版Bootstrap就没有这个要求了。使用这个之后，滚动到对应标题，目录里的链接以及它的上级标题的链接会添加一个<code>active</code>的class, 退出这段区域时删除class. 可以据此设置高亮。</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#toc</span> &#123;</div><div class="line">    <span class="attribute">line-height</span>: <span class="number">1em</span>;</div><div class="line">    <span class="attribute">position</span>: fixed;</div><div class="line">    <span class="attribute">right</span>: <span class="number">5%</span>;</div><div class="line">    <span class="attribute">width</span>: <span class="number">20%</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">90%</span>;</div><div class="line">    <span class="attribute">top</span>: <span class="number">90px</span>;</div><div class="line">    <span class="attribute">overflow</span>: hidden;</div><div class="line">&#125;</div><div class="line"><span class="keyword">for</span> <span class="selector-tag">i</span> <span class="keyword">in</span> (<span class="number">1</span>..<span class="number">6</span>) &#123;</div><div class="line">    .toc-level-&#123;i&#125; <span class="selector-class">.toc-text</span> &#123;<span class="attribute">margin-left</span>: i em;&#125;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.toc-text</span> &#123;<span class="attribute">white-space</span>: nowrap;&#125;</div><div class="line"><span class="selector-class">.toc-link</span> &#123;</div><div class="line">    <span class="attribute">color</span>: <span class="number">#999</span>;</div><div class="line">    <span class="attribute">display</span>: inline-block; <span class="comment">// stretch to parent height</span></div><div class="line">    &amp;:hover &#123;<span class="attribute">text-decoration</span>: none;&#125;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.toc</span> &#123;</div><div class="line">    <span class="attribute">padding</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">line-height</span>: <span class="number">1.8em</span>;</div><div class="line">    <span class="attribute">overflow</span>: auto;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">100%</span>;</div><div class="line">    <span class="selector-tag">li</span> &#123;<span class="attribute">list-style-type</span>: none;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.toc-child</span> &#123;</div><div class="line">    <span class="attribute">margin-left</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">padding-left</span>: <span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(hexo-config(<span class="string">'toc.collapse'</span>)) &#123;<span class="attribute">display</span>: none;&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.toc-item</span> &#123;</div><div class="line">    &amp;:hover &gt; <span class="selector-class">.toc-link</span> &#123;<span class="attribute">border-left</span>: <span class="number">1px</span> solid <span class="variable">$color</span>-theme;&#125;</div><div class="line">    &amp;<span class="selector-class">.active</span> &#123;</div><div class="line">        &gt; <span class="selector-class">.toc-link</span> &#123;</div><div class="line">            <span class="attribute">color</span>: <span class="variable">$color</span>-theme;</div><div class="line">            <span class="attribute">border-left</span>: <span class="number">2px</span> solid <span class="variable">$color</span>-theme;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>我是仿照Bootstrap官网的目录做的样式。要注意层级缩进的时候要使用<code>margin-left</code>, 如果使用<code>padding-left</code>那么被高亮时左边边框无法对齐。<code>$color-theme</code>填一个你喜欢的颜色即可。</p><p>如果还想把它打扮成没高亮的目录不显示，再加上下面这段：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#toc</span> <span class="selector-class">.toc-item</span> &#123;</div><div class="line">    <span class="selector-class">.toc-child</span> &#123;<span class="attribute">display</span>: none;&#125;</div><div class="line">    &amp;<span class="selector-class">.active</span> <span class="selector-class">.toc-child</span> &#123;<span class="attribute">display</span>: block;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>大功告成。</p><h3 id="脚注样式">脚注样式</h3><p>由于默认渲染器<code>hexo-renderer-marked</code>不支持footnote语法，所以为了使用脚注，必须将markdown渲染器换到<code>hexo-renderer-markdown-it</code>, 并开启<code>markdown-it</code>插件。</p><p>其使用方式就是</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Test [^1]</div><div class="line">[<span class="symbol">^1</span>]: <span class="link">Footnote</span></div></pre></td></tr></table></figure><p>生成对应的html文档是</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Test</div><div class="line">    <span class="tag">&lt;<span class="name">sup</span> <span class="attr">class</span>=<span class="string">"footnote-ref"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#fn1"</span> <span class="attr">id</span>=<span class="string">"fnref1"</span>&gt;</span>[1]<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">sup</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">hr</span> <span class="attr">class</span>=<span class="string">"footnotes-sep"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">section</span> <span class="attr">class</span>=<span class="string">"footnotes"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">ol</span> <span class="attr">class</span>=<span class="string">"footnotes-list"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">id</span>=<span class="string">"fn1"</span> <span class="attr">class</span>=<span class="string">"footnote-item"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span>Footnote <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#fnref1"</span> <span class="attr">class</span>=<span class="string">"footnote-backref"</span>&gt;</span>↩<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">ol</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">section</span>&gt;</span></div></pre></td></tr></table></figure><p>然而这样的话，要看脚注就要跳来跳去地看，比较影响正常的阅读。在我在网上苦苦寻求了一阵之后，我看到了一个<a href="http://tympanus.net/codrops/2014/10/07/tooltip-styles-inspiration/" target="_blank" rel="external">很酷炫的tooltip样式</a>（你们可以上<a href="http://tympanus.net/Development/TooltipStylesInspiration/" target="_blank" rel="external">Demo</a>来感受一下），因此我决定把脚注改成这个样子的。</p><p>既然都是这种样式的了那后面的脚注内容（分割线<code>footnotes-sep</code>和脚注内容<code>footnotes</code>）都不需要了。首先上样式表：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.footnotes-sep</span>, <span class="selector-class">.footnotes</span> &#123;<span class="attribute">display</span>: none;&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Style from https://github.com/codrops/TooltipStylesInspiration */</span></div><div class="line"><span class="selector-class">.footnote-ref</span> &#123;</div><div class="line">    <span class="attribute">vertical-align</span>: super;</div><div class="line">    <span class="attribute">font-size</span>: smaller;</div><div class="line">    <span class="attribute">display</span>: inline;</div><div class="line">    <span class="attribute">position</span>: relative;</div><div class="line">    &amp;<span class="selector-class">.active</span> &#123;</div><div class="line">        <span class="selector-tag">a</span>:after &#123; <span class="attribute">pointer-events</span>: auto;&#125;</div><div class="line">        <span class="selector-class">.fn-content</span> &#123;</div><div class="line">            <span class="attribute">pointer-events</span>: auto;</div><div class="line">            <span class="attribute">opacity</span>: <span class="number">1</span>;</div><div class="line">            -webkit-<span class="attribute">transform</span>: translate3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>) rotate3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">            <span class="attribute">transform</span>: translate3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>) rotate3d(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    &gt; <span class="selector-tag">a</span> &#123;</div><div class="line">        <span class="attribute">cursor</span>: pointer;</div><div class="line">        <span class="attribute">display</span>: inline-block;</div><div class="line">        <span class="attribute">font-weight</span>: <span class="number">700</span>;</div><div class="line">        &amp;:after &#123;</div><div class="line">            <span class="attribute">content</span>: <span class="string">''</span>;</div><div class="line">            <span class="attribute">position</span>: absolute;</div><div class="line">            <span class="attribute">width</span>: <span class="number">360px</span>;</div><div class="line">            <span class="attribute">height</span>: <span class="number">20px</span>;</div><div class="line">            <span class="attribute">bottom</span>: <span class="number">100%</span>;</div><div class="line">            <span class="attribute">left</span>: <span class="number">50%</span>;</div><div class="line">            <span class="attribute">pointer-events</span>: none;</div><div class="line">            -webkit-<span class="attribute">transform</span>: translateX(-<span class="number">50%</span>);</div><div class="line">            <span class="attribute">transform</span>: translateX(-<span class="number">50%</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.fn-content</span> &#123;</div><div class="line">    <span class="attribute">position</span>: absolute;</div><div class="line">    <span class="attribute">display</span>: inline-block;</div><div class="line">    <span class="attribute">z-index</span>: <span class="number">14</span>;</div><div class="line">    <span class="attribute">left</span>: <span class="number">50%</span>;</div><div class="line">    <span class="attribute">margin</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">20px</span>;</div><div class="line">    <span class="attribute">bottom</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">line-height</span>: <span class="number">1.4</span>;</div><div class="line">    <span class="attribute">box-shadow</span>: -<span class="number">5px</span> -<span class="number">5px</span> <span class="number">15px</span> rgba(<span class="number">48</span>,<span class="number">54</span>,<span class="number">61</span>,<span class="number">0.2</span>);</div><div class="line">    <span class="attribute">border-radius</span>: <span class="number">0.5em</span>;</div><div class="line">    <span class="attribute">background</span>: <span class="number">#2a3035</span>;</div><div class="line">    <span class="attribute">opacity</span>: <span class="number">0</span>;</div><div class="line">    <span class="attribute">pointer-events</span>: none;</div><div class="line">    -webkit-<span class="attribute">transform</span>: translate3d(<span class="number">0</span>,-<span class="number">10px</span>,<span class="number">0</span>);</div><div class="line">    <span class="attribute">transform</span>: translate3d(<span class="number">0</span>,-<span class="number">10px</span>,<span class="number">0</span>);</div><div class="line">    -webkit-<span class="attribute">transition</span>: opacity <span class="number">0.3s</span>, -webkit-transform <span class="number">0.3s</span>;</div><div class="line">    <span class="attribute">transition</span>: opacity <span class="number">0.3s</span>, transform <span class="number">0.3s</span>;</div><div class="line">    <span class="comment">/* Arrow */</span></div><div class="line">    &amp;:after &#123;</div><div class="line">        <span class="attribute">content</span>: <span class="string">''</span>;</div><div class="line">        <span class="attribute">top</span>: <span class="number">100%</span>;</div><div class="line">        <span class="attribute">left</span>: <span class="number">50%</span>;</div><div class="line">        <span class="attribute">border</span>: solid transparent;</div><div class="line">        <span class="attribute">height</span>: <span class="number">0</span>;</div><div class="line">        <span class="attribute">width</span>: <span class="number">0</span>;</div><div class="line">        <span class="attribute">position</span>: absolute;</div><div class="line">        <span class="attribute">pointer-events</span>: none;</div><div class="line">        <span class="attribute">border-color</span>: transparent;</div><div class="line">        <span class="attribute">border-top-color</span>: <span class="number">#2a3035</span>;</div><div class="line">        <span class="attribute">border-width</span>: <span class="number">10px</span>;</div><div class="line">        <span class="attribute">margin-left</span>: -<span class="number">10px</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="selector-class">.fn-text</span> &#123;</div><div class="line">        <span class="attribute">line-height</span>: <span class="number">1.35</span>;</div><div class="line">        <span class="attribute">display</span>: inline-block;</div><div class="line">        <span class="attribute">padding</span>: <span class="number">1.31em</span> <span class="number">1.21em</span> <span class="number">0</span>;</div><div class="line">        <span class="attribute">font-size</span>: <span class="number">14.5px</span>;</div><div class="line">        <span class="attribute">color</span>: <span class="number">#fff</span>;</div><div class="line">        <span class="attribute">z-index</span>: <span class="number">8</span>;</div><div class="line">        <span class="selector-tag">a</span> &#123;<span class="attribute">font-weight</span>: bold;&#125;</div><div class="line">        <span class="comment">/* p &#123;margin-bottom: 0;&#125;*/</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>首先我们得生成我们需要的html, 改markdown渲染器代码虽然一劳永逸，但太麻烦了，我们可以使用jQuery来生成tooltip的代码：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $(<span class="string">".footnote-ref"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> id = $(<span class="keyword">this</span>).children(<span class="string">"a"</span>).attr(<span class="string">"href"</span>).substr(<span class="number">1</span>),</div><div class="line">            footnote = $(<span class="built_in">document</span>.getElementById(id)),</div><div class="line">            outer_wrapper = $(<span class="string">"&lt;span&gt;"</span>,&#123;<span class="string">"class"</span>:<span class="string">"fn-content"</span>&#125;),</div><div class="line">            inner_wrapper = $(<span class="string">"&lt;span&gt;"</span>,&#123;<span class="string">"class"</span>:<span class="string">"fn-text"</span>&#125;);</div><div class="line">        footnote.find(<span class="string">".footnote-backref"</span>).remove();</div><div class="line">        $(<span class="keyword">this</span>).append(outer_wrapper.append(inner_wrapper.html(footnote.html())));</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p><code>footnote-backref</code>是脚注部分返回的小图标，放在脚注tooltip里绝对不好看，也不合理。因此，我选择干掉它。</p><p>其实上面的样式和原来的相比，差了<code>width</code>和<code>margin-left</code>两个，这两个我准备用js来动态调整。由于脚注文字有多有少，直接统一一个很大的<code>width</code>对于文字少的来说有一大片空白，相当不好看，而且在手机上会溢出屏幕。而<code>margin-left</code>应该为<code>width</code>一半的负值，来保证tooltip处于脚注链接的正上方。如果改了<code>width</code>的话，<code>margin-left</code>也要跟着改变。</p><p>其实对于文字少的来说，外层<code>span</code>的<code>width</code>不会变，但内层<code>span</code>的<code>width</code>是会跟着文字量改变的。据此我们不用自己计算<code>width</code>, 等浏览器绘制完毕直接把这个值拿来用就行。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> position = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> content = $(<span class="string">".fn-content"</span>).removeAttr(<span class="string">"style"</span>);</div><div class="line">        <span class="keyword">if</span>($(<span class="built_in">window</span>).width() &lt; <span class="number">640</span>)</div><div class="line">            content.css(<span class="string">"width"</span>,$(<span class="built_in">window</span>).width()/<span class="number">2</span>);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            content.css(<span class="string">"width"</span>,<span class="number">340</span>); <span class="comment">// default value</span></div><div class="line">        content.each(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">            <span class="keyword">var</span> width = $(<span class="keyword">this</span>).children(<span class="string">".fn-text"</span>).outerWidth();</div><div class="line">            $(<span class="keyword">this</span>).css(&#123;</div><div class="line">                <span class="string">"width"</span>: width,</div><div class="line">                <span class="string">"margin-left"</span>: width/<span class="number">-2</span></div><div class="line">            &#125;);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">    position();</div><div class="line">    $(<span class="built_in">window</span>).resize(position());</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>因为要根据屏幕大小确定<code>width</code>初始值，所以这个函数不光在<code>document</code>加载完毕后要执行，<code>window</code>改变大小的时候也要跟着执行。</p><p>解决完了样式的事情我们再来解决显示的事情。我希望的是点击脚注链接它要显示，再次点击时消失，点击别处也要消失（包括点击其他的脚注链接）。因此不能用<code>$(&quot;.footnote-ref&quot;).click()</code>来实现，而要通过整个<code>document</code>的点击事件来实现。这个点击的判断我们可以直接摘抄<a href="https://stackoverflow.com/a/2364639" target="_blank" rel="external">Stack Overflow</a>:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $(<span class="built_in">document</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params">t</span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> target = $(<span class="string">".fn-content"</span>),</div><div class="line">            clicked = $(t.target);</div><div class="line">        <span class="keyword">if</span>(target.is(clicked) || target.has(clicked).length != <span class="number">0</span>)</div><div class="line">            t.stopPropagation();</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">var</span> parent = clicked.parents(<span class="string">".footnote-ref"</span>),</div><div class="line">                active = $(<span class="string">".footnote-ref.active"</span>);</div><div class="line">            <span class="keyword">if</span>(!active.is(parent))</div><div class="line">                active.removeClass(<span class="string">"active"</span>);</div><div class="line">            <span class="keyword">if</span>(!parent.length)&#123;</div><div class="line">                parent.hasClass(active)?parent.removeClass(<span class="string">"active"</span>):parent.addClass(<span class="string">"active"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>将以上几段js合体（假设你放到的是<code>js/footnote.js</code>），插入到有脚注的页面即可。可以使用这个简单的Hexo插件来实现，也可以简单粗暴地在所有页面都插入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">hexo.extend.filter.register(<span class="string">'after_post_render'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(data.content.indexOf(<span class="string">"#fn"</span>) != <span class="number">-1</span>)&#123;</div><div class="line">        data.content += <span class="string">"&lt;script src=\"js/footnote.js\" type=\"text/javascript\"&gt;&lt;/script&gt;"</span>;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="keyword">return</span> data;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>其实还有别的脚注tooltip化方案，比如<a href="http://www.bigfootjs.com/" target="_blank" rel="external">bigfoot.js</a>或者是<a href="http://syeong.jcsg.com/2012/07/07/footnote-tooltips/" target="_blank" rel="external">这篇博客</a>介绍的方案，但是前者体积太大。后者我看着感觉不错。</p><h3 id="在js插件中访问设置">在js插件中访问设置</h3><p>使用<code>hexo.config</code>来访问站点设置，<code>hexo.theme.config</code>来访问主题设置。</p><h3 id="根据设置生成css">根据设置生成CSS</h3><p>在Stylus里使用<code>hexo-config(entry)</code>能获取<strong>主题设置</strong>里的<code>entry</code>条目内容。可以使用这个功能根据设置生成不同的CSS, 而不用预先给你的<code>&lt;div&gt;</code>设置上好几个<code>class</code>来调整外观。</p><p><code>hexo-config</code>的定义在<a href="https://github.com/hexojs/hexo-renderer-stylus/" target="_blank" rel="external"><code>hexo-renderer-stylus</code></a>里如下：</p><figure class="highlight js"><figcaption><span>https://github.com/hexojs/hexo-renderer-stylus/blob/master/lib/renderer.js</span></figcaption><table><tr><td class="gutter"><pre><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">defineConfig</span>(<span class="params">style</span>) </span>&#123;</div><div class="line">  style.define(<span class="string">'hexo-config'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> getProperty(self.theme.config, data.val);</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="自定义页面生成">自定义页面生成</h3><p>将下面的js放到主题文件夹下的<code>scripts</code>文件夹里，文件名随意。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">"use strict"</span>;</div><div class="line"></div><div class="line">hexo.extend.generator.register(some_name,<span class="function"><span class="keyword">function</span>(<span class="params">locals</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">path</span>: page_path,</div><div class="line">        <span class="attr">data</span>: &#123;&#125;,</div><div class="line">        <span class="attr">layout</span>: page_layout</div><div class="line">    &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>细节解释如下：</p><ul><li><code>some_name</code>是一个<code>String</code>, 原则上这个名字可以随便填。但是Hexo自己已经占用了<code>asset</code>, <code>page</code>, <code>post</code>这三个，所以除此之外都可以。</li><li><code>data</code>代表除页面模板之外的页面内容。<strong>并非字符串</strong>。</li><li><code>page_path</code>是一个<code>String</code>, 内容应该是该网页相对根的路径，不包含代表根目录的<code>/</code>.</li><li><code>page_layout</code>是<code>String</code>或<code>String</code>的<code>Array</code>, 代表该页面使用的<code>layout</code>.</li></ul><p>示例，比如我要想生成404页面（已经写好了<code>404.ejs</code>）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">hexo.extend.generator.register(<span class="string">'_404'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">locals</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> &#123;</div><div class="line">        <span class="attr">path</span>: <span class="string">'404.html'</span>,</div><div class="line">        <span class="attr">data</span>: &#123;&#125;,</div><div class="line">        <span class="attr">layout</span>: [<span class="string">'404'</span>,<span class="string">'layout'</span>]</div><div class="line">    &#125;;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>这样Hexo就会根据<code>layout/404.ejs</code>的模板在网站根目录下生成<code>404.html</code>. 如果找不到<code>404.ejs</code>的话，就会转而使用<code>layout.ejs</code>模板。</p><p>还可以同时生成多个页面：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">hexo.extend.generator.register(some_name,<span class="function"><span class="keyword">function</span>(<span class="params">locals</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> [</div><div class="line">        &#123;<span class="attr">path</span>: page_path1,<span class="attr">data</span>: &#123;&#125;,<span class="attr">layout</span>: page_layout1&#125;,</div><div class="line">        &#123;<span class="attr">path</span>: page_path2,<span class="attr">data</span>: &#123;&#125;,<span class="attr">layout</span>: page_layout2&#125;,</div><div class="line">        &#123;<span class="attr">path</span>: page_path3,<span class="attr">data</span>: &#123;&#125;,<span class="attr">layout</span>: page_layout3&#125;</div><div class="line">    ];</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>这样做的好处就是，举例来说，不需要用户自己去写一个<code>404.md</code>来使用404页面，自动就能生成。</p><h3 id="选择性生成css或js">选择性生成css或js</h3><p>比如，我在主题的<code>source/js</code>文件夹下放了<code>duoshuo.min.js</code>这个多说本地化脚本，当设置里没启用多说的时候这个js文件还是会跟着生成。该怎么办呢？</p><p>把如下js放进主题的<code>scripts</code>文件夹下（文件名随意）：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">'use strict'</span>;</div><div class="line"></div><div class="line">hexo.extend.filter.register(<span class="string">'after_generate'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> duoshuo = hexo.theme.config.duoshuo_shortname;</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(!duoshuo || duoshuo.length == <span class="number">0</span>)&#123;</div><div class="line">        hexo.route.remove(<span class="string">'js/duoshuo.min.js'</span>);</div><div class="line">    &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>其中<code>duoshuo_shortname</code>是主题设置里的一个条目。</p><p>这样，当<code>duoshuo_shortname</code>为空时，<code>duoshuo.min.js</code>不会跟着生成，从而减少所需加载量。</p><h3 id="html分块">HTML分块</h3><p>你可以将经常变动，而使用又非常频繁的部分单独拿出来，使用<a href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%A1%B5%E9%9D%A2%E7%94%9F%E6%88%90">上面提到的技巧</a>生成一个单独的页面，使用jQuery来加载它。</p><p>以我的主题为例，“最近文章”这个插件属于侧边栏，而侧边栏几乎在每个页面里面都有。每当post有哪怕一个很小的改动，“最近文章”就需要更新，导致侧边栏内容需要重新生成，进而导致所有的页面全部重新生成。将它单独拿出来，就可以避免这一情况发生。</p><p>首先，生成一个单独的页面<code>/components/recent-posts.html</code>.</p><figure class="highlight plain"><figcaption><span>recent_posts.ejs</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">---</div><div class="line">layout: none</div><div class="line">---</div><div class="line">&lt;% if (site.posts.length)&#123; %&gt;</div><div class="line">    &lt;h3&gt;&lt;%= __(&apos;recent_posts&apos;) %&gt;&lt;/h3&gt;</div><div class="line">    &lt;ul class=&quot;list&quot;&gt;</div><div class="line">        &lt;% site.posts.sort(&apos;updated&apos;, -1).limit(8).each(function(post)&#123; %&gt;</div><div class="line">        &lt;li&gt;</div><div class="line">            &lt;p&gt;&lt;a href=&quot;&lt;%- url_for(post.path) %&gt;&quot; class=&quot;tooltipped tooltipped-n&quot; aria-label=&quot;&lt;%= post.title || __(&apos;untitled&apos;) %&gt;&quot;&gt;&lt;%= truncate(post.title || __(&apos;untitled&apos;),&#123;length: 23,omission:&quot;...&quot;&#125;) %&gt;&lt;/a&gt;&lt;/p&gt;</div><div class="line">            &lt;p&gt;&lt;%= __(&apos;updated&apos;) + __(&apos;:&apos;) %&gt;</div><div class="line">            &lt;span class=&quot;update-time&quot;&gt;&lt;%= post.updated.format(&apos;YYYY-MM-D h:m a&apos;) %&gt;&lt;/span&gt;&lt;/p&gt;</div><div class="line">        &lt;/li&gt;</div><div class="line">        &lt;% &#125;) %&gt;</div><div class="line">    &lt;/ul&gt;</div><div class="line">&lt;% &#125; %&gt;</div></pre></td></tr></table></figure><p>里面的<code>layout: none</code>非常关键，因为我们只想要这一个部分而不是一个完整的网页。</p><p>此时插入这个插件就不能使用<code>&lt;%- partial('_widget/recent_posts') %&gt;</code>来插入，而是使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;!-- Something before --&gt;</div><div class="line">&lt;% if (site.posts.length)&#123; %&gt;</div><div class="line">&lt;div class=&quot;widget recent-posts&quot;&gt;&lt;/div&gt;</div><div class="line">&lt;% &#125; %&gt;</div><div class="line">&lt;!-- Something after --&gt;</div></pre></td></tr></table></figure><p>并且插入这样一段脚本：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $(<span class="string">".widget.recent_posts"</span>).load(<span class="string">"/components/recent-posts.html"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><p>如果还想对html做点什么修改的话，改成：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    $(<span class="string">".widget.recent_posts"</span>).load(<span class="string">"/components/recent-posts.html"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">response,status</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(status === <span class="string">"success"</span>)&#123;</div><div class="line">            <span class="comment">// something</span></div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure><h2 id="hexo插件使用">Hexo插件使用</h2><h3 id="hexo-generator-search">hexo-generator-search</h3><p>一个基于jQuery的本地搜索插件。它本身不提供搜索功能，它所做的只是生成博客内所有页面的索引。该插件提供的搜索内容相当于Hexo生成阶段的<code>post.content</code>. 在<a href="http://hahack.com/codes/local-search-engine-for-hexo/" target="_blank" rel="external">作者博客</a>那边的代码里有个小错误，它会导致搜索返回的匹配字符串异常地长。</p><p>既然我都把这个单独拿出来了那肯定就要做一点自己的改进了。作者提供的代码是直接去掉所有html tag再搜索，但有一点缺陷，就是存放在<code>&lt;script&gt;</code>和<code>&lt;style&gt;</code>里的内容也会被算进搜索范围内，还有就是代码高亮的行号也会被算在内。针对这一点，我们在搜索之前利用jQuery干掉这些内容：</p><p>默认情况下，Hexo的行号是静态生成好的，而且被<code>&lt;td class=&quot;gutter&quot;&gt;</code>包着。删去<code>$(&quot;.gutter&quot;)</code>就可以了。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">stripper</span>(<span class="params">content</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> wrapper = $(<span class="string">"&lt;div&gt;"</span>+ content +<span class="string">"&lt;/div&gt;"</span>);</div><div class="line">    wrapper.find(<span class="string">"script,style"</span>).remove();</div><div class="line">    $(<span class="string">".gutter"</span>,wrapper).remove();</div><div class="line">    <span class="keyword">return</span> wrapper.html();</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>剩下的搜索代码，可以使用作者提供的：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> searchFunc = <span class="function"><span class="keyword">function</span>(<span class="params">path, search_id, content_id</span>) </span>&#123;</div><div class="line"><span class="meta">    'use strict'</span>;</div><div class="line">    $.ajax(&#123;</div><div class="line">        <span class="attr">url</span>: path,</div><div class="line">        <span class="attr">dataType</span>: <span class="string">"xml"</span>,</div><div class="line">        <span class="attr">success</span>: <span class="function"><span class="keyword">function</span>(<span class="params"> xmlResponse </span>) </span>&#123;</div><div class="line">            <span class="comment">// get the contents from search data</span></div><div class="line">            <span class="keyword">var</span> datas = $( <span class="string">"entry"</span>, xmlResponse ).map(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">return</span> &#123;</div><div class="line">                    <span class="attr">title</span>: $( <span class="string">"title"</span>, <span class="keyword">this</span> ).text(),</div><div class="line">                    <span class="attr">content</span>: stripper($(<span class="string">"content"</span>,<span class="keyword">this</span>).text()),</div><div class="line">                    <span class="attr">url</span>: $( <span class="string">"url"</span> , <span class="keyword">this</span>).text()</div><div class="line">                &#125;;</div><div class="line">            &#125;).get();</div><div class="line">            <span class="keyword">var</span> $input = <span class="built_in">document</span>.getElementById(search_id);</div><div class="line">            <span class="keyword">var</span> $resultContent = <span class="built_in">document</span>.getElementById(content_id);</div><div class="line">            $input.addEventListener(<span class="string">'input'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">                <span class="keyword">var</span> str=<span class="string">'&lt;ul class=\"search-result-list\"&gt;'</span>;                </div><div class="line">                <span class="keyword">var</span> keywords = <span class="keyword">this</span>.value.trim().toLowerCase().split(<span class="regexp">/[\s\-]+/</span>);</div><div class="line">                $resultContent.innerHTML = <span class="string">""</span>;</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.value.trim().length &lt;= <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// perform local searching</span></div><div class="line">                datas.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</div><div class="line">                    <span class="keyword">var</span> isMatch = <span class="literal">true</span>;</div><div class="line">                    <span class="keyword">var</span> content_index = [];</div><div class="line">                    <span class="keyword">var</span> data_title = data.title.trim().toLowerCase();</div><div class="line">                    <span class="keyword">var</span> data_content = data.content.trim().replace(<span class="regexp">/&lt;[^&gt;]+&gt;/g</span>,<span class="string">""</span>).toLowerCase();</div><div class="line">                    <span class="keyword">var</span> data_url = data.url;</div><div class="line">                    <span class="keyword">var</span> index_title = <span class="number">-1</span>;</div><div class="line">                    <span class="keyword">var</span> index_content = <span class="number">-1</span>;</div><div class="line">                    <span class="keyword">var</span> first_occur = <span class="number">-1</span>;</div><div class="line">                    <span class="comment">// only match artiles with not empty titles and contents</span></div><div class="line">                    <span class="keyword">if</span>(data_title != <span class="string">''</span> &amp;&amp; data_content != <span class="string">''</span>) &#123;</div><div class="line">                        keywords.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">keyword, i</span>) </span>&#123;</div><div class="line">                            index_title = data_title.indexOf(keyword);</div><div class="line">                            index_content = data_content.indexOf(keyword);</div><div class="line">                            <span class="keyword">if</span>( index_title &lt; <span class="number">0</span> &amp;&amp; index_content &lt; <span class="number">0</span> )&#123;</div><div class="line">                                isMatch = <span class="literal">false</span>;</div><div class="line">                            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                                <span class="keyword">if</span> (index_content &lt; <span class="number">0</span>) &#123;</div><div class="line">                                    index_content = <span class="number">0</span>;</div><div class="line">                                &#125;</div><div class="line">                                <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</div><div class="line">                                    first_occur = index_content;</div><div class="line">                                &#125;</div><div class="line">                            &#125;</div><div class="line">                        &#125;);</div><div class="line">                    &#125;</div><div class="line">                    <span class="comment">// show search results</span></div><div class="line">                    <span class="keyword">if</span> (isMatch) &#123;</div><div class="line">                        str += <span class="string">"&lt;li&gt;&lt;a href='"</span>+ data_url +<span class="string">"' class='search-result-title'&gt;"</span>+ data_title +<span class="string">"&lt;/a&gt;"</span>;</div><div class="line">                        <span class="keyword">var</span> content = data.content.trim().replace(<span class="regexp">/&lt;[^&gt;]+&gt;/g</span>,<span class="string">""</span>);</div><div class="line">                        <span class="keyword">if</span> (first_occur &gt;= <span class="number">0</span>) &#123;</div><div class="line">                            <span class="comment">// cut out 100 characters</span></div><div class="line">                            <span class="keyword">var</span> start = first_occur - <span class="number">20</span>;</div><div class="line">                            <span class="keyword">var</span> end = first_occur + <span class="number">80</span>;</div><div class="line">                            <span class="keyword">if</span>(start &lt; <span class="number">0</span>)&#123;</div><div class="line">                                start = <span class="number">0</span>;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">if</span>(start == <span class="number">0</span>)&#123;</div><div class="line">                                end = <span class="number">100</span>;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">if</span>(end &gt; content.length)&#123;</div><div class="line">                                end = content.length;</div><div class="line">                            &#125;</div><div class="line">                            <span class="keyword">var</span> match_content = content.substring(start, end); </div><div class="line">                            <span class="comment">// highlight all keywords</span></div><div class="line">                            keywords.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">keyword</span>)</span>&#123;</div><div class="line">                                <span class="keyword">var</span> regS = <span class="keyword">new</span> <span class="built_in">RegExp</span>(keyword, <span class="string">"gi"</span>);</div><div class="line">                                match_content = match_content.replace(regS, <span class="string">"&lt;em class=\"search-keyword\"&gt;"</span>+keyword+<span class="string">"&lt;/em&gt;"</span>);</div><div class="line">                            &#125;);</div><div class="line">                            </div><div class="line">                            str += <span class="string">"&lt;p class=\"search-result\"&gt;"</span> + match_content +<span class="string">"...&lt;/p&gt;"</span></div><div class="line">                        &#125;</div><div class="line">                        str += <span class="string">"&lt;/li&gt;"</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;);</div><div class="line">                str += <span class="string">"&lt;/ul&gt;"</span>;</div><div class="line">                $resultContent.innerHTML = str;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>如果你的搜索框插入的是</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"site_search"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"local-search-input"</span> <span class="attr">name</span>=<span class="string">"q"</span> <span class="attr">results</span>=<span class="string">"0"</span> <span class="attr">placeholder</span>=<span class="string">"search my blog..."</span> <span class="attr">class</span>=<span class="string">"form-control"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"local-search-result"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure><p>那么还要在页面当中插入</p><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line">    <span class="keyword">var</span> search_path = <span class="string">"&lt;%= config.search.path %&gt;"</span>;</div><div class="line">    <span class="keyword">if</span> (search_path.length == <span class="number">0</span>) &#123;</div><div class="line">        search_path = <span class="string">"search.xml"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> path = <span class="string">"&lt;%= config.root %&gt;"</span> + search_path;</div><div class="line">    searchFunc(path, <span class="string">'local-search-input'</span>, <span class="string">'local-search-result'</span>);</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure><p>剩下就是一些css装饰这类的细节工作了。</p><hr class="footnotes-sep"><section class="footnotes"><ol class="footnotes-list"><li id="fn1" class="footnote-item"><p>2016年 <a href="#fnref1" class="footnote-backref">↩</a></p></li><li id="fn2" class="footnote-item"><p>PHP <a href="#fnref2" class="footnote-backref">↩</a></p></li></ol></section>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;身为一名预备程序员，对于自己使用的工具自然要有折腾的欲望。从今年&lt;sup class=&quot;footnote-ref&quot;&gt;&lt;a href=&quot;#fn1&quot; id=&quot;fnref1&quot;&gt;[1]&lt;/a&gt;&lt;/sup&gt;七八月以来，就一直在想着如何折腾折腾Hexo. 再加上很喜欢&lt;a href=&quot;https://mufeng.me/wordpress-mobile-theme-kunkka.html&quot;&gt;Kunkka&lt;/a&gt;（其Github源已404，估计被作者自己删除了）这个Wordpress的主题，想着把它移植到Hexo上来。就在这里记载一下碰到的问题和解决方案吧。&lt;/p&gt;&lt;p&gt;UPDATE 2016/10/28: 修改了部分用词&lt;/p&gt;
    
    </summary>
    
      <category term="学习" scheme="https://unnamed42.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Hexo" scheme="https://unnamed42.github.io/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>官方版DnD阵营测试</title>
    <link href="https://unnamed42.github.io/2016-06-30-%E5%AE%98%E6%96%B9%E7%89%88DnD%E9%98%B5%E8%90%A5%E6%B5%8B%E8%AF%95.html"/>
    <id>https://unnamed42.github.io/2016-06-30-官方版DnD阵营测试.html</id>
    <published>2016-06-30T10:06:54.000Z</published>
    <updated>2017-06-07T16:32:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>本版测试搬运自<a href="http://www.padnd.com/alignment_test2.php" target="_blank" rel="external">一个非官方的网站</a>，翻译出自<a href="https://www.douban.com/group/topic/5049348/" target="_blank" rel="external">豆瓣</a>。虽然测试并非出自官网，但内容是一样的。<span class="spoiler">为什么我不直接搬官网的呢？因为我找不到官网的测试结果处理脚本啊！</span></p><a id="more"></a><body><div class="alignprose"><form name="survey" action=""><script type="text/javascript">var alignments={lg:{name:"守序善良",value:0,description:"守序善良的人物相信，规律而强大的社会和高尚的政府，可以让大多数人民生活得更好。只要人们相信法律，并试着互相帮助，整个社会就将因此而进步。因此，这个阵营的人物将会朝着这个方向努力，他们会尽可能地为大多数人带来较多的福利及较少的伤害。他们必定信守自己的承诺。守序善良的人物，特别是圣武士，时常自己陷于善良与法律相冲突的两难处境。比如履行誓言可能会伤及无辜时，或在宗教法规和地方法律相矛盾时。"},ng:{name:"中立善良",value:0,description:"中立善良的人物相信力量平衡是十分重要的事，单方面地强调秩序或混乱，是无法达到至善的。因为整个宇宙中充满了朝着各式各样的目标而努力的生物，所以若要追求至善，便不能破坏这种平衡，甚至的设法维持这种平衡，如果说支持社会秩序可以带来至善，便得以为之。若推翻既有的社会秩序就可以达到至善，那也必须为之。社会结构对他们来说，没什么重大意义。中立善良的长处是，行善不为阶级偏见所影响。"},cg:{name:"混乱善良",value:0,description:"混乱善良的人物虽然喜欢按照自己的意思行事，心地却不错。尽管他们认同一切美德和公理，却不愿意受到律法和规范的约束。想要任意驱使这些人，要他们遵照命令做事是不可能的。这些人有自己的一套道德标准，虽然不至于为恶，但也不见得和一般大众的道德标准完全相同。混乱善良人物常会因为感到受人指使而在团队内制造矛盾，比起有计划的行动他们更喜欢即兴发挥。混乱善良阵营的人物不介意用恶毒的手段制裁他们认为是邪恶的人，即便并不喜欢这样做，但他们本身却并不带有恶意。"},ln:{name:"守序中立",value:0,description:"守序中立的人物而言，秩序和组织是非常重要的。他们认同强大、井然有序的统治阶层，不管这个统治阶层是专制的暴君，还是安和乐利的民主政府，这些人都不在乎，世界上必须有法律，而法律则必须被遵守。对他们而言，绝对的秩序比什么道德良知来的重要。只要是规定，不管结果是好是坏，都必须遵行无误。绝对公正的法官，和绝对服从命令的士兵，都是此阵营的最佳典范。守序中立对善恶持中立态度，但这不代表他们是不道德的、是道德虚无主义者或是没有道德立场。他们只不过是将道德观念永远置于服从信条、传统或者法律之下。他们通常有强烈的伦理信条，但这一信条是首先基于其信念体系，而非基于善恶认同。"},nn:{name:"绝对中立",value:0,description:"绝对中立的人物相信绝对平衡的力量，因此，他们拒绝采取任何被视为邪恶和暴力的行动。绝对中立的人会尽力避免和善良或邪恶，秩序或叛逆的力量合流。有时候他们发现自己被迫得和某个阵营结盟。为了保持平衡，这些人会刻意改变立场，和弱势者合作。然而，当强弱势力对换时，他们也会毫不犹豫地跟着改变立场。"},cn:{name:"混乱中立",value:0,description:"混乱中立的人按自己一时的兴致行动。他是一个完全的个人主义者。他重视自己的自由权利，但并不致力于保护别人的自由。他蔑视权威，愤恨约束并且挑战传统。混乱中立者并不会向无政府运动那样有意瓦解组织。如果这么做，他必须把自己的阵营转成善良(希望解放他人)或是邪恶(使异己受苦)。混乱中立的寻常称谓是“真正混乱”。注意，混乱中立者的行为也许很难预测，但他的举止并非完全随机的，他从桥上的走过去的可能性和从桥上跳下去的可能性大小并不相等。混乱中立是一个真正自由于社会约束和对改良社会的空想的阵营。"},le:{name:"守序邪恶",value:0,description:"守序邪恶的人有系统地得到他想要的东西，此行为受到他行为准则的限制，但并不顾及受其伤害的人。他关心传统、忠诚和秩序，但不关心自由、尊严和生命。他按规则行动，但没有怜悯和同情。他觉得待在统治阶层里很舒服，愿意支配别人，但也乐意为别人服务。他处罚谴责别人并不是根据他们的行为而是根据种族、信仰、祖国或社会阶层。他不愿违反法律或承诺，这种不愿部分是因为他的天性，部分是因为他需要秩序来保护他免受道德上的反对。某些守序邪恶者有特别的禁忌，比如不冷血嗜杀(但让属下去做)或不伤害儿童(如果可能的话)。他们认为这些良心上的原则使自己比一般不合人道的恶人水准高。诡计多端扩展自己势力并他的压迫人民的贵族是一个守序邪恶的例子。某些守序邪恶的人或生物狂热的效忠于邪恶，就好像十字军效忠于良善一样。伤害别人是他们这么做的目的，传播邪恶本身也是他们乐于如此的原因。他们也可能认为行恶是对某种邪恶神明或主人的责任的一部分。守序邪恶有时被称为“恶魔般的”，因为恶魔是守序邪恶的化身和典型。守序邪恶是一个有方法有意图并且能常常有所成就的邪恶阵营。"},ne:{name:"中立邪恶",value:0,description:"中立邪恶的人物为了自己可以做出任何事，一切都是为了自己，就这么简单。他们从不为死在手下的人掉泪，不论是为财、为了高兴或只是为了方便。他们不喜欢纪律，也不遵守法律、传统或任何高贵的信念。然而，他们也不像混乱邪恶者那样浮躁不安，或热爱冲突。有些中立邪恶者将邪恶视为一种理想，想要献身于邪恶。这种恶人大多是邪恶神祇或秘密组织的成员。一般人习惯将中立邪恶称为“真正的邪恶”。中立邪恶的可怕在于表现出全然的邪恶，完全没有荣誉感和对象区别。"},ce:{name:"混乱邪恶",value:0,description:"混乱邪恶的人物会因为贪婪、憎恨或欲望而做出任何事。他暴躁易怒、满怀恶意、独断暴力而且无法预料。为了得到想要的东西，他会冲动而鲁莽地行动，散播邪恶与混乱。所幸他的计划大多杂乱无章，其团体大多组织散乱。一般而言，混乱邪恶者只有被强迫时才会与人合作，其领袖常要面对斗争与暗杀。混乱邪恶的可怕在于不仅破坏美丽与生命，也破坏了美丽与生命赖以存在的秩序。"}};$(document).ready(function(){$("#submit").click(function(){var n={cx:0,lx:0,nx:0,xe:0,xg:0,xn:0};$('form[name="survey"] input[name^="q"]:checked').each(function(){n[$(this).attr("data-infl")]+=parseInt($(this).attr("data-value"))});var e,a=0,r=-1;Object.keys(alignments).forEach(function(i){var r=i.charAt(0)+"x",t="x"+i.charAt(1),c=n[r]+n[t];alignments[i].value=c,a<c&&(a=c,e=i)}),Object.keys(alignments).forEach(function(n){alignments[n].value==a&&++r}),0!=r&&(e=n.lx>n.nx&&n.lx>n.cx?"l":n.cx>n.nx&&n.cx>n.lx?"c":"n",n.xg>n.xe&&n.xg>n.xn?e+="g":n.xe>n.xn&&n.xe>n.xg?e+="e":e+="n"),e=alignments[e];var t="<p>你的阵营是：</p><h3>"+e.name+"</h3>";for(t+="<p>"+e.description+"</p>",t+="<h3>详细得分：</h3>",t+="<h4>阵营倾向：</h4>",Object.keys(alignments).forEach(function(n){var e=alignments[n];t+=e.name+" ---- ";for(var i=0;i<e.value;++i)t+="X";t+="("+e.value+")<br>"}),t+="<h4>守序与混乱：</h4>",t+="守序 ----- ",i=0;i<n.lx;i++)t+="X";for(t+="("+n.lx+")<br>",t+="中立 ----- ",i=0;i<n.nx;i++)t+="X";for(t+="("+n.nx+")<br>",t+="混乱 ----- ",i=0;i<n.cx;i++)t+="X";for(t+="("+n.cx+")<br>",t+="<h4>善良与邪恶：</h4>",t+="善良 ---- ",i=0;i<n.xg;i++)t+="X";for(t+="("+n.xg+")<br>",t+="中立 ---- ",i=0;i<n.xn;i++)t+="X";for(t+="("+n.xn+")<br>",t+="邪恶 ---- ",i=0;i<n.xe;i++)t+="X";t+="("+n.xe+")<br>",$("#result").html(t)})})</script><h2>第一卷：对亲戚的看法</h2><ol><li>长辈在家族中公开反对你，你会：<br><input name="q1" type="radio" data-infl="xg" data-value="2" checked>接受批评，改变方法<br><input name="q1" type="radio" data-infl="xg" data-value="1">尝试与长辈妥协，用折衷的方法<br><input name="q1" type="radio" data-infl="xe" data-value="1">忽略长辈的轻蔑，诽谤他们<br><input name="q1" type="radio" data-infl="xe" data-value="2">千方百计使他们收声<br></li><li>你会放弃一个前途无量的职业来帮忙解决家庭的燃眉之急吗？<br><input name="q2" type="radio" data-infl="xg" data-value="2" checked>不用想，肯定会<br><input name="q2" type="radio" data-infl="xg" data-value="1">会，但有点不情愿<br><input name="q2" type="radio" data-infl="xn" data-value="1">除非我肯定我会很快重回工作岗位<br><input name="q2" type="radio" data-infl="xn" data-value="2">不会<br></li><li>你会为了前途而背叛家人吗？<br><input name="q3" type="radio" data-infl="xe" data-value="2" checked>会，不带一点罪恶感<br><input name="q3" type="radio" data-infl="xe" data-value="1">会——只要我能秘密行事<br><input name="q3" type="radio" data-infl="xn" data-value="1">我会抗拒这诱惑<br><input name="q3" type="radio" data-infl="xn" data-value="2">我认为这个主意极为可恨<br></li><li>你尊敬一家之主吗？<br><input name="q4" type="radio" data-infl="lx" data-value="2" checked>他们的言语指导着我的行动<br><input name="q4" type="radio" data-infl="lx" data-value="1">他们是我的榜样<br><input name="q4" type="radio" data-infl="cx" data-value="1">他们通常都与我无关<br><input name="q4" type="radio" data-infl="cx" data-value="2">我当他们透明<br></li><li>如果家族要你与一个令人作呕的家伙结婚，你会：<br><input name="q5" type="radio" data-infl="lx" data-value="2" checked>听从安排，为能帮助家族而自豪<br><input name="q5" type="radio" data-infl="lx" data-value="1">会，但强颜欢笑<br><input name="q5" type="radio" data-infl="nx" data-value="1">巧妙地抗婚<br><input name="q5" type="radio" data-infl="nx" data-value="2">逃跑<br></li><li>有一位家人疏远了你。在他弥留之际，他想与你和解。你会：<br><input name="q6" type="radio" data-infl="cx" data-value="2" checked>与他谈谈，但坚守立场<br><input name="q6" type="radio" data-infl="cx" data-value="1">不跟他说话<br><input name="q6" type="radio" data-infl="nx" data-value="1">不计前嫌敞开心扉地讨论前事<br><input name="q6" type="radio" data-infl="nx" data-value="2">积极进行和解，并留心听他的遗言<br></li></ol><h2>第二卷：对朋友的看法</h2><ol><li>一个位高权重的腐败法官允诺如果你能作对你朋友不利的假证，他便给你一大笔钱。你会：<br><input name="q7" type="radio" data-infl="xe" data-value="2" checked>照做，然后拿钱<br><input name="q7" type="radio" data-infl="xe" data-value="1">拿钱照做，但尽量使证词显得无力<br><input name="q7" type="radio" data-infl="xg" data-value="1">拒绝<br><input name="q7" type="radio" data-infl="xg" data-value="2">不管结果如何，都站在朋友那一边<br></li><li>你会亲近朋友，还是与大部分人保持一段距离以保安全？<br><input name="q8" type="radio" data-infl="xg" data-value="2" checked>我有一大群密友<br><input name="q8" type="radio" data-infl="xg" data-value="1">我有些密友<br><input name="q8" type="radio" data-infl="xn" data-value="1">我有几个密友<br><input name="q8" type="radio" data-infl="xn" data-value="2">我会与人保持距离<br></li><li>你背叛过朋友吗？<br><input name="q9" type="radio" data-infl="xe" data-value="2" checked>我干过不止一次，有时也能逃避惩罚<br><input name="q9" type="radio" data-infl="xe" data-value="1">我只干过那么一次<br><input name="q9" type="radio" data-infl="xn" data-value="1">我曾被怂恿过这么做，但从未做过<br><input name="q9" type="radio" data-infl="xn" data-value="2">我从未考虑过这种事<br></li><li>你怎么看待“执子之手，与子偕老”这类对爱人的终生承诺？<br><input name="q10" type="radio" data-infl="lx" data-value="2" checked>我曾有过或正渴望着这么一段罗曼史<br><input name="q10" type="radio" data-infl="lx" data-value="1">这种罗曼史挺理想的——如果能成功的话<br><input name="q10" type="radio" data-infl="cx" data-value="1">我担心我会错过其他人对我的爱<br><input name="q10" type="radio" data-infl="cx" data-value="2">作茧自缚？真是天大的错误<br></li><li>朋友借了你钱，你会要他们还吗？<br><input name="q11" type="radio" data-infl="lx" data-value="2" checked>会，而且写好借据，不得抵赖<br><input name="q11" type="radio" data-infl="lx" data-value="1">会，但期限上会宽松些<br><input name="q11" type="radio" data-infl="nx" data-value="1">不会，尽管还了会更好<br><input name="q11" type="radio" data-infl="nx" data-value="2">不会，他们欠我一个人情<br></li><li>你仍与儿时玩伴保持联络吗？<br><input name="q12" type="radio" data-infl="nx" data-value="2" checked>是的，我们定期通信<br><input name="q12" type="radio" data-infl="nx" data-value="1">是的，我们努力保持联络<br><input name="q12" type="radio" data-infl="cx" data-value="1">不会，我经常搬家<br><input name="q12" type="radio" data-infl="cx" data-value="2">不会，我不再与他们有共同之处<br></li></ol><h2>第三卷：对集体的看法</h2><ol><li>你会花时间和金钱在集体上吗？<br><input name="q13" type="radio" data-infl="xg" data-value="2" checked>会，我会优先考虑集体的需要<br><input name="q13" type="radio" data-infl="xg" data-value="1">如果我的需求被满足的话，我会尽我所能<br><input name="q13" type="radio" data-infl="xn" data-value="1">不会，我没钱也不闲<br><input name="q13" type="radio" data-infl="xn" data-value="2">不会，花时间和金钱在集体上是一种浪费<br></li><li>集体面临被侵害的威胁，你会：<br><input name="q14" type="radio" data-infl="xg" data-value="2" checked>保卫它直至自己的最后一口气<br><input name="q14" type="radio" data-infl="xg" data-value="1">和残存同伴构筑防御<br><input name="q14" type="radio" data-infl="xe" data-value="1">一看到势头不对就逃跑<br><input name="q14" type="radio" data-infl="xe" data-value="2">与入侵者达成协议，成为间谍<br></li><li>如果你受伤了，需要急救，你的同伴愿意帮助你吗？<br><input name="q15" type="radio" data-infl="xn" data-value="2" checked>会的，因为他们知道我也会为他们做同样的事<br><input name="q15" type="radio" data-infl="xn" data-value="1">会的，因为我很受欢迎<br><input name="q15" type="radio" data-infl="xe" data-value="1">可能不会，因为我不受信任<br><input name="q15" type="radio" data-infl="xe" data-value="2">肯定不会，我在集体中树敌了<br></li><li>你尊重集体的规章和领袖吗？<br><input name="q16" type="radio" data-infl="lx" data-value="2" checked>毋庸置疑，是的<br><input name="q16" type="radio" data-infl="lx" data-value="1">是的，总的来说他们是最佳的管理方式<br><input name="q16" type="radio" data-infl="cx" data-value="1">当它适合我时，我才会——有些规章我并不认同<br><input name="q16" type="radio" data-infl="cx" data-value="2">我不关心他们；他们拿我没辙<br></li><li>同伴回避你，或嘲笑你吗？<br><input name="q17" type="radio" data-infl="cx" data-value="2" checked>是的，这些井底之蛙不会理解超规格的人<br><input name="q17" type="radio" data-infl="cx" data-value="1">有些会，因为并不是所有人都认同我<br><input name="q17" type="radio" data-infl="nx" data-value="1">不会，我看起来一切正常<br><input name="q17" type="radio" data-infl="nx" data-value="2">不会，我就是集体中的正常人的标准<br></li><li>你当官会为民作主，或者希望代表集体的意志吗？<br><input name="q18" type="radio" data-infl="lx" data-value="2" checked>做这种事是我所乐意接受的荣誉<br><input name="q18" type="radio" data-infl="lx" data-value="1">当然。这是每个人的义务<br><input name="q18" type="radio" data-infl="nx" data-value="1">不会，除非无人能接手此事<br><input name="q18" type="radio" data-infl="nx" data-value="2">不会，我不想为集体利益负责<br></li></ol><h2>第四卷：对国家的看法</h2><ol><li>你的国家闹饥荒，你会：<br><input name="q19" type="radio" data-infl="xg" data-value="2" checked>与其他人共享自己有的食物<br><input name="q19" type="radio" data-infl="xg" data-value="1">自己吃尽可能少，余下的给其他人<br><input name="q19" type="radio" data-infl="xe" data-value="1">偷取自己生存所需食物<br><input name="q19" type="radio" data-infl="xe" data-value="2">偷取尽可能多的食物，然后高价卖出<br></li><li>给你足够的钱，你会往国王的酒中下毒吗？<br><input name="q20" type="radio" data-infl="xe" data-value="2" checked>会，类似的事我干过了<br><input name="q20" type="radio" data-infl="xe" data-value="1">如果我能逃避惩罚的话，我会的<br><input name="q20" type="radio" data-infl="xn" data-value="1">不会，尽管我觉得这一大笔钱很诱人<br><input name="q20" type="radio" data-infl="xn" data-value="2">不会，而且我会叫国王小心这个阴谋<br></li><li>瘟疫传遍你的国家，你会：<br><input name="q21" type="radio" data-infl="xg" data-value="2" checked>接下寻求解药的危险任务<br><input name="q21" type="radio" data-infl="xg" data-value="1">尽力治好病人<br><input name="q21" type="radio" data-infl="xn" data-value="1">避免接触到病人<br><input name="q21" type="radio" data-infl="xn" data-value="2">逃离国家<br></li><li>你尊重领主的法律权威吗？<br><input name="q22" type="radio" data-infl="lx" data-value="2" checked>是的，X主席万岁！<br><input name="q22" type="radio" data-infl="lx" data-value="1">是的，我们的统治者大体上是公平、公正的<br><input name="q22" type="radio" data-infl="cx" data-value="1">不会，统治者还不是人一个！<br><input name="q22" type="radio" data-infl="cx" data-value="2">不会，权力必定导致腐化<br></li><li>给你一笔稳赚的生意，你会为敌国做间谍吗？<br><input name="q23" type="radio" data-infl="cx" data-value="2" checked>会，因为我的国家势必任人鱼肉<br><input name="q23" type="radio" data-infl="cx" data-value="1">会，因为国家机密对我无关紧要<br><input name="q23" type="radio" data-infl="nx" data-value="1">不会，我会被抓的<br><input name="q23" type="radio" data-infl="nx" data-value="2">不会，我不会辜负国家对我的信任<br></li><li>你依靠政府来建立社会契约和保障所有权吗？<br><input name="q24" type="radio" data-infl="lx" data-value="2" checked>是的，因为维护法律比任何个人争执重要<br><input name="q24" type="radio" data-infl="lx" data-value="1">是的，因为法庭就是为了解决这种争执而设立的<br><input name="q24" type="radio" data-infl="nx" data-value="1">你在开玩笑吗？政府连路都不会铺<br><input name="q24" type="radio" data-infl="nx" data-value="2">绝对不会，如果我自己不能保护个人所有，我就无权拥有它<br></li></ol><h2>第五卷：对刑罚的看法</h2><ol><li>如果你入狱了，你会伤害或杀死其他人而脱狱吗？<br><input name="q25" type="radio" data-infl="xe" data-value="2" checked>会，服刑这么多年等于锁住自己<br><input name="q25" type="radio" data-infl="xe" data-value="1">会，在犯事时便已知道这风险了<br><input name="q25" type="radio" data-infl="xn" data-value="1">不会，除非只造成容易愈合的小伤<br><input name="q25" type="radio" data-infl="xn" data-value="2">不会，那些守卫只是在尽本分而已<br></li><li>你接受贵族有权恶劣对待手下的仆人吗？<br><input name="q26" type="radio" data-infl="xn" data-value="2" checked>是的，很幸运，贵族们投了个好胎<br><input name="q26" type="radio" data-infl="xn" data-value="1">是的，有时要靠吓，他们才肯干活<br><input name="q26" type="radio" data-infl="xg" data-value="1">不会，贵族应仁慈地统治<br><input name="q26" type="radio" data-infl="xg" data-value="2">任何人都无权恶劣对待别人。以上。<br></li><li>你意外地犯罪了，你会：<br><input name="q27" type="radio" data-infl="xg" data-value="2" checked>认罪，并向受害者赔偿<br><input name="q27" type="radio" data-infl="xg" data-value="1">认罪，向法官请求宽大处理<br><input name="q27" type="radio" data-infl="xe" data-value="1">隐瞒自己的涉案事实，必要时说谎<br><input name="q27" type="radio" data-infl="xe" data-value="2">嫁祸于人<br></li><li>如果犯罪了，你会认罪吗？<br><input name="q28" type="radio" data-infl="lx" data-value="2" checked>会，因为我有这个责任<br><input name="q28" type="radio" data-infl="lx" data-value="1">会，因为我会因此获得轻判<br><input name="q28" type="radio" data-infl="nx" data-value="1">不会，我会等到检察官证明我有罪<br><input name="q28" type="radio" data-infl="nx" data-value="2">不会，我会证明我“无罪”的<br></li><li>如果可能被惩罚，你会表明一个革命性的政见吗？<br><input name="q29" type="radio" data-infl="cx" data-value="2" checked>会，我宁愿受罚也不愿保持沉默<br><input name="q29" type="radio" data-infl="cx" data-value="1">会，总要有人说真话<br><input name="q29" type="radio" data-infl="nx" data-value="1">不会，尽管私底下我会对朋友说<br><input name="q29" type="radio" data-infl="nx" data-value="2">不会，不值得为政治费神<br></li><li>旅行时，你目击了一场袭击。你被传去作证，这会非常耽误你的行程。你会：<br><input name="q30" type="radio" data-infl="cx" data-value="2" checked>连夜溜走，避免作证<br><input name="q30" type="radio" data-infl="cx" data-value="1">说自己什么也没看到<br><input name="q30" type="radio" data-infl="lx" data-value="1">勉强留下，作证，然后离开<br><input name="q30" type="radio" data-infl="lx" data-value="2">留下直至结案所需证供足够<br></li></ol><h2>第六卷：对财富的看法</h2><ol><li>财富的最大用途是什么？<br><input name="q31" type="radio" data-infl="xg" data-value="2" checked>帮助穷人和不幸的人<br><input name="q31" type="radio" data-infl="xg" data-value="1">满足亲朋戚友需要<br><input name="q31" type="radio" data-infl="xe" data-value="1">让自己达到人生巅峰<br><input name="q31" type="radio" data-infl="xe" data-value="2">不仅达到巅峰，还要阻止别人超过自己<br></li><li>遇到乞丐，你会：<br><input name="q32" type="radio" data-infl="xg" data-value="2" checked>慷慨地给钱<br><input name="q32" type="radio" data-infl="xg" data-value="1">恰到好处地给钱<br><input name="q32" type="radio" data-infl="xn" data-value="1">只给我认为无所谓的钱——至多一两块<br><input name="q32" type="radio" data-infl="xn" data-value="2">视而不见<br></li><li>通过魔法，你可以使村里的商人们以为你的铜币是金币。你会这样做吗？<br><input name="q33" type="radio" data-infl="xe" data-value="2" checked>会，而且我还要尽可能地消费<br><input name="q33" type="radio" data-infl="xe" data-value="1">会，但只骗富商<br><input name="q33" type="radio" data-infl="xn" data-value="1">不会，风险太大了<br><input name="q33" type="radio" data-infl="xn" data-value="2">不会，商人也要养家糊口啊<br></li><li>你有两份工作可供选择。一份酬劳更多，另一份较稳定。你会选哪一份？<br><input name="q34" type="radio" data-infl="nx" data-value="2" checked>肯定是更赚钱的那份；稳定的工作听上去像苦差事<br><input name="q34" type="radio" data-infl="nx" data-value="1">可能是前者，尽管我会看看后者干些什么<br><input name="q34" type="radio" data-infl="lx" data-value="1">后者，除非前者赚的钱多到吓死人<br><input name="q34" type="radio" data-infl="lx" data-value="2">肯定是稳定的那份，因为我有长远的计划<br></li><li>最佳的致富途径是什么？<br><input name="q35" type="radio" data-infl="cx" data-value="2" checked>这关乎天时地利，还有一时运气<br><input name="q35" type="radio" data-infl="cx" data-value="1">灵活变通会有更多机会<br><input name="q35" type="radio" data-infl="lx" data-value="1">按照一个有适度风险的长期计划来做<br><input name="q35" type="radio" data-infl="lx" data-value="2">努力工作，坚持不懈<br></li><li>如果你接手一项工作，尽管它会很危险，你会努力完成吗？<br><input name="q36" type="radio" data-infl="nx" data-value="2" checked>会，我说话算数<br><input name="q36" type="radio" data-infl="nx" data-value="1">会，因为人家会认为我信得过，这很好<br><input name="q36" type="radio" data-infl="cx" data-value="1">你可以赌我会否爽约<br><input name="q36" type="radio" data-infl="cx" data-value="2">如果这不是什么好差事，那算了吧<br></li></ol><div align="center"><button id="submit" class="button button-inverse button-rounded" type="button">提交</button></div><div id="result"></div></form></div></body>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本版测试搬运自&lt;a href=&quot;http://www.padnd.com/alignment_test2.php&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;一个非官方的网站&lt;/a&gt;，翻译出自&lt;a href=&quot;https://www.douban.com/group/topic/5049348/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;豆瓣&lt;/a&gt;。虽然测试并非出自官网，但内容是一样的。&lt;span class=&quot;spoiler&quot;&gt;为什么我不直接搬官网的呢？因为我找不到官网的测试结果处理脚本啊！&lt;/span&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="杂项" scheme="https://unnamed42.github.io/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="测试" scheme="https://unnamed42.github.io/tags/%E6%B5%8B%E8%AF%95/"/>
    
      <category term="DnD" scheme="https://unnamed42.github.io/tags/DnD/"/>
    
  </entry>
  
  <entry>
    <title>hexo spoiler插件</title>
    <link href="https://unnamed42.github.io/2016-06-25-hexo-spoiler%E6%8F%92%E4%BB%B6.html"/>
    <id>https://unnamed42.github.io/2016-06-25-hexo-spoiler插件.html</id>
    <published>2016-06-25T11:23:32.000Z</published>
    <updated>2017-03-13T13:59:16.000Z</updated>
    
    <content type="html"><![CDATA[<p>这是个新手做的非常简单的插件。</p><p>UPDATE 2016/06/27: 添加点击可见功能</p><p>UPDATE 2017/03/13: 更正一些错误知识</p><a id="more"></a><p>由于看到了萌娘百科和Steam的黑幕插件，我就萌生了在博客上也用上这个功能的想法。之前想表达一些嘿嘿嘿的信息的时候，要么使用自带的划线，或者是使用<a href="https://github.com/JamesPan/hexo-ruby-character" target="_blank" rel="external">hexo-ruby-character</a>。但这些还不够喜感，像萌娘百科的那种才有喜感，然而它在手机上十分蛋疼（手机上就算选中了也看不到内容，而且那个黑条也不是点击消失的）。我的小伙伴也做了个黑幕插件，在此打个<a href="https://github.com/MaoKwen/hexo-black-cover" target="_blank" rel="external">广告</a><span class="spoiler">我没用过，不知道怎样，效果不好不要打我</span>。</p><p>今天做制作准备工作的时候（其实就是在各网站搜刮css和脚本），偶然间发现了<a href="https://meta.discourse.org/t/folding-spoilers/16123/2" target="_blank" rel="external">这个网站</a>，他自带的spoiler是类似高斯模糊效果，点击可消失，我一下就心动了，仿照他们的做了这么个插件。</p><h2 id="安装与使用">安装与使用</h2><p>安装：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install hexo-spoiler --save</div></pre></td></tr></table></figure><p>使用：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% spoiler text %&#125;</div></pre></td></tr></table></figure><h2 id="成果展示">成果展示</h2><p>可以遮蔽正常文本：<span class="spoiler">text</span></p><p>可以遮蔽带格式的文本：<span class="spoiler"><em>text</em> <strong>text</strong> <s>text</s></span></p><p>可以遮蔽行内代码，但是效果非常差：<span class="spoiler"><code>code</code></span></p><h2 id="缺点">缺点</h2><ol><li><p>当内部有代码块的时候效果非常糟糕</p></li><li><p><del>只是鼠标划过的时候显示文本，而不是像原网站那样点击显示文本，再点击隐藏 <span class="spoiler">我觉得他们肯定用了js脚本</span></del>点击可隐藏，再点击消失<del>，但缺少动画效果</del>。</p></li><li><p>目前它产生的HTML代码是<code>&lt;span&gt;</code>包起来的，而且我去除了它渲染时生成的<code>&lt;p&gt;</code>, 所以如果你需要换行的话也许需要自己手动加上<code>&lt;br&gt;</code></p></li><li><p><del>在手机上会有点卡，因为它似乎先触发<code>hover</code>效果再触发<code>click</code>事件。</del>已经无所谓了</p></li></ol><h2 id="背后的故事">背后的故事</h2><p>实际上是抄袭那个网站的css, 在每个文章的正文中都植入这个css. css长这样：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">span</span><span class="selector-class">.spoiler</span> &#123;</div><div class="line">    <span class="attribute">color</span>: <span class="built_in">rgba</span>(0, 0, 0, 0);</div><div class="line">    <span class="attribute">background-color</span>: <span class="built_in">rgba</span>(0, 0, 0, 0);</div><div class="line">    <span class="attribute">text-shadow</span>: grey <span class="number">0px</span> <span class="number">0px</span> <span class="number">10px</span>;</div><div class="line">    <span class="attribute">cursor</span>: pointer;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">span</span><span class="selector-class">.spoiler</span><span class="selector-pseudo">:hover</span> &#123;</div><div class="line">    <span class="attribute">text-shadow</span>: grey <span class="number">0px</span> <span class="number">0px</span> <span class="number">5px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">span</span><span class="selector-class">.spoiler</span><span class="selector-class">.revealed</span> &#123;</div><div class="line">    <span class="attribute">text-shadow</span>: grey <span class="number">0px</span> <span class="number">0px</span> <span class="number">0px</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>然后给每个需要遮蔽的文本渲染后用<code>&lt;span class=&quot;spoiler&quot;&gt;</code>框起来。使用jQuery或者是DOM API来处理它的点击事件，通过加上<code>revealed</code>来使马赛克消失或显示：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> spoiler = <span class="built_in">document</span>.getElementsByClassName(<span class="string">"spoiler"</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; spoiler.length; ++i) &#123;</div><div class="line">        spoiler[i].addEventListener(<span class="string">"click"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">            <span class="keyword">this</span>.classList.toggle(<span class="string">"revealed"</span>);</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;)();</div></pre></td></tr></table></figure><p>就是这么简单。为什么我（初版）做了一天呢？<span class="spoiler">因为你智障啊</span></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;这是个新手做的非常简单的插件。&lt;/p&gt;&lt;p&gt;UPDATE 2016/06/27: 添加点击可见功能&lt;/p&gt;&lt;p&gt;UPDATE 2017/03/13: 更正一些错误知识&lt;/p&gt;
    
    </summary>
    
      <category term="杂项" scheme="https://unnamed42.github.io/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="Hexo" scheme="https://unnamed42.github.io/tags/Hexo/"/>
    
  </entry>
  
  <entry>
    <title>二叉树的遍历-栈</title>
    <link href="https://unnamed42.github.io/2016-06-22-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86-%E6%A0%88.html"/>
    <id>https://unnamed42.github.io/2016-06-22-二叉树的遍历-栈.html</id>
    <published>2016-06-22T13:42:30.000Z</published>
    <updated>2016-10-28T11:35:51.000Z</updated>
    
    <content type="html"><![CDATA[<p>一个在数据结构领域被艹了又艹的话题。本文只涉及使用栈来遍历二叉树（不包含层次遍历），并将其包装为迭代器。</p><p>UPDATE 2016/06/22: 将栈的部分从原来的大文章中分离出来</p><p>UPDATE 2016/10/28: 拿回了属于自己的迭代器</p><a id="more"></a><hr><h2 id="直接遍历">直接遍历</h2><h3 id="有关约定">有关约定</h3><p>树节点定义如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> data;</div><div class="line">    TreeNode *left,*right;</div><div class="line">    </div><div class="line">    TreeNode(<span class="keyword">int</span> x):data(x),left(<span class="literal">nullptr</span>),right(<span class="literal">nullptr</span>) &#123;&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>代码中的<code>Func</code>是函数类，也可以用函数指针/<code>std::function</code>替换之。</p><h3 id="使用系统栈">使用系统栈</h3><p>这绝对是简单到爆的一个实现方法了，不可能还有比这更简单的了。几乎就是照着这几种遍历的定义翻译到程序代码，因此不做过多解释。</p><h4 id="前序遍历">前序遍历</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Func</span>&gt; <span class="title">void</span> <span class="title">preorder</span>(<span class="title">TreeNode</span> *<span class="title">root</span>,<span class="title">Func</span> <span class="title">visit</span>)&#123;</span></div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    visit(root-&gt;data);</div><div class="line">    preorder(root-&gt;left,visit);</div><div class="line">    preorder(root-&gt;right,visit);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="中序遍历">中序遍历</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Func</span>&gt; <span class="title">void</span> <span class="title">inorder</span>(<span class="title">TreeNode</span> *<span class="title">root</span>,<span class="title">Func</span> <span class="title">visit</span>)&#123;</span></div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    inorder(root-&gt;left,visit);</div><div class="line">    visit(root-&gt;data);</div><div class="line">    inorder(root-&gt;right,visit);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="后序遍历">后序遍历</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Func</span>&gt; <span class="title">void</span> <span class="title">postorder</span>(<span class="title">TreeNode</span> *<span class="title">root</span>,<span class="title">Func</span> <span class="title">visit</span>)&#123;</span></div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    postorder(root-&gt;left,visit);</div><div class="line">    postorder(root-&gt;right,visit);</div><div class="line">    visit(root-&gt;data);</div><div class="line">&#125;</div></pre></td></tr></table></figure><h3 id="使用自定义栈">使用自定义栈</h3><p>难度开始逐步提升了。在抛开了系统栈之后，我们应该如何使用自定义栈来<strong>替换</strong>掉系统栈呢？</p><h4 id="前序遍历-v2">前序遍历</h4><p>观察原来使用系统栈的算法，先访问当前节点，之后向左走，再之后向右走。如果只是对系统栈无脑地模拟的话，向左走时把当前节点入栈，完成后退栈；向右走时同法。但在向右走时这一个调用（<code>preorder(root-&gt;right,visit)</code>）属于尾递归，此时不需要入栈，直接替换掉对应变量值即可。</p><p>总结一下，先访问当前节点；将右边入栈；节点值替换成左节点，循环。当前支路走无可走之时，弹栈，继续；此时如果栈空，结束。循环这整个过程。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Func</span>&gt; <span class="title">void</span> <span class="title">preorder</span>(<span class="title">TreeNode</span> *<span class="title">root</span>,<span class="title">Func</span> <span class="title">visit</span>)&#123;</span></div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;TreeNode*&gt; <span class="built_in">stack</span>;</div><div class="line">    <span class="keyword">while</span>(root!=<span class="literal">nullptr</span>)&#123;</div><div class="line">        visit(root-&gt;data);</div><div class="line">        <span class="keyword">if</span>(root-&gt;right!=<span class="literal">nullptr</span>)</div><div class="line">            <span class="built_in">stack</span>.push(root-&gt;right);</div><div class="line">        <span class="keyword">if</span>(root-&gt;left!=<span class="literal">nullptr</span>)</div><div class="line">            root=root-&gt;left;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">if</span>(<span class="built_in">stack</span>.empty())</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            root=<span class="built_in">stack</span>.top();</div><div class="line">            <span class="built_in">stack</span>.pop();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="中序遍历-v2">中序遍历</h4><p>同样对系统栈进行模拟，参考前序的流程，中序的流程如下：将当前节点入栈，向左走走到黑；不可走时弹栈（如果栈空则结束），访问该节点，之后向右走一步。如果向右走遇到空，重复弹栈-访问-向右的操作。循环这整个过程。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Func</span>&gt; <span class="title">void</span> <span class="title">inorder</span>(<span class="title">TreeNode</span> *<span class="title">root</span>,<span class="title">Func</span> <span class="title">visit</span>)&#123;</span></div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;TreeNode*&gt; <span class="built_in">stack</span>;</div><div class="line">    <span class="keyword">while</span>(root!=<span class="literal">nullptr</span>||!<span class="built_in">stack</span>.empty())&#123;</div><div class="line">        <span class="keyword">if</span>(root!=<span class="literal">nullptr</span>)&#123;</div><div class="line">            <span class="built_in">stack</span>.push(root);</div><div class="line">            root=root-&gt;left;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">if</span>(<span class="built_in">stack</span>.empty())</div><div class="line">                <span class="keyword">return</span>;</div><div class="line">            root=<span class="built_in">stack</span>.top();</div><div class="line">            <span class="built_in">stack</span>.pop();</div><div class="line">            visit(root-&gt;data);</div><div class="line">            root=root-&gt;right;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>为简化代码起见，把“弹栈-访问-向右”的循环合并到主流程里面了。</p><h4 id="后序遍历-v2">后序遍历</h4><p>后序遍历就有些复杂了（Leetcode上非递归<a href="https://leetcode.com/problems/binary-tree-preorder-traversal/" target="_blank" rel="external">前序</a>，<a href="https://leetcode.com/problems/binary-tree-inorder-traversal/" target="_blank" rel="external">中序</a>都是Medium, <a href="https://leetcode.com/problems/binary-tree-postorder-traversal/" target="_blank" rel="external">后序</a>就成了Hard我会说？）。</p><p>将当前节点入栈，向左走；不可走时弹栈，向右走，跳回前一步；不可走时弹栈，栈空时结束。问题在于，此时弹栈之后，可能是要向左走，也可能是要向右走，而且同一个节点可能会被弹多次。考虑下面这棵树：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    1</div><div class="line">   / \</div><div class="line">  2   3</div><div class="line"> / \</div><div class="line">4   5</div></pre></td></tr></table></figure><p>在系统栈作用下，在<code>4</code>不可走时，节点<code>2</code>被弹出，随后又入栈，走向<code>5</code>, 此后再一次弹出<code>2</code>, 这次是真正的弹出了。因此，重点在于判断节点被弹出后，是否还要向右走。主要是需要判断是否是第二次弹出，因此可设一个<code>visit</code>数组来记录访问状态，但太浪费空间。</p><p>这时就要用到后序遍历的特性了。记当前节点为<code>node</code>, 若<code>node</code>被访问，则其左右子树已经遍历完毕，应该向上回溯了。如果<code>node</code>为<code>parent</code>的左子树，代表着<code>parent</code>的左子树遍历完成，接下来就是右子树，应该向<code>parent</code>的右边进发；如果<code>node</code>是<code>parent</code>的右子树，代表<code>parent</code>的左右子树已经遍历完毕，这时它的情况和<code>node</code>一样，循环进行处理。</p><p>我们设置一个辅助变量<code>last</code>(初始设为空), 用来记录上次访问的节点。遍历时，节点一路向左一路入栈走到成空为止，此后取栈顶<code>parent</code>, 如果上次访问的<code>last</code>不为<code>parent</code>的右子树，且右子树不为空，这时要向右进发；其他情况（即<code>parent</code>的左右子树已经遍历完毕）就该访问<code>parent</code>了。之后，更新<code>last</code>记录。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Func</span>&gt; <span class="title">void</span> <span class="title">postorder</span>(<span class="title">TreeNode</span> *<span class="title">root</span>,<span class="title">Func</span> <span class="title">visit</span>)&#123;</span></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;TreeNode*&gt; <span class="built_in">stack</span>;</div><div class="line">    TreeNode *last=<span class="literal">nullptr</span>;</div><div class="line">    <span class="keyword">while</span>(root!=<span class="literal">nullptr</span>||!<span class="built_in">stack</span>.empty())&#123;</div><div class="line">        <span class="keyword">if</span>(root!=<span class="literal">nullptr</span>)&#123;</div><div class="line">            <span class="built_in">stack</span>.push(root);</div><div class="line">            root=root-&gt;left;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            TreeNode *parent=<span class="built_in">stack</span>.top();</div><div class="line">            <span class="keyword">if</span>(last!=parent-&gt;right &amp;&amp; parent-&gt;right!=<span class="literal">nullptr</span>)</div><div class="line">                root=parent-&gt;right;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                visit(parent-&gt;data);</div><div class="line">                last=parent;</div><div class="line">                <span class="built_in">stack</span>.pop();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h5 id="仙术">仙术</h5><p>此方法根据树的遍历定义得来。树的前序遍历是“根-左-右”，后序遍历是“左-右-根”。修改前序遍历的代码，使其顺序变为“根-右-左”，再将修改后得到的前序遍历序列逆置，即可得到后序遍历的“左-右-根”顺序。由于该方法需要一个额外的记录序列的容器，Leetcode的题目正好就是要获得一个这样的序列，因此该序列容器不占空间复杂度，在我这个遍历算法中就不一样了。解法放在这里，给各位扩展一下思路。</p><p>该方法来自Leetcode讨论区的<a href="https://leetcode.com/discuss/9736/accepted-code-with-explaination-does-anyone-have-better-idea" target="_blank" rel="external">这篇帖子</a>。</p><h2 id="迭代器遍历">迭代器遍历</h2><h3 id="有关约定-v2">有关约定</h3><p>迭代器有关接口声明如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">iterator</span>&#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        iterator(TreeNode *root); <span class="comment">// 待实现</span></div><div class="line">        iterator(<span class="keyword">const</span> iterator &amp;o):m_cursor(o.m_cursor) &#123;&#125;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span>&amp; <span class="keyword">operator</span>*() <span class="keyword">const</span> &#123;<span class="keyword">return</span> m_cursor.top()-&gt;data;&#125;</div><div class="line">        <span class="keyword">int</span>* <span class="keyword">operator</span>-&gt;() <span class="keyword">const</span> &#123;<span class="keyword">return</span> &amp;<span class="keyword">operator</span>*();&#125;</div><div class="line">        iterator&amp; <span class="keyword">operator</span>++(); <span class="comment">// 待实现</span></div><div class="line">        iterator <span class="keyword">operator</span>++(<span class="keyword">int</span>) &#123;<span class="keyword">auto</span> i=*<span class="keyword">this</span>; <span class="keyword">operator</span>++(); <span class="keyword">return</span> i;&#125;</div><div class="line">    <span class="keyword">private</span>:</div><div class="line">        <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;TreeNode*&gt; m_cursor;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><ol><li><p><code>operator++()</code>所实现的操作是找到在遍历序列中，当前节点的下一个节点。我们应该认为当前节点已经访问过了。</p></li><li><p>使用栈时的迭代器内部封装的是一个栈，复制起来开销太大，你可以在此基础实现上移动语义以降低开销。</p></li><li><p>在下文中，虽然三种遍历算法的迭代器都叫<code>iterator</code>, 但实际上是三种不同的类型。为描述简单起见我共用一个名称。</p></li><li><p>在这里<code>operator-&gt;()</code>是非必须的，如果使用会导致编译错误。但设计成泛型迭代器的话那么就是必须要重载的一个重要运算符了。</p></li><li><p>如果想和STL接轨，迭代器实现起来不会如此简单，还要定义一大堆类型别名，设置迭代器种类等。该迭代器由于只能自增，因此属于<a href="http://en.cppreference.com/w/cpp/concept/ForwardIterator" target="_blank" rel="external"><code>ForwardIterator</code></a>.</p></li></ol><h3 id="具体实现">具体实现</h3><p>主算法已经在上面讨论过了，因此在这里主要是将循环的单步操作提取出来作为迭代器的自增操作。初始化迭代器时，应该找到这种遍历方式生成的序列中的第一个节点。</p><h4 id="前序遍历-v3">前序遍历</h4><p>前序的第一个节点就是根。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">iterator::iterator(TreeNode *root):m_cursor() &#123;</div><div class="line">    <span class="keyword">if</span>(root!=<span class="literal">nullptr</span>)</div><div class="line">        m_cursor.push(root);</div><div class="line">&#125;</div><div class="line"></div><div class="line">iterator&amp; iterator::<span class="keyword">operator</span>++() &#123;</div><div class="line">    <span class="keyword">if</span>(m_cursor.empty())</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    <span class="keyword">auto</span> tmp=m_cursor.top();</div><div class="line">    m_cursor.pop();</div><div class="line">    <span class="keyword">if</span>(tmp-&gt;right != <span class="literal">nullptr</span>)</div><div class="line">        m_cursor.push(tmp-&gt;right);</div><div class="line">    <span class="keyword">if</span>(tmp-&gt;left != <span class="literal">nullptr</span>)</div><div class="line">        m_cursor.push(tmp-&gt;left);</div><div class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="中序遍历-v3">中序遍历</h4><p>中序遍历的第一个节点是最左的一个节点。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">iterator::iterator(TreeNode *root):m_cursor() &#123;</div><div class="line">    <span class="keyword">while</span>(root!=<span class="literal">nullptr</span>)&#123;</div><div class="line">        m_cursor.push(root);</div><div class="line">        root=root-&gt;left;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">iterator&amp; iterator::<span class="keyword">operator</span>++() &#123;</div><div class="line">    <span class="keyword">if</span>(m_cursor.empty())</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    <span class="keyword">auto</span> ptr = m_cursor.top()-&gt;right;</div><div class="line">    m_cursor.pop();</div><div class="line">    <span class="keyword">while</span>(ptr != <span class="literal">nullptr</span>) &#123;</div><div class="line">        m_cursor.push(ptr);</div><div class="line">        ptr = ptr-&gt;left;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="后序遍历-v3">后序遍历</h4><p>后序遍历的第一个节点沿左边的支路向下的第一个叶子节点。</p><p>为了不给后序迭代器增加一个<code>last</code>成员，将上面的遍历算法做出一点修改：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 辅助用函数</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">next</span><span class="params">(TreeNode *root,<span class="built_in">std</span>::<span class="built_in">stack</span>&lt;TreeNode*&gt; &amp;s)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(;;)&#123;</div><div class="line">        s.push(root);</div><div class="line">        <span class="keyword">if</span>(root-&gt;left != <span class="literal">nullptr</span>)</div><div class="line">            root = root-&gt;left;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;right != <span class="literal">nullptr</span>)</div><div class="line">            root = root-&gt;right;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Func</span>&gt; <span class="title">void</span> <span class="title">postorder</span>(<span class="title">TreeNode</span> *<span class="title">root</span>,<span class="title">Func</span> <span class="title">visit</span>)&#123;</span></div><div class="line">    <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;TreeNode*&gt; <span class="built_in">stack</span>;</div><div class="line">    next(root,<span class="built_in">stack</span>);</div><div class="line">    <span class="keyword">while</span>(!<span class="built_in">stack</span>.empty())&#123;</div><div class="line">        root=<span class="built_in">stack</span>.top();<span class="built_in">stack</span>.pop();</div><div class="line">        visit(root-&gt;data);</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">stack</span>.empty())</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        TreeNode *parent=<span class="built_in">stack</span>.top(), *tmp=parent-&gt;right;</div><div class="line">        <span class="keyword">if</span>(root==parent-&gt;left &amp;&amp; tmp!=<span class="literal">nullptr</span>)</div><div class="line">            next(tmp,<span class="built_in">stack</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>迭代器算法如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 辅助用函数</span></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">next</span><span class="params">(TreeNode *root,<span class="built_in">std</span>::<span class="built_in">stack</span>&lt;TreeNode*&gt; &amp;s)</span></span>&#123;</div><div class="line">    <span class="keyword">for</span>(;;)&#123;</div><div class="line">        s.push(root);</div><div class="line">        <span class="keyword">if</span>(root-&gt;left != <span class="literal">nullptr</span>)</div><div class="line">            root = root-&gt;left;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;right != <span class="literal">nullptr</span>)</div><div class="line">            root = root-&gt;right;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">iterator::iterator(TreeNode *root):m_cursor() &#123;</div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    next(root,m_cursor);</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">iterator&amp; iterator::<span class="keyword">operator</span>++() &#123;</div><div class="line">    <span class="keyword">if</span>(m_cursor.empty())</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    <span class="keyword">auto</span> ptr=m_cursor.top();</div><div class="line">    m_cursor.pop_back();</div><div class="line">    <span class="keyword">if</span>(m_cursor.empty())</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    <span class="keyword">auto</span> parent = m_cursor.top(), tmp = parent-&gt;right;</div><div class="line">    <span class="keyword">if</span>(ptr == parent-&gt;left &amp;&amp; tmp != <span class="literal">nullptr</span>)</div><div class="line">        next(tmp,m_cursor);</div><div class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;一个在数据结构领域被艹了又艹的话题。本文只涉及使用栈来遍历二叉树（不包含层次遍历），并将其包装为迭代器。&lt;/p&gt;&lt;p&gt;UPDATE 2016/06/22: 将栈的部分从原来的大文章中分离出来&lt;/p&gt;&lt;p&gt;UPDATE 2016/10/28: 拿回了属于自己的迭代器&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="https://unnamed42.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="算法" scheme="https://unnamed42.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>二叉树的遍历-无栈</title>
    <link href="https://unnamed42.github.io/2016-06-22-2016-06-022-%E4%BA%8C%E5%8F%89%E6%A0%91%E7%9A%84%E9%81%8D%E5%8E%86-%E6%97%A0%E6%A0%88.html"/>
    <id>https://unnamed42.github.io/2016-06-22-2016-06-022-二叉树的遍历-无栈.html</id>
    <published>2016-06-22T13:42:30.000Z</published>
    <updated>2016-10-28T11:35:47.000Z</updated>
    
    <content type="html"><![CDATA[<p>一个在数据结构领域被艹了又艹的话题。本文只涉及使用指向父节点的指针<code>parent</code>来遍历二叉树（不包含层次遍历），并将其包装为迭代器。</p><p>UPDATE 2016/06/22: 将不使用栈的部分从原来的大文章中分离出来</p><p>UPDATE 2016/10/28: 文章名从“二叉树的遍历-迭代器”改为“二叉树的遍历-无栈”，并将使用栈的迭代器移到对应文章</p><a id="more"></a><hr><h2 id="直接遍历">直接遍历</h2><h3 id="有关约定">有关约定</h3><p>树节点定义如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> data;</div><div class="line">    TreeNode *left,*right,*parent;</div><div class="line">    </div><div class="line">    TreeNode(<span class="keyword">int</span> x):data(x),left(<span class="literal">nullptr</span>),right(<span class="literal">nullptr</span>),parent(<span class="literal">nullptr</span>) &#123;&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>代码中的<code>Func</code>是函数类，也可以用函数指针/<code>std::function</code>替换之。</p><h3 id="不使用栈">不使用栈</h3><p>由于我的迭代器中不包含栈，所以首先要讨论这种不使用栈的方法，将循环的主体提取出来就是迭代器自增的逻辑。</p><p>为了达到回溯的目的，必须给节点添加上父节点的指针，否则遍历无法进行。虽然这种方法无需额外的辅助工具，但相比使用栈的算法，由于每个节点都多了一个<code>parent</code>指针，额外空间就相当于变成了$O(n)$（只是相比使用栈的，实际讨论起来这是个$O(1)$的算法）。</p><p>在这一类算法中，必须要用到各种遍历前后相邻节点的关系。</p><h4 id="前序遍历">前序遍历</h4><p>设当前节点为<code>node</code>, 父节点为<code>parent</code>. 在访问<code>node</code>之后，可有如下几种去向：</p><ol><li><p>向左进发；</p></li><li><p>左边已经访问过（或为空）时向右进发；</p></li><li><p>都访问过时向上回溯。</p></li></ol><p>前两个都很好理解，只是第三个需要进行一番讨论。从<code>node</code>向上回溯时，根据前序遍历特性可以认为以<code>node</code>为根的子树已经遍历完毕，其父节点<code>parent</code>也已访问过。回溯至<code>parent</code>, 如果<code>node</code>是<code>parent</code>的左子树，则对<code>parent</code>来说是左子树已经遍历完毕了，应该向<code>parent</code>的右子树进发；如果<code>node</code>是<code>parent</code>的右子树，此时<code>parent</code>的情况与<code>node</code>相同，此时令<code>node=parent</code>, <code>parent=parent-&gt;parent</code>, 循环处理。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Func</span>&gt; <span class="title">void</span> <span class="title">preorder</span>(<span class="title">TreeNode</span> *<span class="title">root</span>,<span class="title">Func</span> <span class="title">visit</span>)&#123;</span></div><div class="line">    <span class="keyword">while</span>(root!=<span class="literal">nullptr</span>)&#123;</div><div class="line">        visit(root-&gt;data);</div><div class="line">        <span class="keyword">if</span>(root-&gt;left!=<span class="literal">nullptr</span>)</div><div class="line">            root=root-&gt;left;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;right!=<span class="literal">nullptr</span>)</div><div class="line">            root=root-&gt;right;</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">auto</span> parent=root-&gt;parent;</div><div class="line">            <span class="keyword">while</span>(parent!=<span class="literal">nullptr</span>)&#123;</div><div class="line">                <span class="keyword">if</span>(root==parent-&gt;left &amp;&amp; parent-&gt;right!=<span class="literal">nullptr</span>)&#123;</div><div class="line">                    root=parent-&gt;right;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="comment">/* if(root==parent-&gt;right) */</span> &#123;</div><div class="line">                    root=parent;</div><div class="line">                    parent=parent-&gt;parent;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(parent==<span class="literal">nullptr</span>)</div><div class="line">                root=<span class="literal">nullptr</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="中序遍历">中序遍历</h4><p>设当前节点为<code>node</code>, 父节点为<code>parent</code>. 在访问<code>node</code>之后，考虑到中序遍历特点我们可以认为<code>node</code>的左子树已经遍历完毕。因此，<code>node</code>可有如下几种去向：</p><ol><li><p>向右进发；</p></li><li><p>若右已经访问过（或为空），向上回溯。</p></li></ol><p>回溯至<code>parent</code>之后，如果<code>node</code>是<code>parent</code>的左子树，对<code>parent</code>来说要向右进发；如果<code>node</code>是<code>parent</code>的右子树，则对<code>parent</code>来说左右都已访问完毕，情况同<code>node</code>，即可令<code>node=parent</code>, <code>parent=parent-&gt;parent</code>, 循环处理。</p><p>由于中序遍历不是直接从树的根开始，因此要找到遍历的起始节点。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="function">TreeNode* <span class="title">inorder_first</span><span class="params">(TreeNode *root)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</div><div class="line">    <span class="keyword">while</span>(root-&gt;left!=<span class="literal">nullptr</span>)</div><div class="line">        root=root-&gt;left;</div><div class="line">    <span class="keyword">return</span> root;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Func</span>&gt; <span class="title">void</span> <span class="title">inorder</span>(<span class="title">TreeNode</span> *<span class="title">root</span>,<span class="title">Func</span> <span class="title">visit</span>)&#123;</span></div><div class="line">    root=inorder_first(root);</div><div class="line">    <span class="keyword">while</span>(root!=<span class="literal">nullptr</span>)&#123;</div><div class="line">        visit(root-&gt;data);</div><div class="line">        <span class="keyword">if</span>(root-&gt;right!=<span class="literal">nullptr</span>)</div><div class="line">            root=inorder_first(root-&gt;right);</div><div class="line">        <span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">auto</span> parent=root-&gt;parent;</div><div class="line">            <span class="keyword">while</span>(parent!=<span class="literal">nullptr</span>)&#123;</div><div class="line">                <span class="keyword">if</span>(root==parent-&gt;left)&#123;</div><div class="line">                    root=parent;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125; <span class="comment">/* else if(root==parent-&gt;right) */</span></div><div class="line">                root=parent;</div><div class="line">                parent=parent-&gt;parent;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span>(parent==<span class="literal">nullptr</span>)</div><div class="line">                root=<span class="literal">nullptr</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="后序遍历">后序遍历</h4><p>设当前节点为<code>node</code>, 父节点为<code>parent</code>. 在访问<code>node</code>之后，考虑到后序遍历特点我们可以认为<code>node</code>的左右子树均已遍历完毕。因此，<code>node</code>只能向上回溯。</p><p>回溯至<code>parent</code>之后，如果<code>node</code>是<code>parent</code>的左子树，对<code>parent</code>来说接下来要遍历右子树；如果<code>node</code>是<code>parent</code>的右子树，则对<code>parent</code>来说左右已经访问完毕，情况同<code>node</code>，即可令<code>node=parent</code>, <code>parent=parent-&gt;parent</code>, 循环处理。</p><p>由于后序遍历不是直接从树的根开始，因此也要找到它起始节点。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function">TreeNode* <span class="title">postorder_first</span><span class="params">(TreeNode *root)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</div><div class="line">    <span class="keyword">for</span>(;;)&#123;</div><div class="line">        <span class="keyword">if</span>(root-&gt;left!=<span class="literal">nullptr</span>)</div><div class="line">            root=root-&gt;left;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;right!=<span class="literal">nullptr</span>)</div><div class="line">            root=root-&gt;right;</div><div class="line">        <span class="keyword">else</span> </div><div class="line">            <span class="keyword">return</span> root;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">Func</span>&gt; <span class="title">void</span> <span class="title">postorder</span>(<span class="title">TreeNode</span> *<span class="title">root</span>,<span class="title">Func</span> <span class="title">visit</span>)&#123;</span></div><div class="line">    root=postorder_first(root);</div><div class="line">    <span class="keyword">while</span>(root!=<span class="literal">nullptr</span>)&#123;</div><div class="line">        visit(root-&gt;data);</div><div class="line">        <span class="keyword">auto</span> parent=root-&gt;parent;</div><div class="line">        <span class="keyword">if</span>(parent!=<span class="literal">nullptr</span>)&#123;</div><div class="line">            <span class="keyword">if</span>(root==parent-&gt;left &amp;&amp; parent-&gt;right!=<span class="literal">nullptr</span>)</div><div class="line">                root=postorder_first(parent-&gt;right);</div><div class="line">            <span class="keyword">else</span> <span class="comment">/* if(root==parent-&gt;right) */</span></div><div class="line">                root=parent;</div><div class="line">        &#125; <span class="keyword">else</span> </div><div class="line">            root=<span class="literal">nullptr</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="迭代器遍历">迭代器遍历</h2><h3 id="有关约定-v2">有关约定</h3><p>迭代器有关接口声明如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">iterator</span>&#123;</span></div><div class="line">    <span class="keyword">public</span>:</div><div class="line">        iterator(TreeNode *root); <span class="comment">// 待实现</span></div><div class="line">        iterator(<span class="keyword">const</span> iterator &amp;o):m_cursor(o.m_cursor) &#123;&#125;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span>&amp; <span class="keyword">operator</span>*() <span class="keyword">const</span> &#123;<span class="keyword">return</span> m_cursor-&gt;data;&#125;</div><div class="line">        <span class="keyword">int</span>* <span class="keyword">operator</span>-&gt;() <span class="keyword">const</span> &#123;<span class="keyword">return</span> &amp;<span class="keyword">operator</span>*();&#125;</div><div class="line">        iterator&amp; <span class="keyword">operator</span>++(); <span class="comment">// 待实现</span></div><div class="line">        iterator <span class="keyword">operator</span>++(<span class="keyword">int</span>) &#123;<span class="keyword">auto</span> i=*<span class="keyword">this</span>; <span class="keyword">operator</span>++(); <span class="keyword">return</span> i;&#125;</div><div class="line">    <span class="keyword">private</span>:</div><div class="line">        TreeNode *m_cursor;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>注意：</p><ol><li><p><code>operator++()</code>所实现的操作是找到在遍历序列中，当前节点的下一个节点。我们应该认为当前节点已经访问过了。</p></li><li><p>在下文中，虽然三种遍历算法的迭代器都叫<code>iterator</code>, 但实际上是三种不同的类型。为描述简单起见我共用一个名称。</p></li><li><p>在这里<code>operator-&gt;()</code>是非必须的，如果使用会导致编译错误。但设计成泛型迭代器的话那么就是必须要重载的一个重要运算符了。</p></li><li><p>如果想和STL接轨，迭代器实现起来不会如此简单，还要定义一大堆类型别名，设置迭代器种类等。该迭代器由于只能自增，因此属于<a href="http://en.cppreference.com/w/cpp/concept/ForwardIterator" target="_blank" rel="external"><code>ForwardIterator</code></a>.</p></li></ol><h3 id="具体实现">具体实现</h3><p>比起有栈的版本，不使用栈的版本更好拆分。我们可以认为while循环之前的部分是迭代器初始化，while循环之内除去<code>visit</code>的部分是一次<code>operator++()</code>.</p><h4 id="前序遍历-v2">前序遍历</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">iterator::iterator(TreeNode *root):m_cursor(root) &#123;&#125;</div><div class="line"></div><div class="line">iterator&amp; iterator::<span class="keyword">operator</span>++()&#123;</div><div class="line">    <span class="keyword">if</span>(m_cursor==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    <span class="keyword">if</span>(m_cursor-&gt;left!=<span class="literal">nullptr</span>)</div><div class="line">        m_cursor=m_cursor-&gt;left;</div><div class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(m_cursor-&gt;right!=<span class="literal">nullptr</span>)</div><div class="line">        m_cursor=m_cursor-&gt;right;</div><div class="line">    <span class="keyword">else</span>&#123;</div><div class="line">        <span class="keyword">auto</span> parent=m_cursor-&gt;parent;</div><div class="line">        <span class="keyword">while</span>(parent!=<span class="literal">nullptr</span>)&#123;</div><div class="line">            <span class="keyword">if</span>(parent-&gt;right==<span class="literal">nullptr</span> || m_cursor==parent-&gt;right)&#123;</div><div class="line">                m_cursor=parent;</div><div class="line">                parent=parent-&gt;parent;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                m_cursor=parent-&gt;right;</div><div class="line">                <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        m_cursor=<span class="literal">nullptr</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="中序遍历-v2">中序遍历</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">iterator::iterator(TreeNode *root):m_cursor(root)&#123;</div><div class="line">    <span class="keyword">if</span>(m_cursor==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    <span class="keyword">while</span>(m_cursor-&gt;left!=<span class="literal">nullptr</span>)</div><div class="line">        m_cursor=m_cursor-&gt;left;</div><div class="line">&#125;</div><div class="line"></div><div class="line">iterator&amp; iterator::<span class="keyword">operator</span>++()&#123;</div><div class="line">    <span class="keyword">if</span>(m_cursor==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    <span class="keyword">if</span>(m_cursor-&gt;right!=<span class="literal">nullptr</span>)&#123;</div><div class="line">        m_cursor=m_cursor-&gt;right;</div><div class="line">        <span class="keyword">while</span>(m_cursor-&gt;left!=<span class="literal">nullptr</span>)</div><div class="line">            m_cursor=m_cursor-&gt;left;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">auto</span> parent=m_cursor-&gt;parent;</div><div class="line">        <span class="keyword">while</span>(parent!=<span class="literal">nullptr</span>)&#123;</div><div class="line">            <span class="keyword">if</span>(m_cursor==parent-&gt;left)&#123;</div><div class="line">                m_cursor=parent;</div><div class="line">                <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">            &#125;</div><div class="line">            m_cursor=parent;</div><div class="line">            parent=parent-&gt;parent;</div><div class="line">        &#125;</div><div class="line">        m_cursor=<span class="literal">nullptr</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><h4 id="后序遍历-v2">后序遍历</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 辅助用函数</span></div><div class="line"><span class="function">TreeNode* <span class="title">next</span><span class="params">(TreeNode *root)</span></span>&#123;</div><div class="line">    <span class="keyword">if</span>(root==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</div><div class="line">    <span class="keyword">for</span>(;;)&#123;</div><div class="line">        <span class="keyword">if</span>(root-&gt;left!=<span class="literal">nullptr</span>)</div><div class="line">            root=root-&gt;left;</div><div class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(root-&gt;right!=<span class="literal">nullptr</span>)</div><div class="line">            root=root-&gt;right;</div><div class="line">        <span class="keyword">else</span> </div><div class="line">            <span class="keyword">return</span> root;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">iterator::iterator(TreeNode *root):m_cursor(next(root)) &#123;&#125;</div><div class="line"></div><div class="line">iterator&amp; iterator::<span class="keyword">operator</span>++()&#123;</div><div class="line">    <span class="keyword">if</span>(m_cursor==<span class="literal">nullptr</span>)</div><div class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">    <span class="keyword">auto</span> parent=m_cursor-&gt;parent;</div><div class="line">    <span class="keyword">if</span>(parent!=<span class="literal">nullptr</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(m_cursor==parent-&gt;left &amp;&amp; parent-&gt;right!=<span class="literal">nullptr</span>)</div><div class="line">            m_cursor=next(parent-&gt;right);</div><div class="line">        <span class="keyword">else</span> </div><div class="line">            m_cursor=parent;</div><div class="line">    &#125; <span class="keyword">else</span> </div><div class="line">        m_cursor=<span class="literal">nullptr</span>;</div><div class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;一个在数据结构领域被艹了又艹的话题。本文只涉及使用指向父节点的指针&lt;code&gt;parent&lt;/code&gt;来遍历二叉树（不包含层次遍历），并将其包装为迭代器。&lt;/p&gt;&lt;p&gt;UPDATE 2016/06/22: 将不使用栈的部分从原来的大文章中分离出来&lt;/p&gt;&lt;p&gt;UPDATE 2016/10/28: 文章名从“二叉树的遍历-迭代器”改为“二叉树的遍历-无栈”，并将使用栈的迭代器移到对应文章&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="https://unnamed42.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="算法" scheme="https://unnamed42.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>BMP位图到ASCII字符画</title>
    <link href="https://unnamed42.github.io/2016-02-27-BMP%E4%BD%8D%E5%9B%BE%E5%88%B0ASCII%E5%AD%97%E7%AC%A6%E7%94%BB.html"/>
    <id>https://unnamed42.github.io/2016-02-27-BMP位图到ASCII字符画.html</id>
    <published>2016-02-27T04:41:33.000Z</published>
    <updated>2016-10-05T18:14:37.000Z</updated>
    
    <content type="html"><![CDATA[<p>最近闲得蛋疼，所以诞生了搞些大新闻的念头。</p><p>由于我<ruby>不擅长<rp>(</rp><rt>lǎn de xué</rt><rp>)</rp></ruby>脚本语言，因此费力不讨好地去用C++来完成这项工作。</p><p>UPDATE 2016-03-18: 修复失效的图片链接</p><a id="more"></a><h2 id="bmp简略介绍">BMP简略介绍</h2><p>位图一共有两种类型，即：设备相关位图(DDB)和设备无关位图(DIB). DDB位图在早期的Windows系统（Windows 3.0以前）中是很普遍的，事实上它也是唯一的。然而，随着显示器制造技术的进步，以及显示设备的多样化，DDB位图的一些固有的问题开始浮现出来了。比如，它不能够存储（或者说获取）创建这张图片的原始设备的分辨率，这样，应用程序就不能快速的判断客户机的显示设备是否适合显示这张图片。为了解决这一难题，微软创建了DIB位图格式。</p><p>设备无关位图(Device-Independent Bitmap)包含下列的颜色和尺寸信息：</p><ul><li><p>原始设备（即创建图片的设备）的颜色格式</p></li><li><p>原始设备的分辨率</p></li><li><p>原始设备的调色板</p></li><li><p>一个位数组，由红、绿、蓝（RGB）三个值代表一个像素</p></li><li><p>一个数组压缩标志，用于表明数据的压缩方案（如果需要的话）</p></li></ul><h2 id="bmp文件结构">BMP文件结构</h2><p><img src="https://upload.wikimedia.org/wikipedia/commons/c/c4/BMPfileFormat.png" alt="Wikipedia: BMP文件结构图"></p><p><img src="https://msdn.microsoft.com/dynimg/IC444238.png" alt="MSDN: BMP文件结构简图"></p><p>位图文件由以下结构体依次构成：</p><table><thead><tr><th>结构体名称</th><th>可选</th><th>大小</th><th>用途</th><th>备注</th></tr></thead><tbody><tr><td>位图文件头</td><td>否</td><td>14字节</td><td>存储位图文件通用信息</td><td>仅在读取文件时有用</td></tr><tr><td>DIB头</td><td>否</td><td>固定（存在7种不同版本）</td><td>存储位图详细信息及像素格式</td><td>紧接在位图文件头后</td></tr><tr><td>附加位掩码</td><td>是</td><td>3或4 DWORD（12或16字节）</td><td>定义像素格式</td><td>仅在DIB头是BITMAPINFOHEADER时存在</td></tr><tr><td>调色板</td><td>见备注</td><td>可变</td><td>定义图像数据（像素数组）所用颜色</td><td>色深≤ 8时不能省略</td></tr><tr><td>填充区A</td><td>是</td><td>可变</td><td>结构体对齐</td><td>位图文件头中像素数组偏移量的产物</td></tr><tr><td>像素数组</td><td>否</td><td>可变</td><td>定义实际的像素数值</td><td>像素数据在DIB头和附加位掩码中定义。像素数组中每行均以4字节对齐</td></tr><tr><td>填充区B</td><td>是</td><td>可变</td><td>结构体对齐</td><td>DIB头中ICC色彩特性数据偏移量的产物</td></tr><tr><td>ICC色彩特性数据</td><td>是</td><td>可变</td><td>定义色彩特性</td><td>可以包含外部文件路径，由该文件来定义色彩特性</td></tr></tbody></table><h3 id="bitmapfileheader">BITMAPFILEHEADER</h3><p><code>BITMAPFILEHEADER</code>位于文件的开头，存储着整个文件的概要信息。<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd183374.aspx" target="_blank" rel="external">MSDN</a>上，该结构体的定义如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagBITMAPFILEHEADER</span> &#123;</span></div><div class="line">  WORD  bfType;</div><div class="line">  DWORD bfSize;</div><div class="line">  WORD  bfReserved1;</div><div class="line">  WORD  bfReserved2;</div><div class="line">  DWORD bfOffBits;</div><div class="line">&#125; BITMAPFILEHEADER, *PBITMAPFILEHEADER;</div></pre></td></tr></table></figure><p>注：<code>WORD</code>, <code>DWORD</code>为微软MFC的经典类型别名，类型的要求分别是16位无符号整型和32位无符号整型。</p><p>各变量作用如下：</p><ul><li><p><code>bfType</code>: 文件签名，标识文件类型。这两个字节内容是0x42 0x4D, 如果以<code>char</code>的方式来读取的话要求为<code>'B'</code>, <code>'M'</code>. 根据标准的不同，也可以是其他内容（见附表）。</p></li><li><p><code>bfSize</code>: 文件大小，记录整个文件的大小（单位：字节）。</p></li><li><p><code>bfReserved1</code>, <code>bfReserved2</code>: 保留位，其内容必须是0(MSDN); 取决于具体创建图形文件的程序(Wikipedia).</p></li><li><p><code>bfOffBits</code>: 偏移量（单位：字节），标识从<code>BITMAPFILEHEADER</code>结构体的开头到位图像素数据的偏移量。</p></li></ul><h4 id="bftype的可能值">bfType的可能值</h4><table><thead><tr><th style="text-align:center">值</th><th>含义</th></tr></thead><tbody><tr><td style="text-align:center">BM</td><td>Windows 3.1x, 95, NT, … etc.</td></tr><tr><td style="text-align:center">BA</td><td>OS/2 struct Bitmap Array</td></tr><tr><td style="text-align:center">CI</td><td>OS/2 struct Color Icon</td></tr><tr><td style="text-align:center">CP</td><td>OS/2 const Color Pointer</td></tr><tr><td style="text-align:center">IC</td><td>OS/2 struct Icon</td></tr><tr><td style="text-align:center">PT</td><td>OS/2 Pointer</td></tr></tbody></table><h3 id="bitmapinfoheader">BITMAPINFOHEADER</h3><p>紧跟着<code>BITMAPFILEHEADER</code>的就是位图信息头，主要有<code>BITMAPINFOHEADER</code>, <code>BITMAPV4HEADER</code>, 以及<code>BITMAPV5HEADER</code>这几种。这里我们介绍使用最广的<code>BITMAPINFOHEADER</code>结构体。<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd183376.aspx" target="_blank" rel="external">MSDN</a>上定义如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagBITMAPINFOHEADER</span> &#123;</span></div><div class="line">  DWORD biSize;</div><div class="line">  LONG  biWidth;</div><div class="line">  LONG  biHeight;</div><div class="line">  WORD  biPlanes;</div><div class="line">  WORD  biBitCount;</div><div class="line">  DWORD biCompression;</div><div class="line">  DWORD biSizeImage;</div><div class="line">  LONG  biXPelsPerMeter;</div><div class="line">  LONG  biYPelsPerMeter;</div><div class="line">  DWORD biClrUsed;</div><div class="line">  DWORD biClrImportant;</div><div class="line">&#125; BITMAPINFOHEADER, *PBITMAPINFOHEADER;</div></pre></td></tr></table></figure><p>注：<code>LONG</code>的要求为32位有符号整型。</p><p>各变量作用如下：</p><ul><li><p><code>biSize</code>: 该结构体需要的字节数。</p></li><li><p><code>biWidth</code>: 位图的宽度（单位：像素）。 如果<code>biCompression</code>为<code>BI_JPEG</code>或<code>BI_PNG</code>, 那么<code>biWidth</code>表示解压缩后图像的宽度。</p></li><li><p><code>biHeight</code>: 位图的高度（单位：像素）。 如果为正，位图像素就是从下往上，从左往右存储，原点在左下角。如果为负，则是从上至下存储。此时，<code>biCompression</code>必须为<code>BI_RGB</code>或<code>BI_BITFIELDS</code>. 从上至下存储的位图不能压缩。 如果<code>biCompression</code>为<code>BI_JPEG</code>或<code>BI_PNG</code>, 那么<code>biHeight</code>表示解压缩后图像的高度。</p></li><li><p><code>biPlanes</code>: 目标设备的颜色面板值数量。该值必须为1.</p></li><li><p><code>biBitCount</code>: 每像素的位(bit)数。即图像色深。该成员变量决定了位图的最大色彩数。该值必须为表格内容之一（表格附后）。</p></li><li><p><code>biCompression</code>: 表示从下至上存储的位图的压缩方式。具体值见下表（表格附后）。</p></li><li><p><code>biSizeImage</code>: 图像的大小（单位：字节），无压缩位图该值可能设为0. 如果<code>biCompression</code>为<code>BI_JPEG</code>或<code>BI_PNG</code>, 那么<code>biSizeImage</code>表示对应JPEG或PNG图像的缓冲区大小。</p></li><li><p><code>biXPelsPerMeter</code>: 目标设备位图的横向分辨率（单位：像素/米）。程序可根据该值来选择合适大小的位图来显示。</p></li><li><p><code>biYPelsPerMeter</code>: 目标设备位图的纵向分辨率（单位：像素/米）。</p></li><li><p><code>biClrUsed</code>: 表示该位图中使用过的颜色索引数量。如果该值为0, 那么位图使用的是<code>biCompression</code>压缩模式下对应<code>biBitCount</code>的最大色彩数。 如果该值非0且<code>biBitCount</code>小于16, 那么<code>biClrUsed</code>表示图像引擎或设备驱动访问的色彩数。如果<code>biBitCount</code>大于等于16, 那么<code>biClrUsed</code>表示颜色表大小来优化系统调色板的性能。如果<code>biBitCount</code>等于16或32, 优化过的调色板紧跟着接下来的3个<code>DWORD</code>掩码后开始。 如果位图阵列紧跟在<code>BITMAPINFO</code>后，那么它是填充位图(packed bitmap). 填充位图是由单个指针引用。填充位图要求该<code>biClrUsed</code>必须是0或颜色表的实际大小。</p></li><li><p><code>biClrImportant</code>: 为显示该位图所需要的颜色索引数量。如果该值为0, 那么所有颜色都是需要的。</p></li></ul><h4 id="bibitcount的可能值">biBitCount的可能值</h4><table><thead><tr><th style="text-align:center">值</th><th>含义</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td>色深由内含的JPEG或PNG格式图像显式确定或隐含</td></tr><tr><td style="text-align:center">1</td><td>位图是单色图。<code>BITMAPINFO</code>的<code>bmiColors</code>包含两个条目。位图的每一bit表示一个像素，如果是0则像素颜色是<code>bmiColors</code>的第一个条目内容；其余情况是第二个条目内容</td></tr><tr><td style="text-align:center">4</td><td>位图色彩数量最大为16, <code>bmiColors</code>包含16个条目。每四bit表示一个像素</td></tr><tr><td style="text-align:center">8</td><td>位图色彩数量最大为256, <code>bmiColors</code>包含256个条目。每一字节表示一个像素</td></tr><tr><td style="text-align:center">16</td><td>位图色彩数量最大为$2^{16}$. 如果<code>biCompression</code>为<code>BI_RGB</code>, 那么<code>bmiColors</code>为<code>NULL</code>. 每一<code>WORD</code>表示一个像素</td></tr><tr><td style="text-align:center">24</td><td>位图色彩数量最大为$2^{24}$, 并且<code>bmiColors</code>为<code>NULL</code>. 每3字节表示一个像素，每一字节分别表示一个像素的BGR分量</td></tr><tr><td style="text-align:center">32</td><td>位图色彩数量最大为$2^{32}$. 如果<code>biCompression</code>为<code>BI_RGB</code>, 那么<code>bmiColors</code>为<code>NULL</code>. 每一<code>DWORD</code>表示一个像素</td></tr></tbody></table><h4 id="bicompression的可能值">biCompression的可能值</h4><table><thead><tr><th style="text-align:center">值</th><th style="text-align:center">标识</th><th>压缩方法</th><th>备注</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">BI_RGB</td><td>无</td><td>最常见</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">BI_RLE8</td><td>RLE8位/像素</td><td>只能用于格式为8位/像素的位图</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">BI_RLE4</td><td>RLE4位/像素</td><td>只能用于格式为4位/像素的位图</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">BI_BITFIELDS</td><td>位字段或者霍夫曼1D压缩（BITMAPCOREHEADER2）</td><td>像素格式由位掩码指定，或位图经过霍夫曼1D压缩（BITMAPCOREHEADER2）</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">BI_JPEG</td><td>JPEG或RLE-24压缩（BITMAPCOREHEADER2）</td><td>位图包含JPEG图像或经过RLE-24压缩（BITMAPCOREHEADER2）</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">BI_PNG</td><td>PNG</td><td>位图包含PNG图像</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">BI_ALPHABITFIELDS</td><td>位字段</td><td>针对WindowsCE.NET4.0及之后版本</td></tr></tbody></table><h3 id="bitmapinfo">BITMAPINFO</h3><p>该结构体包含了一个DIB的主要信息和色彩信息。<a href="https://msdn.microsoft.com/zh-cn/library/windows/desktop/dd183375.aspx" target="_blank" rel="external">MSDN</a>定义如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagBITMAPINFO</span> &#123;</span></div><div class="line">  BITMAPINFOHEADER bmiHeader;</div><div class="line">  RGBQUAD          bmiColors[<span class="number">1</span>];</div><div class="line">&#125; BITMAPINFO, *PBITMAPINFO;</div></pre></td></tr></table></figure><p>各变量作用如下：</p><ul><li><p><code>bmiHeader</code>: 见上一部分</p></li><li><p><code>bmiColors</code>: 一个<code>bmiColors</code>包含以下二者之一：</p><ul><li>一个<code>RGBQUAD</code>的数组，数组元素组成了颜色表。</li><li>一个16位无符号整型的数组，元素是本地调色板的颜色索引。</li></ul></li></ul><h4 id="rgbquad">RGBQUAD</h4><p>该结构体描述BGR色彩分量值。<a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd162938.aspx" target="_blank" rel="external">MSDN</a>定义如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">tagRGBQUAD</span> &#123;</span></div><div class="line">  BYTE rgbBlue;</div><div class="line">  BYTE rgbGreen;</div><div class="line">  BYTE rgbRed;</div><div class="line">  BYTE rgbReserved;</div><div class="line">&#125; RGBQUAD;</div></pre></td></tr></table></figure><p>注： <code>BYTE</code>的要求是宽为1字节的类型。一般为<code>typedef unsigned char BYTE;</code></p><p>需要注意的是它的真实顺序是BGR而不是RGB.</p><h2 id="读取bmp文件">读取BMP文件</h2><p>有了上面的资料我们就能很快地写出读取文件的代码。</p><p>首先准备好两个文件头结构体，注意要禁止编译器自动对齐。在GCC/Clang下可以用<code>__attribute__((packed))</code>, VS下可以用<code>#pragma pack(1)</code>.</p><figure class="highlight cpp"><figcaption><span>bmp.h</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __BMP__</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> __BMP__</span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdint&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">file_header</span>&#123;</span></div><div class="line">    <span class="keyword">uint8_t</span> signature[<span class="number">2</span>];   <span class="comment">// 4 bytes signature, or you can use a single uint16_t instead.</span></div><div class="line">    <span class="keyword">uint32_t</span> file_size;</div><div class="line">    <span class="keyword">uint16_t</span> reserved1;</div><div class="line">    <span class="keyword">uint16_t</span> reserved2;</div><div class="line">    <span class="keyword">uint32_t</span> off_bits;</div><div class="line">&#125; __attribute__((packed));</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">struct</span> <span class="title">info_header</span>&#123;</span></div><div class="line">    <span class="keyword">uint32_t</span> info_header_size;</div><div class="line">    <span class="keyword">int32_t</span> width;</div><div class="line">    <span class="keyword">int32_t</span> height;</div><div class="line">    <span class="keyword">uint16_t</span> planes;</div><div class="line">    <span class="keyword">uint16_t</span> bit_count;</div><div class="line">    <span class="keyword">uint32_t</span> compression;</div><div class="line">    <span class="keyword">uint32_t</span> image_size;</div><div class="line">    <span class="keyword">int32_t</span> x_res;</div><div class="line">    <span class="keyword">int32_t</span> y_res;</div><div class="line">    <span class="keyword">uint32_t</span> color_used;</div><div class="line">    <span class="keyword">uint32_t</span> color_important;</div><div class="line">&#125; __attribute__((packed));</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename,file_header *f,info_header *i,<span class="keyword">uint8_t</span> *data)</span></span>;</div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div></pre></td></tr></table></figure><p>然后可以写一个简单的读取程序。除第一个参数表示文件路径外，其它的均是以指针形式返回的返回值。</p><p>我们直接为每个像素分配3字节的空间来存储RGB信息，而非使用<code>RGBQUAD</code>结构体。为简单起见，假设我们读取的BMP文件都是24位真彩色的，无压缩，从下至上存储。</p><figure class="highlight cpp"><figcaption><span>bmp.cpp</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"bmp.h"</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fstream&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdexcept&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *filename,file_header *f,info_header *i,<span class="keyword">uint8_t</span>* &amp;data,<span class="keyword">uint32_t</span> &amp;size_of_data)</span></span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="function">fstream <span class="title">file</span><span class="params">(filename,<span class="built_in">std</span>::ios::in|<span class="built_in">std</span>::ios::binary)</span></span>;</div><div class="line">    <span class="keyword">if</span>(!file.is_open()||!file.bad())</div><div class="line">        <span class="keyword">throw</span> <span class="built_in">std</span>::runtime_error(<span class="string">"cannot open or read file"</span>);</div><div class="line">    file.read(<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">char</span>*&gt;(f),<span class="keyword">sizeof</span>(file_header));</div><div class="line">    <span class="comment">// check signature of file</span></div><div class="line">    <span class="keyword">if</span>(f-&gt;signature[<span class="number">0</span>]!=<span class="string">'B'</span>||f-&gt;signature[<span class="number">1</span>]!=<span class="string">'M'</span>)&#123;</div><div class="line">        file.close();</div><div class="line">        <span class="keyword">throw</span> <span class="built_in">std</span>::runtime_error(<span class="string">"Wrong image file type"</span>);</div><div class="line">    &#125;</div><div class="line">    file.read(<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">char</span>*&gt;(i),<span class="keyword">sizeof</span>(info_header));</div><div class="line">    </div><div class="line">    <span class="keyword">if</span>(i-&gt;bit_count&lt;<span class="number">8</span>)&#123;</div><div class="line">        file.close();</div><div class="line">        <span class="keyword">throw</span> <span class="built_in">std</span>::runtime_error(<span class="string">"Unsupported format."</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(i-&gt;compression &gt; <span class="number">1</span>)&#123;</div><div class="line">        file.close();</div><div class="line">        <span class="keyword">throw</span> <span class="built_in">std</span>::runtime_error(<span class="string">"Unsupported compression mode."</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">// recalculate file size</span></div><div class="line">    file.seekg(<span class="number">0</span>,<span class="built_in">std</span>::ios::end);</div><div class="line">    f-&gt;file_size=file.tellg();</div><div class="line">    </div><div class="line">    <span class="keyword">uint32_t</span> data_size = i-&gt;width * i-&gt;height * i-&gt;bit_count / <span class="number">8</span>;</div><div class="line">    </div><div class="line">    <span class="keyword">uint32_t</span> image_size=f-&gt;file_size - data_size;</div><div class="line">    data=<span class="keyword">new</span> <span class="keyword">uint8_t</span>[image_size];</div><div class="line">    size_of_data=image_size;</div><div class="line">    </div><div class="line">    <span class="comment">// set to the beginning</span></div><div class="line">    file.seekg(f-&gt;off_bits,<span class="built_in">std</span>::ios::beg);</div><div class="line">    <span class="comment">// read pixel data</span></div><div class="line">    file.read(<span class="keyword">reinterpret_cast</span>&lt;<span class="keyword">char</span>*&gt;(data),image_size);</div><div class="line">    file.close();</div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="灰度转换">灰度转换</h2><p>现在我们得到了每个像素的RGB信息（上一步得到的<code>data</code>还需要经过处理变成RGB顺序），现在将其转换成灰度。我们使用这样的一个公式：</p><p>$$ Luminace = 0.299 Red + 0.587 Green + 0.114 Blue $$</p><ruby>最简单<rp>(</rp><rt>bù dòng nǎo</rt><rp>)</rp></ruby>的一个写法如下：<figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> i=<span class="number">0U</span>;i&lt;size;i+=<span class="number">3</span>)</div><div class="line">    output[i]=<span class="keyword">uint8_t</span>(<span class="number">0.299</span>*data[i] + <span class="number">0.587</span>*data[i+<span class="number">1</span>] + <span class="number">0.114</span>*data[i+<span class="number">2</span>] + <span class="number">0.5</span>);</div></pre></td></tr></table></figure><p>最后加入<code>+ 0.5</code>是为了实现四舍五入而不是全部截断。</p><p>由于涉及到了浮点数，导致比整型之间的乘除法慢了很多。因此，我们把公式做个近似，变成了：</p><p>$$ Luminance = { {2 Red + 5 Green + Blue} \over 8} $$</p><p>在此基础上使用移位运算优化，整个变成了：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> i=<span class="number">0U</span>;i&lt;size;i+=<span class="number">3</span>)&#123;</div><div class="line">    <span class="keyword">auto</span> temp=data[i] &lt;&lt; <span class="number">1</span>;            <span class="comment">// 2*Red</span></div><div class="line">    temp+=(data[i+<span class="number">1</span>]&lt;&lt;<span class="number">2</span>) + data[i+<span class="number">1</span>];  <span class="comment">// 5*Green</span></div><div class="line">    temp+=data[i+<span class="number">2</span>];                   <span class="comment">// Blue</span></div><div class="line">    output[i]=<span class="keyword">uint8_t</span>(temp&gt;&gt;<span class="number">3</span>);        <span class="comment">// divide by 8</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><h2 id="转换到ascii字符">转换到ASCII字符</h2><p>参考资料中给出了两种思路，在此只简单介绍其中一种。</p><p>该方法的基本思路是，针对每一个点（一些像素组成的小区域），计算它平均灰度强度然后将其替换为强度差不多的字符。基于此我们需要一组字符，记为<code>map</code>. 其强度我们可以采取线性分布，即满足：</p><p>$$ \begin{aligned} intensity(map_i) = intensity(map_{i-1})+Constant \end{aligned} $$</p><p>然后选取字符时可以像查表一样：</p><p>$$ character=map_{intensity(dot) \over Constant} $$</p><p>因此，大致步骤如下：</p><ol><li><p>将图片平均分割为像素点或者是（矩形）小区域</p></li><li><p>计算每个部分的灰度强度</p></li><li><p>将每个部分替换为与它灰度强度最相近的字符</p></li></ol><p>我们所选取的字符组最好是强度均匀分布。刚上手时可以使用<code>const char *map=&quot; .,:;ox%#@&quot;;</code>, 并按照强度递减排列处理。使用这个<code>map</code>的话，选取对应的字符的代码则是<code>char c=map[(255-intensity(dot))*strlen(map)/256];</code>.简略代码如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdint&gt;</span></span></div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">ascii</span><span class="params">(<span class="keyword">uint8_t</span> *data,<span class="keyword">uint32_t</span> height,<span class="keyword">uint32_t</span> width,<span class="keyword">uint32_t</span> line_width,<span class="keyword">const</span> <span class="keyword">char</span> *<span class="built_in">map</span>=<span class="string">"@#%xo;:,. "</span>)</span></span>&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="function"><span class="built_in">string</span> <span class="title">result</span><span class="params">(<span class="string">""</span>)</span></span>;</div><div class="line">    <span class="keyword">uint32_t</span> len=<span class="built_in">std</span>::<span class="built_in">strlen</span>(<span class="built_in">map</span>);</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> y=<span class="number">0U</span>;i&lt;height;++y)&#123;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x=<span class="number">0U</span>;x&lt;width;++x)&#123;</div><div class="line">            <span class="keyword">auto</span> intensity=data[y*line_width+x]+data[y*line_width+x+<span class="number">1</span>]+data[y*line_width+x+<span class="number">2</span>];</div><div class="line">            intensity=(intensity*len)/<span class="number">768</span>;      <span class="comment">// for average</span></div><div class="line">            result+=<span class="built_in">map</span>[len-intensity];</div><div class="line">        &#125;</div><div class="line">        result+=<span class="string">'\n'</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>转换的效果可以看图：</p><p><img src="https://i.stack.imgur.com/V0zRq.png" alt="无耻的我从原作者处偷来的图"></p><h2 id="参考资料">参考资料</h2><ol><li><p><a href="http://www.songho.ca/dsp/luminance/luminance.html" target="_blank" rel="external">彩色图到灰度图</a></p></li><li><p><a href="http://stackoverflow.com/a/32987834" target="_blank" rel="external">灰度图到ASCII字符画</a></p></li><li><p><a href="https://en.wikipedia.org/wiki/BMP_file_format" target="_blank" rel="external">Wikipedia: BMP文件格式</a></p></li><li><p><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/dd183391.aspx" target="_blank" rel="external">MSDN: BMP文件格式</a></p></li><li><p><a href="https://msdn.microsoft.com/library/windows/desktop/aa383751" target="_blank" rel="external">Windows Data Types</a></p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最近闲得蛋疼，所以诞生了搞些大新闻的念头。&lt;/p&gt;&lt;p&gt;由于我&lt;ruby&gt;不擅长&lt;rp&gt;(&lt;/rp&gt;&lt;rt&gt;lǎn de xué&lt;/rt&gt;&lt;rp&gt;)&lt;/rp&gt;&lt;/ruby&gt;脚本语言，因此费力不讨好地去用C++来完成这项工作。&lt;/p&gt;&lt;p&gt;UPDATE 2016-03-18: 修复失效的图片链接&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="https://unnamed42.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="算法" scheme="https://unnamed42.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Leetcode 136, 137, 260 &quot;Single Number&quot;-s</title>
    <link href="https://unnamed42.github.io/2016-02-08-Leetcode-136-137-260-Single-Number-s.html"/>
    <id>https://unnamed42.github.io/2016-02-08-Leetcode-136-137-260-Single-Number-s.html</id>
    <published>2016-02-08T13:44:43.000Z</published>
    <updated>2016-10-05T18:14:49.000Z</updated>
    
    <content type="html"><![CDATA[<p>LeetCode 136, 137, 260 的题解</p><p>UPDATE 2016/06/23: 我数电修炼有成，回来改了我原先写的自己都看不懂的解答。</p><a id="more"></a><hr><h2 id="leetcode-136-single-number">Leetcode 136 Single Number</h2><blockquote><p>Given an array of integers, every element appears twice except for one. Find that single one.</p><p><strong>Note</strong>: Your algorithm should have a linear runtime complexity. Could you implement it without using extra memory?</p></blockquote><p>由于大多数的数都出现了两次，我们希望将这些数都成对消去。此时就会想到异或运算的两条性质：</p><ol><li><p><code>(a^b)^b=a</code>.</p></li><li><p><code>0^a=a</code>.</p></li></ol><p>使用异或，所有重复的数都能成对消去，因此解法如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> res=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;numsSize;i++)</div><div class="line">        res^=nums[i];</div><div class="line">    <span class="keyword">return</span> res;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>该解法实质是要寻找这样的一个二元运算$\oplus$, 使得：</p><ol><li><p>$ (a \oplus b) \oplus b = a $.</p></li><li><p>$ \exists X \forall a, X \oplus a = a $.</p></li></ol><p>正好异或运算就满足这样的性质，其中X=0.</p><h2 id="leetcode-137-single-number-ii">Leetcode 137 Single Number II</h2><blockquote><p>Given an array of integers, every element appears <em>three</em> times except for one. Find that single one.</p><p><strong>Note</strong>: Your algorithm should have a linear runtime complexity. Could you implement it without using extra memory?</p></blockquote><h3 id="解法1">解法1</h3><p>参照I的思路，我们需要寻找一个二元运算$\oplus$, 使得：</p><ol><li><p>$ ((a \oplus b) \oplus b) \oplus b = a $.</p></li><li><p>$ \exists X \forall a, X \oplus a = a $.</p></li></ol><p>三进制的不进位加法可满足这些要求，其中X=0. 现在使用二进制来模拟一位的这种三进制加法。模拟一个三进制位需要三个状态，至少需要两个二进制位，而两个二进制位能表示00, 01, 10, 11四个状态。我们舍去状态11, 在三进制下不断加一应该出现如下循环：<code>00-&gt;01-&gt;10-&gt;00-&gt;...</code>。记输入为$D$，原状态的两个位分别为$A_n$（高位）和$B_n$（低位），将其列出真值表如下：</p><table><thead><tr><th style="text-align:center">$D$</th><th style="text-align:center">$A_n$</th><th style="text-align:center">$B_n$</th><th style="text-align:center">$A_{n+1}$</th><th style="text-align:center">$B_{n+1}$</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">X</td><td style="text-align:center">X</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">X</td><td style="text-align:center">X</td></tr></tbody></table><p>其中<code>X</code>表示输入出现了不应出现的状态，可作为无关项用于化简。根据真值表使用卡诺图大法化简得到逻辑表达式如下：</p><ul><li><p>$A_{n+1} = D B_n + \overline{D} A_n$</p></li><li><p>$B_{n+1} = D \overline{A_n} \overline{B_n} + \overline{D} B_n$</p></li></ul><p>此即为所求的运算。放在题中的<code>int</code>上，一个数的各位计算所得$A_n B_n$与其他位的值无关，只与$A_n B_n$原状态和对应位的值有关。因此我们直接用两个<code>int</code>数<code>a</code>, <code>b</code>来保存$A_n B_n$, <code>a</code>, <code>b</code> 的第i位分别表示将给定数的第i位作为$D$输入后$A_n B_n$的计算结果。回到题目中来，出现三次的数会使$A_n B_n$进行一个周期，因此这些数对$A_n B_n$的值没有任何影响；对于只出现一次的那个数，在$A_n B_n$初始值为00的情况下，一次操作后只有$B_n$由0变到1, 换句话说此时<code>b</code>每个位的内容和要找的数每个位的内容相同，即<code>b</code>为所求。</p><p>写成代码就是：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> a=<span class="number">0</span>,b=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numsSize; ++i)&#123;</div><div class="line">        <span class="keyword">int</span> tmp=a;</div><div class="line">        a=(nums[i]&amp;a)|((~nums[i])&amp;a);</div><div class="line">        b=(nums[i]&amp;(~tmp)&amp;~b)|((~nums[i])&amp;b);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> b;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>简直丑出新高度……卡诺图化简能达到与或的最简表达，但对要到达形式最简没有任何帮助。</p><p>下面是来自<a href="https://leetcode.com/discuss/6632/challenge-me-thx" target="_blank" rel="external">Leetcode讨论区</a>的仙法，一看到就给人一种美的享受，一种视觉上的冲击。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>* nums,<span class="keyword">int</span> numsSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> ones = <span class="number">0</span>, twos = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numsSize; i++)&#123;</div><div class="line">        ones = (ones ^ nums[i]) &amp; ~twos;</div><div class="line">        twos = (twos ^ nums[i]) &amp; ~ones;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> ones;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>下面按照我上面的思路瞎扯一二：上面我的丑极的代码选择忽略状态11，选择循环<code>00-&gt;01-&gt;10-&gt;00-&gt;...</code>。在此我们照样忽略11，但选择的循环是<code>00-&gt;10-&gt;01-&gt;00-&gt;...</code>，列出真值表如下：</p><table><thead><tr><th style="text-align:center">$D$</th><th style="text-align:center">$A_n$</th><th style="text-align:center">$B_n$</th><th style="text-align:center">$A_{n+1}$</th><th style="text-align:center">$B_{n+1}$</th></tr></thead><tbody><tr><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">X</td><td style="text-align:center">X</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">0</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">1</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">X</td><td style="text-align:center">X</td></tr></tbody></table><p>得到逻辑表达式：</p><ul><li><p>$ A_{n+1} = D \overline{A_n} \overline{B_n} + \overline{D} A_n \overline{B_n} = (D \overline{A_n} + \overline{D} A_n) \overline{B_n} = (D \oplus A_n) \overline{B_n} $</p></li><li><p>$ B_{n+1} = \overline{D} \overline{A_n} B_n + D A_n \overline{B_n} = \ldots = (D \oplus B_n) \overline{ A_{n+1} } $</p></li></ul><p>其中$B_{n+1}$的逻辑式我只能验证而不是化简到对应结果，这里面一定隐藏了什么我不知道的变换方法。</p><p>由于从状态00到状态10变换的是$A_n$, 因此我们应该返回的值是<code>a</code>, 在上面的代码里就是<code>ones</code>.</p><h3 id="解法2">解法2</h3><p>该解法来自于这篇<a href="http://www.1point3acres.com/bbs/forum.php?mod=viewthread&amp;tid=111563&amp;page=1#pid1954331" target="_blank" rel="external">帖子</a>。</p><p>我们可以统计所有第<code>i</code>位是<code>1</code>的数（二进制表示）的个数，该结果对3求余结果只可能是0和1(重复三次的数对应<code>i</code>位上的<code>1</code>的个数一定是三的倍数。如果单次出现的数第<code>i</code>位上是<code>0</code>, 取余会得到0; 如果单次出现的数第<code>i</code>位上是<code>1</code>, 那么结果是三的倍数+1, 取余结果为1), 正好就是要求的数二进制表示的第<code>i</code>位。把数的<code>sizeof(int)*8</code>位都如此处理，然后将结果按顺序组合起来就能得到要求的数。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> K 3</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">singleNumber</span><span class="params">(<span class="keyword">int</span>* nums,<span class="keyword">int</span> numsSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> len = <span class="keyword">sizeof</span>(<span class="keyword">int</span>) * <span class="number">8</span> , res = <span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</div><div class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; numsSize; j++) </div><div class="line">            sum += (nums[j] &gt;&gt; i) &amp; <span class="number">0x01</span>;</div><div class="line">        res += (sum % K) &lt;&lt; i;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> res;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>在本题中<code>K</code>为3(大部分数出现三次), 如果题目变动的话可以据此修改<code>K</code>值而不用更改其他。</p><h2 id="leetcode-260-single-number-iii">Leetcode 260 Single Number III</h2><blockquote><p>Given an array of numbers <code>nums</code>, in which exactly two elements appear only once and all the other elements appear exactly twice. Find the two elements that appear only once.</p><p>For example:</p><p>Given <code>nums = [1, 2, 1, 3, 2, 5]</code>, return <code>[3, 5]</code>.</p><p><strong>Note</strong>:</p><ol><li>The order of the result is not important. So in the above example, <code>[5, 3]</code> is also correct.</li><li>Your algorithm should run in linear runtime complexity. Could you implement it using only constant space complexity?</li></ol></blockquote><p>使用I的思路，一遍异或下来我们能够得到<code>A^B</code>(记为<code>bit</code>). 因此下面要做的就是把<code>A</code>和<code>B</code>使用某种方法区分出来（<code>A</code>, <code>B</code>为我们要求的两个数）。</p><p>由于<code>A</code>与<code>B</code>是不同的数，因此<code>bit</code>里面至少有一位二进制位是<code>1</code>. 我们使用小技巧<code>bit&amp;(~(bit-1))</code>(或<code>bit&amp;(-bit)</code>)来将它的最低位的<code>1</code>取出来，从而将整组数分成两组，<code>A</code>,<code>B</code>肯定在不同的组里面，这样就变成了我们在Single Number里面解决过的问题了。</p><p>代码如下：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; singleNumber(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums) &#123;</div><div class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; result(<span class="number">2</span>,<span class="number">0</span>);</div><div class="line">        <span class="keyword">int</span> bit=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num:nums)</div><div class="line">            bit^=num;</div><div class="line">        <span class="keyword">int</span> lowest=bit&amp;(~(bit<span class="number">-1</span>));</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num:nums)&#123;</div><div class="line">            <span class="keyword">if</span>((lowest&amp;num)==<span class="number">0</span>)</div><div class="line">                result[<span class="number">0</span>]^=nums[i];</div><div class="line">            <span class="keyword">else</span></div><div class="line">                result[<span class="number">1</span>]^=nums[i];</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>其极简版：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></div><div class="line"><span class="keyword">public</span>:</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; singleNumber(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums) &#123;</div><div class="line">        <span class="keyword">int</span> bit=<span class="number">0</span>;</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num:nums)</div><div class="line">            bit^=num;</div><div class="line">        bit&amp;=(~(bit<span class="number">-1</span>));</div><div class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; result(<span class="number">2</span>,<span class="number">0</span>);</div><div class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num:nums)</div><div class="line">            result[!(num&amp;bit)]^=num;</div><div class="line">        <span class="keyword">return</span> result;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;LeetCode 136, 137, 260 的题解&lt;/p&gt;&lt;p&gt;UPDATE 2016/06/23: 我数电修炼有成，回来改了我原先写的自己都看不懂的解答。&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="https://unnamed42.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Leetcode" scheme="https://unnamed42.github.io/tags/Leetcode/"/>
    
      <category term="算法" scheme="https://unnamed42.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Leetcode 331 Verify Preorder Serialization of a Binary Tree</title>
    <link href="https://unnamed42.github.io/2016-02-02-Leetcode-331-Verify-Preorder-Serialization-of-a-Binary-Tree.html"/>
    <id>https://unnamed42.github.io/2016-02-02-Leetcode-331-Verify-Preorder-Serialization-of-a-Binary-Tree.html</id>
    <published>2016-02-02T15:15:32.000Z</published>
    <updated>2016-10-05T18:15:23.000Z</updated>
    
    <content type="html"><![CDATA[<p>Leetcode 331 的题解</p><a id="more"></a><p>题目如下：</p><blockquote><p>One way to serialize a binary tree is to use pre-order traversal. When we encounter a non-null node, we record the node’s value. If it is a null node, we record using a sentinel value such as <code>#</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">     _9_</div><div class="line">    /   \</div><div class="line">   3     2</div><div class="line">  / \   / \</div><div class="line"> 4   1  #  6</div><div class="line">/ \ / \   / \</div><div class="line"># # # #   # #</div></pre></td></tr></table></figure><p>For example, the above binary tree can be serialized to the string <code>“9,3,4,#,#,1,#,#,2,#,6,#,#”</code>, where <code>#</code> represents a null node.</p><p>Given a string of comma separated values, verify whether it is a correct preorder traversal serialization of a binary tree. Find an algorithm without reconstructing the tree.</p><p>Each comma separated value in the string must be either an integer or a character <code>'#'</code> representing null pointer.</p><p>You may assume that the input format is always valid, for example it could never contain two consecutive commas such as <code>&quot;1,,3&quot;</code>.</p><p><strong>Example 1</strong>:<br><code>&quot;9,3,4,#,#,1,#,#,2,#,6,#,#&quot;</code><br>Return <code>true</code></p><p><strong>Example 2</strong>:<br><code>&quot;1,#&quot;</code><br>Return <code>false</code></p><p><strong>Example 3</strong>:<br><code>&quot;9,#,#,1&quot;</code><br>Return <code>false</code></p></blockquote><hr><p>该解法来源于这篇<a href="https://leetcode.com/discuss/83824/7-lines-easy-java-solution" target="_blank" rel="external">Discuss</a>.</p><p>在二叉树中，如果把空节点也当做叶子节点考虑的话，有如下性质：</p><ul><li><p>除根节点外，所有非空节点有2个出度和1个入度（2个子节点，1个父节点）</p></li><li><p>所有空节点有0个出度和1个入度（0个子节点，1个父节点）</p></li></ul><p>现在假设我们在根据先序遍历结果建立这棵树。建立过程中，用变量<code>diff</code>记录总的出度与入度之差(<code>diff=outdegree-indegree</code>)。读入下一个节点时，将<code>diff</code>减一，因为该节点具有一个入度。如果该节点非空，那么将<code>diff</code>加二，因为该节点具有两个出度。如果该先序序列是正确的话，那么<code>diff</code>不可能为负且结果应该为0.</p><p>代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isValidSerialization</span><span class="params">(<span class="keyword">char</span>* preorder)</span> </span>&#123;</div><div class="line">    <span class="keyword">char</span> *iter=strtok(preorder,<span class="string">","</span>);</div><div class="line">    <span class="keyword">int</span> diff=<span class="number">1</span>;</div><div class="line">    <span class="keyword">while</span>(iter!=<span class="literal">NULL</span>)&#123;</div><div class="line">        <span class="keyword">if</span>(--diff&lt;<span class="number">0</span>)</div><div class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</div><div class="line">        <span class="keyword">if</span>(<span class="built_in">strcmp</span>(iter,<span class="string">"#"</span>)!=<span class="number">0</span>)</div><div class="line">            diff+=<span class="number">2</span>;</div><div class="line">        iter=strtok(<span class="literal">NULL</span>,<span class="string">","</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> diff==<span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p><code>diff</code>初始化为<code>1</code>是为了刚开始处理根节点的时候不至于在第一步得到<code>false</code>, 并且这样能够使得根节点与其他节点是使用同一逻辑处理。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Leetcode 331 的题解&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="https://unnamed42.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Leetcode" scheme="https://unnamed42.github.io/tags/Leetcode/"/>
    
      <category term="算法" scheme="https://unnamed42.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Leetcode 268 Missing Number</title>
    <link href="https://unnamed42.github.io/2016-02-02-Leetcode-268-Missing-Number.html"/>
    <id>https://unnamed42.github.io/2016-02-02-Leetcode-268-Missing-Number.html</id>
    <published>2016-02-02T14:30:47.000Z</published>
    <updated>2016-10-05T18:15:43.000Z</updated>
    
    <content type="html"><![CDATA[<p>Leetcode 268 的题解</p><a id="more"></a><p>题目如下：</p><blockquote><p>Given an array containing n distinct numbers taken from 0, 1, 2, …, n, find the one that is missing from the array.</p><p>For example, Given <code>nums = [0, 1, 3]</code> return <code>2</code>.</p><p><strong>Note</strong>: Your algorithm should run in linear runtime complexity. Could you implement it using only constant extra space complexity?</p></blockquote><hr><p><strong>解法1</strong>：</p><p>由等差数列求和可知，从$ 0 $到$ n $的自然数之和为$ {n(n+1)} \over 2 $. 我们求得给出数组的和，二者相减，就可得到缺失的那个数。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">missingNumber</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> sum_n=numsSize*(numsSize+<span class="number">1</span>)/<span class="number">2</span>,sum_nums=<span class="number">0</span>;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;numsSize;i++)</div><div class="line">        sum_nums+=nums[i];</div><div class="line">    <span class="keyword">return</span> sum_n-sum_nums;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>该方法有个缺点，就是当<code>numsSize</code>很大的时候，求出来的和可能会溢出。</p><p><strong>解法2</strong>：</p><p>该方法用到了按位异或运算的几个性质：</p><ol><li><p>假设<code>a</code>与<code>b</code>均为整数，则<code>(a^b)^b=a</code>.</p></li><li><p><code>0^a=a</code>.</p></li></ol><p>考虑到一次遍历过程中，下标<code>i</code>的可能取值为$ 0 $到$ numsSize-1 $, 数组里<code>numsSize</code>个数的范围则是$ 0 $到$ numsSize $. 使用变量<code>res</code>来存放结果，如果让<code>res</code>每次都与<code>i</code>和<code>nums[i]</code>进行异或，则最终能够成对消去大部分的数，剩下来的结果则是我们真正要求的那个数。下面我们来探讨<code>res</code>的初值。</p><p>由于<code>i</code>始终小于<code>numsSize</code>, 因此如果将<code>res</code>初始化为<code>0</code>则会出错：正好缺失$ numsSize $时，遍历一次数组，异或完毕后所有的数全部成对消去，<code>res</code>必定为0. 因此我们需要将<code>res</code>初始化为$ numsSize $, 则不缺$ numsSize $时其他的数能够成对消去，结果为所缺的那个数；缺$ numsSize $时其他的数全部消去，剩下的就是$ numsSize $.</p><p>代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">missingNumber</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> res=numsSize;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;numsSize;i++)&#123;</div><div class="line">        res^=i;</div><div class="line">        res^=nums[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> res;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>该解法能够避免解法1中潜在的溢出风险。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Leetcode 268 的题解&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="https://unnamed42.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Leetcode" scheme="https://unnamed42.github.io/tags/Leetcode/"/>
    
      <category term="算法" scheme="https://unnamed42.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>西方政治坐标测试</title>
    <link href="https://unnamed42.github.io/2016-01-10-%E8%A5%BF%E6%96%B9%E6%94%BF%E6%B2%BB%E5%9D%90%E6%A0%87%E6%B5%8B%E8%AF%95.html"/>
    <id>https://unnamed42.github.io/2016-01-10-西方政治坐标测试.html</id>
    <published>2016-01-10T14:02:52.000Z</published>
    <updated>2017-03-16T13:45:31.000Z</updated>
    
    <content type="html"><![CDATA[<p><del>没错我玩上瘾了！</del></p><hr><p>本测试转载自政治坐标测试北大未名版之<a href="http://zuobiao.me/~zuobiaom/politicalcompass/" target="_blank" rel="external">西方政治坐标系测试</a></p><a id="more"></a><hr><p>以下测试题目原文来自英文「<a href="https://www.politicalcompass.org/test" target="_blank" rel="external">政治指南针</a>」网站，英文版权属于原作者。本站对该测试的准确性及所造成的一切后果不负责。测试结果不能作为任何学术研究的依据。<br>本测试的目的是反映答题者经济与政治观念「左与右」的坐标。本测试系统建立于西方政治价值体系基础之上，<strong>某些问题强烈的依赖于具体的西方社会环境，未必能够充分反映中国国情。</strong><br>题目分六个部分，必须全部回答。</p><script type="text/javascript">$(function(){$("#submit").click(function(){var t=0,a=0;$('#questions input[name^="c"]:checked').each(function(){t+=parseFloat($(this).attr("data-x")),a+=parseFloat($(this).attr("data-y"))}),t=Math.round(100*t)/100,a=Math.round(100*a)/100,$("#answer").html("经济立场坐标（左翼<->右翼）"+t+"，政治立场坐标（专制<->自由）"+a)})})</script><style>.red{color:red}#wrapper{text-align:center}</style><form id="questions"><p><strong>第一部分</strong>：你如何看待国家与世界。</p><ol><li>如果全球化无法避免，应该首先为人服务而不是跨国公司的利益。<br><input name="c1" type="radio" data-x="0.5" data-y="0" checked>强烈反对<br><input name="c1" type="radio" data-x="0.25" data-y="0">反对<br><input name="c1" type="radio" data-x="-0.375" data-y="0">同意<br><input name="c1" type="radio" data-x="-0.625" data-y="0">强烈同意<br></li><li>我会一直支持我的国家，无论它是对是错。<br><input name="c2" type="radio" data-x="0" data-y="-0.26" checked>强烈反对<br><input name="c2" type="radio" data-x="0" data-y="-0.155">反对<br><input name="c2" type="radio" data-x="0" data-y="0.15">同意<br><input name="c2" type="radio" data-x="0" data-y="0.255">强烈同意<br></li><li>没有人可以选择祖国，因此为祖国自豪很愚蠢。<br><input name="c3" type="radio" data-x="0" data-y="0.23" checked>强烈反对<br><input name="c3" type="radio" data-x="0" data-y="0.13">反对<br><input name="c3" type="radio" data-x="0" data-y="-0.13">同意<br><input name="c3" type="radio" data-x="0" data-y="-0.23">强烈同意<br></li><li>我的种族和其他种族相比有很多出众的优点。<br><input name="c4" type="radio" data-x="0" data-y="-0.23" checked>强烈反对<br><input name="c4" type="radio" data-x="0" data-y="-0.13">反对<br><input name="c4" type="radio" data-x="0" data-y="0.13">同意<br><input name="c4" type="radio" data-x="0" data-y="0.23">强烈同意<br></li><li>敌人的敌人是朋友。<br><input name="c5" type="radio" data-x="0" data-y="-0.23" checked>强烈反对<br><input name="c5" type="radio" data-x="0" data-y="-0.13">反对<br><input name="c5" type="radio" data-x="0" data-y="0.13">同意<br><input name="c5" type="radio" data-x="0" data-y="0.23">强烈同意<br></li><li>违反国际法的军事行动有时候是正当的。<br><input name="c6" type="radio" data-x="0" data-y="-0.2" checked>强烈反对<br><input name="c6" type="radio" data-x="0" data-y="-0.1">反对<br><input name="c6" type="radio" data-x="0" data-y="0.11">同意<br><input name="c6" type="radio" data-x="0" data-y="0.21">强烈同意<br></li><li>现在信息和娱乐已经令人忧虑的交融在一起。<br><input name="c7" type="radio" data-x="0" data-y="0.23" checked>强烈反对<br><input name="c7" type="radio" data-x="0" data-y="0.13">反对<br><input name="c7" type="radio" data-x="0" data-y="-0.13">同意<br><input name="c7" type="radio" data-x="0" data-y="-0.23">强烈同意<br></li></ol><p><strong>第二部分</strong>：经济问题。</p><ol><li>人民根本上说是通过阶级而不是国籍来区分的。<br><input name="c8" type="radio" data-x="0.5" data-y="0" checked>强烈反对<br><input name="c8" type="radio" data-x="0.25" data-y="0">反对<br><input name="c8" type="radio" data-x="-0.375" data-y="0">同意<br><input name="c8" type="radio" data-x="-0.625" data-y="0">强烈同意<br></li><li>控制通货膨胀比控制失业要重要。<br><input name="c9" type="radio" data-x="-0.5" data-y="0" checked>强烈反对<br><input name="c9" type="radio" data-x="-0.25" data-y="0">反对<br><input name="c9" type="radio" data-x="0.375" data-y="0">同意<br><input name="c9" type="radio" data-x="0.625" data-y="0">强烈同意<br></li><li>因为无法信任企业能够自觉保护环境，因此需要规章来规范它们。<br><input name="c10" type="radio" data-x="0.5" data-y="0" checked>强烈反对<br><input name="c10" type="radio" data-x="0.25" data-y="0">反对<br><input name="c10" type="radio" data-x="-0.25" data-y="0">同意<br><input name="c10" type="radio" data-x="-0.5" data-y="0">强烈同意<br></li><li>“各尽所能，各取所需”从根本上说是个好的想法。<br><input name="c11" type="radio" data-x="0.5" data-y="0" checked>强烈反对<br><input name="c11" type="radio" data-x="0.25" data-y="0">反对<br><input name="c11" type="radio" data-x="-0.375" data-y="0">同意<br><input name="c11" type="radio" data-x="-0.625" data-y="0">强烈同意<br></li><li>令人沮丧的是在我们的社会中一些最基本的事物比如饮用水现在都成为了瓶装、注明商标的商品。<br><input name="c12" type="radio" data-x="0.5" data-y="0" checked>强烈反对<br><input name="c12" type="radio" data-x="0.25" data-y="0">反对<br><input name="c12" type="radio" data-x="-0.5" data-y="0">同意<br><input name="c12" type="radio" data-x="-0.75" data-y="0">强烈同意<br></li><li>土地不应当被作为商品买卖。<br><input name="c13" type="radio" data-x="0.5" data-y="0" checked>强烈反对<br><input name="c13" type="radio" data-x="0.25" data-y="0">反对<br><input name="c13" type="radio" data-x="-0.5" data-y="0">同意<br><input name="c13" type="radio" data-x="-0.75" data-y="0">强烈同意<br></li><li>很多人赚钱完全是靠运作资金，而并没有为社会做出任何贡献，这是令人不爽的。<br><input name="c14" type="radio" data-x="0.5" data-y="0" checked>强烈反对<br><input name="c14" type="radio" data-x="0.25" data-y="0">反对<br><input name="c14" type="radio" data-x="-0.375" data-y="0">同意<br><input name="c14" type="radio" data-x="-0.625" data-y="0">强烈同意<br></li><li>保护主义对贸易来说有时候是必须的。<br><input name="c15" type="radio" data-x="0.5" data-y="0" checked>强烈反对<br><input name="c15" type="radio" data-x="0.25" data-y="0">反对<br><input name="c15" type="radio" data-x="-0.5" data-y="0">同意<br><input name="c15" type="radio" data-x="-0.625" data-y="0">强烈同意<br></li><li>公司为它的股东赚取利润就是它仅有的社会职责。<br><input name="c16" type="radio" data-x="-0.5" data-y="0" checked>强烈反对<br><input name="c16" type="radio" data-x="-0.25" data-y="0">反对<br><input name="c16" type="radio" data-x="0.375" data-y="0">同意<br><input name="c16" type="radio" data-x="0.625" data-y="0">强烈同意<br></li><li>对富人征的税太高了。<br><input name="c17" type="radio" data-x="-0.5" data-y="0" checked>强烈反对<br><input name="c17" type="radio" data-x="-0.25" data-y="0">反对<br><input name="c17" type="radio" data-x="0.375" data-y="0">同意<br><input name="c17" type="radio" data-x="0.5" data-y="0">强烈同意<br></li><li>那些付得起钱的人应该有权获得更好的医疗服务。<br><input name="c18" type="radio" data-x="-0.5" data-y="0" checked>强烈反对<br><input name="c18" type="radio" data-x="-0.25" data-y="0">反对<br><input name="c18" type="radio" data-x="0.25" data-y="0">同意<br><input name="c18" type="radio" data-x="0.5" data-y="0">强烈同意<br></li><li>政府应该惩罚误导公众的商业行为。<br><input name="c19" type="radio" data-x="0.5" data-y="0" checked>强烈反对<br><input name="c19" type="radio" data-x="0.25" data-y="0">反对<br><input name="c19" type="radio" data-x="-0.25" data-y="0">同意<br><input name="c19" type="radio" data-x="-0.375" data-y="0">强烈同意<br></li><li>一个真正的自由市场需要对跨国大公司的垄断进行限制。<br><input name="c20" type="radio" data-x="0" data-y="0" checked>强烈反对<br><input name="c20" type="radio" data-x="0" data-y="0">反对<br><input name="c20" type="radio" data-x="0" data-y="0">同意<br><input name="c20" type="radio" data-x="0" data-y="0">强烈同意<br></li><li>市场越自由，人民越自由。<br><input name="c21" type="radio" data-x="-0.5" data-y="0" checked>强烈反对<br><input name="c21" type="radio" data-x="-0.25" data-y="0">反对<br><input name="c21" type="radio" data-x="0.5" data-y="0">同意<br><input name="c21" type="radio" data-x="0.75" data-y="0">强烈同意<br></li></ol><p><strong>第三部分</strong>：社会价值观。</p><ol><li>除非妇女的生命受到危及，否则总应该禁止堕胎。<br><input name="c22" type="radio" data-x="0" data-y="-0.2" checked>强烈反对<br><input name="c22" type="radio" data-x="0" data-y="-0.1">反对<br><input name="c22" type="radio" data-x="0" data-y="0.11">同意<br><input name="c22" type="radio" data-x="0" data-y="0.21">强烈同意<br></li><li>一切当权者都应该受到质询。<br><input name="c23" type="radio" data-x="0" data-y="0.23" checked>强烈反对<br><input name="c23" type="radio" data-x="0" data-y="0.175">反对<br><input name="c23" type="radio" data-x="0" data-y="-0.13">同意<br><input name="c23" type="radio" data-x="0" data-y="-0.23">强烈同意<br></li><li>以眼还眼，以牙还牙。<br><input name="c24" type="radio" data-x="0" data-y="-0.18" checked>强烈反对<br><input name="c24" type="radio" data-x="0" data-y="-0.125">反对<br><input name="c24" type="radio" data-x="0" data-y="0.08">同意<br><input name="c24" type="radio" data-x="0" data-y="0.18">强烈同意<br></li><li>税收不应该支持那些没法靠商业手段活下去的剧院和博物馆。<br><input name="c25" type="radio" data-x="-0.5" data-y="0" checked>强烈反对<br><input name="c25" type="radio" data-x="-0.25" data-y="0">反对<br><input name="c25" type="radio" data-x="0.5" data-y="0">同意<br><input name="c25" type="radio" data-x="0.625" data-y="0">强烈同意<br></li><li>学校不应该强制学生签到。<br><input name="c26" type="radio" data-x="0" data-y="0.26" checked>强烈反对<br><input name="c26" type="radio" data-x="0" data-y="0.055">反对<br><input name="c26" type="radio" data-x="0" data-y="-0.15">同意<br><input name="c26" type="radio" data-x="0" data-y="-0.255">强烈同意<br></li><li>所有人都有自己的权利，但让不同类型的人保持自己的个性对每个人来说都更好。<br><input name="c27" type="radio" data-x="0" data-y="-0.23" checked>强烈反对<br><input name="c27" type="radio" data-x="0" data-y="-0.13">反对<br><input name="c27" type="radio" data-x="0" data-y="0.13">同意<br><input name="c27" type="radio" data-x="0" data-y="0.23">强烈同意<br></li><li>好父母有时候也不得不打孩子。<br><input name="c28" type="radio" data-x="0" data-y="-0.26" checked>强烈反对<br><input name="c28" type="radio" data-x="0" data-y="-0.155">反对<br><input name="c28" type="radio" data-x="0" data-y="0.1">同意<br><input name="c28" type="radio" data-x="0" data-y="0.255">强烈同意<br></li><li>孩子对父母有秘密很正常。<br><input name="c29" type="radio" data-x="0" data-y="0.23" checked>强烈反对<br><input name="c29" type="radio" data-x="0" data-y="0.13">反对<br><input name="c29" type="radio" data-x="0" data-y="-0.08">同意<br><input name="c29" type="radio" data-x="0" data-y="-0.23">强烈同意<br></li><li>大麻应该合法。<br><input name="c30" type="radio" data-x="0" data-y="0.2" checked>强烈反对<br><input name="c30" type="radio" data-x="0" data-y="0.045">反对<br><input name="c30" type="radio" data-x="0" data-y="-0.11">同意<br><input name="c30" type="radio" data-x="0" data-y="-0.21">强烈同意<br></li><li>学校的首要职能是让下一代人能找到工作。<br><input name="c31" type="radio" data-x="0" data-y="-0.26" checked>强烈反对<br><input name="c31" type="radio" data-x="0" data-y="-0.155">反对<br><input name="c31" type="radio" data-x="0" data-y="0.1">同意<br><input name="c31" type="radio" data-x="0" data-y="0.255">强烈同意<br></li><li>应当不允许有严重遗传疾病的残疾人生育。<br><input name="c32" type="radio" data-x="0" data-y="-0.29" checked>强烈反对<br><input name="c32" type="radio" data-x="0" data-y="-0.185">反对<br><input name="c32" type="radio" data-x="0" data-y="0.17">同意<br><input name="c32" type="radio" data-x="0" data-y="0.275">强烈同意<br></li><li>孩子最重要的事是学会遵守纪律。<br><input name="c33" type="radio" data-x="0" data-y="-0.26" checked>强烈反对<br><input name="c33" type="radio" data-x="0" data-y="-0.155">反对<br><input name="c33" type="radio" data-x="0" data-y="0.15">同意<br><input name="c33" type="radio" data-x="0" data-y="0.255">强烈同意<br></li><li>没有野蛮人和文明人，只有不同的文化。<br><input name="c34" type="radio" data-x="0" data-y="0.23" checked>强烈反对<br><input name="c34" type="radio" data-x="0" data-y="0.175">反对<br><input name="c34" type="radio" data-x="0" data-y="-0.13">同意<br><input name="c34" type="radio" data-x="0" data-y="-0.23">强烈同意<br></li><li>那些有能力工作却拒绝工作机会的人，不应该接受社会的资助。<br><input name="c35" type="radio" data-x="0" data-y="-0.23" checked>强烈反对<br><input name="c35" type="radio" data-x="0" data-y="-0.13">反对<br><input name="c35" type="radio" data-x="0" data-y="0.13">同意<br><input name="c35" type="radio" data-x="0" data-y="0.23">强烈同意<br></li><li>当你遇到困难时，最好不要去想它，而是不断地做令人高兴的事。<br><input name="c36" type="radio" data-x="0" data-y="-0.2" checked>强烈反对<br><input name="c36" type="radio" data-x="0" data-y="-0.1">反对<br><input name="c36" type="radio" data-x="0" data-y="0.11">同意<br><input name="c36" type="radio" data-x="0" data-y="0.21">强烈同意<br></li><li>第一代移民永远无法完全融入他们的新国家。<br><input name="c37" type="radio" data-x="0" data-y="-0.23" checked>强烈反对<br><input name="c37" type="radio" data-x="0" data-y="-0.075">反对<br><input name="c37" type="radio" data-x="0" data-y="0.13">同意<br><input name="c37" type="radio" data-x="0" data-y="0.23">强烈同意<br></li><li>有利于最成功的企业的事物，最终也总是有利于我们大家的。<br><input name="c38" type="radio" data-x="-0.5" data-y="0" checked>强烈反对<br><input name="c38" type="radio" data-x="-0.25" data-y="0">反对<br><input name="c38" type="radio" data-x="0.75" data-y="0">同意<br><input name="c38" type="radio" data-x="0.875" data-y="0">强烈同意<br></li><li>任何广播电视机构，无论它的内容有多独立，都不应该接受公共资金的支持。<br><input name="c39" type="radio" data-x="-0.5" data-y="0" checked>强烈反对<br><input name="c39" type="radio" data-x="-0.375" data-y="0">反对<br><input name="c39" type="radio" data-x="0.125" data-y="0">同意<br><input name="c39" type="radio" data-x="0.25" data-y="0">强烈同意<br></li></ol><p><strong>第四部分</strong>：你如何看待更广阔的社会。</p><p><ol><li>在反恐的名义下，公民自由被过度限制了。<br><input name="c40" type="radio" data-x="0" data-y="0.26" checked>强烈反对<br><input name="c40" type="radio" data-x="0" data-y="0.155">反对<br><input name="c40" type="radio" data-x="0" data-y="-0.1">同意<br><input name="c40" type="radio" data-x="0" data-y="-0.255">强烈同意<br></li><li>一党制国家的一个显著优点是它避免了在民主政体中耽误发展的所有那些争论。<br><input name="c41" type="radio" data-x="0" data-y="-0.29" checked>强烈反对<br><input name="c41" type="radio" data-x="0" data-y="-0.135">反对<br><input name="c41" type="radio" data-x="0" data-y="0.17">同意<br><input name="c41" type="radio" data-x="0" data-y="0.275">强烈同意<br></li><li>尽管在电子时代官方的监听更容易了，但只有坏人才需要对此担忧。<br><input name="c42" type="radio" data-x="0" data-y="-0.26" checked>强烈反对<br><input name="c42" type="radio" data-x="0" data-y="-0.155">反对<br><input name="c42" type="radio" data-x="0" data-y="0.15">同意<br><input name="c42" type="radio" data-x="0" data-y="0.255">强烈同意<br></li><li>对罪大恶极的犯罪分子，死刑不失为一种选项。<br><input name="c43" type="radio" data-x="0" data-y="-0.26" checked>强烈反对<br><input name="c43" type="radio" data-x="0" data-y="-0.155">反对<br><input name="c43" type="radio" data-x="0" data-y="0.15">同意<br><input name="c43" type="radio" data-x="0" data-y="0.255">强烈同意<br></li><li>在一个文明社会，一个人必须遵从上级、命令下级。<br><input name="c44" type="radio" data-x="0" data-y="-0.2" checked>强烈反对<br><input name="c44" type="radio" data-x="0" data-y="-0.1">反对<br><input name="c44" type="radio" data-x="0" data-y="0.11">同意<br><input name="c44" type="radio" data-x="0" data-y="0.21">强烈同意<br></li><li>那些什么也没有表达的抽象艺术根本就不应该被称为艺术。<br><input name="c45" type="radio" data-x="0" data-y="-0.26" checked>强烈反对<br><input name="c45" type="radio" data-x="0" data-y="-0.155">反对<br><input name="c45" type="radio" data-x="0" data-y="0.15">同意<br><input name="c45" type="radio" data-x="0" data-y="0.255">强烈同意<br></li><li>在刑事审判中，惩罚比改造更重要。<br><input name="c46" type="radio" data-x="0" data-y="-0.23" checked>强烈反对<br><input name="c46" type="radio" data-x="0" data-y="-0.13">反对<br><input name="c46" type="radio" data-x="0" data-y="0.13">同意<br><input name="c46" type="radio" data-x="0" data-y="0.23">强烈同意<br></li><li>改造有些犯罪分子就是浪费时间。<br><input name="c47" type="radio" data-x="0" data-y="-0.26" checked>强烈反对<br><input name="c47" type="radio" data-x="0" data-y="-0.155">反对<br><input name="c47" type="radio" data-x="0" data-y="0.15">同意<br><input name="c47" type="radio" data-x="0" data-y="0.255">强烈同意<br></li><li>商人和制造业者比作家和艺术家更重要。<br><input name="c48" type="radio" data-x="0" data-y="-0.18" checked>强烈反对<br><input name="c48" type="radio" data-x="0" data-y="-0.08">反对<br><input name="c48" type="radio" data-x="0" data-y="0.08">同意<br><input name="c48" type="radio" data-x="0" data-y="0.18">强烈同意<br></li><li>母亲们可以有职业，但她们的首要职责是家庭主妇。<br><input name="c49" type="radio" data-x="0" data-y="-0.23" checked>强烈反对<br><input name="c49" type="radio" data-x="0" data-y="-0.13">反对<br><input name="c49" type="radio" data-x="0" data-y="0.13">同意<br><input name="c49" type="radio" data-x="0" data-y="0.23">强烈同意<br></li><li>跨国公司正在不道德地开发发展中国家的植物基因资源。<br><input name="c50" type="radio" data-x="0" data-y="0.23" checked>强烈反对<br><input name="c50" type="radio" data-x="0" data-y="0.13">反对<br><input name="c50" type="radio" data-x="0" data-y="-0.13">同意<br><input name="c50" type="radio" data-x="0" data-y="-0.23">强烈同意<br></li><li>同现有体制和谐相处是成熟的重要一方面。<br><input name="c51" type="radio" data-x="0" data-y="-0.2" checked>强烈反对<br><input name="c51" type="radio" data-x="0" data-y="-0.1">反对<br><input name="c51" type="radio" data-x="0" data-y="0.11">同意<br><input name="c51" type="radio" data-x="0" data-y="0.21">强烈同意<br></li></ol></p><p><strong>第五部分</strong>：关于宗教。</p><p><ol><li>占星术精确地解释了很多东西。<br><input name="c52" type="radio" data-x="0" data-y="-0.23" checked>强烈反对<br><input name="c52" type="radio" data-x="0" data-y="-0.13">反对<br><input name="c52" type="radio" data-x="0" data-y="0.13">同意<br><input name="c52" type="radio" data-x="0" data-y="0.23">强烈同意<br></li><li>你如果不信宗教就不可能道德。<br><input name="c53" type="radio" data-x="0" data-y="-0.2" checked>强烈反对<br><input name="c53" type="radio" data-x="0" data-y="-0.1">反对<br><input name="c53" type="radio" data-x="0" data-y="0.11">同意<br><input name="c53" type="radio" data-x="0" data-y="0.21">强烈同意<br></li><li>慈善捐助在帮助真正的弱势群体时做得比社会保障要好。<br><input name="c54" type="radio" data-x="-0.5" data-y="0" checked>强烈反对<br><input name="c54" type="radio" data-x="-0.375" data-y="0">反对<br><input name="c54" type="radio" data-x="0.625" data-y="0">同意<br><input name="c54" type="radio" data-x="0.75" data-y="0">强烈同意<br></li><li>有些人天生不走运。<br><input name="c55" type="radio" data-x="0" data-y="-0.23" checked>强烈反对<br><input name="c55" type="radio" data-x="0" data-y="-0.13">反对<br><input name="c55" type="radio" data-x="0" data-y="0.13">同意<br><input name="c55" type="radio" data-x="0" data-y="0.23">强烈同意<br></li><li>我孩子的学校向他传授宗教价值观，这点非常重要。<br><input name="c56" type="radio" data-x="0" data-y="-0.2" checked>强烈反对<br><input name="c56" type="radio" data-x="0" data-y="-0.1">反对<br><input name="c56" type="radio" data-x="0" data-y="0.11">同意<br><input name="c56" type="radio" data-x="0" data-y="0.21">强烈同意<br></li></ol></p><p><strong>第六部分</strong>：关于性。</p><ol><li>婚姻之外的性是不道德的。<br><input name="c57" type="radio" data-x="0" data-y="-0.23" checked>强烈反对<br><input name="c57" type="radio" data-x="0" data-y="-0.175">反对<br><input name="c57" type="radio" data-x="0" data-y="0.13">同意<br><input name="c57" type="radio" data-x="0" data-y="0.23">强烈同意<br></li><li>一对稳定、相爱的同性伴侣，应有收养孩子的权利。<br><input name="c58" type="radio" data-x="0" data-y="0.23" checked>强烈反对<br><input name="c58" type="radio" data-x="0" data-y="0.175">反对<br><input name="c58" type="radio" data-x="0" data-y="-0.13">同意<br><input name="c58" type="radio" data-x="0" data-y="-0.23">强烈同意<br></li><li>由成年人自愿演出的色情影视应该对成人合法化。<br><input name="c59" type="radio" data-x="0" data-y="0.23" checked>强烈反对<br><input name="c59" type="radio" data-x="0" data-y="0.13">反对<br><input name="c59" type="radio" data-x="0" data-y="-0.13">同意<br><input name="c59" type="radio" data-x="0" data-y="-0.23">强烈同意<br></li><li>在私人卧室里两个成年人只见不管做什么，只要是自愿的，国家就管不着。<br><input name="c60" type="radio" data-x="0" data-y="0.26" checked>强烈反对<br><input name="c60" type="radio" data-x="0" data-y="0.155">反对<br><input name="c60" type="radio" data-x="0" data-y="-0.15">同意<br><input name="c60" type="radio" data-x="0" data-y="-0.255">强烈同意<br></li><li>没有人会天生同性恋。<br><input name="c61" type="radio" data-x="0" data-y="-0.26" checked>强烈反对<br><input name="c61" type="radio" data-x="0" data-y="-0.155">反对<br><input name="c61" type="radio" data-x="0" data-y="0.15">同意<br><input name="c61" type="radio" data-x="0" data-y="0.255">强烈同意<br></li><li>社会对性开放并没错，但现在已经开放的过分了。<br><input name="c62" type="radio" data-x="0" data-y="-0.2" checked>强烈反对<br><input name="c62" type="radio" data-x="0" data-y="-0.1">反对<br><input name="c62" type="radio" data-x="0" data-y="0.11">同意<br><input name="c62" type="radio" data-x="0" data-y="0.21">强烈同意<br></li></ol></form><div id="wrapper"><button id="submit" type="button" class="button button-inverse button-rounded">提交</button><br><span id="answer" class="red"></span></div><hr><p>横坐标反映经济观念，负值为左(<a href="https://en.wikipedia.org/wiki/Communism" target="_blank" rel="external">共产主义</a>, <a href="https://en.wikipedia.org/wiki/Collectivism" target="_blank" rel="external">集体主义</a>)，正值为右(<a href="https://en.wikipedia.org/wiki/Neoliberalism" target="_blank" rel="external">新自由主义</a>, <a href="https://en.wikipedia.org/wiki/Libertarianism" target="_blank" rel="external">自由意志主义</a>)。<br>纵坐标反映政治社会观念，负值为自由(<a href="https://en.wikipedia.org/wiki/Anarchism" target="_blank" rel="external">无政府主义</a>, 自由意志论者)，正值为专制或保守(<a href="https://en.wikipedia.org/wiki/Fascism" target="_blank" rel="external">法西斯主义</a>, <a href="https://en.wikipedia.org/wiki/Authoritarianism" target="_blank" rel="external">独裁主义</a>)。</p><p>本测试系统建立于西方政治价值体系基础之上，某些问题强烈的依赖于具体的西方社会环境，未必能够充分反映中国国情。根据周围人群的实验结果，中国人的测试结果普遍位于第三象限（即两坐标均为负值），平均值位于<span class="red">(-2,-2)</span>附近。为了区分中国人习惯意义上的「左与右」，可以以<span class="red">(-2,-2)</span>为坐标原点重新划分坐标平面，即经济坐标小于<span class="red">-2</span>为左，反之为右。政治坐标小于<span class="red">-2</span>为自由，反之为保守或专制。</p><p>下面是著名政治人物的坐标位置以供参考：<br>第一象限（经济右，政治保守）：希特勒，撒切尔夫人，布什，布莱尔，希拉克。<br>第二象限（经济左，政治保守）：斯大林，萨达姆，教皇本笃十四世。<br>第三象限（经济左，政治自由）：甘地，达赖喇嘛，曼德拉。<br>第四象限（经济右，政治自由）：弗里德曼，哈耶克。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;del&gt;没错我玩上瘾了！&lt;/del&gt;&lt;/p&gt;&lt;hr&gt;&lt;p&gt;本测试转载自政治坐标测试北大未名版之&lt;a href=&quot;http://zuobiao.me/~zuobiaom/politicalcompass/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;西方政治坐标系测试&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="杂项" scheme="https://unnamed42.github.io/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="测试" scheme="https://unnamed42.github.io/tags/%E6%B5%8B%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>Hexo 标签用法</title>
    <link href="https://unnamed42.github.io/2016-01-06-Hexo-%E6%A0%87%E7%AD%BE%E7%94%A8%E6%B3%95.html"/>
    <id>https://unnamed42.github.io/2016-01-06-Hexo-标签用法.html</id>
    <published>2016-01-06T10:40:01.000Z</published>
    <updated>2016-10-05T18:17:00.000Z</updated>
    
    <content type="html"><![CDATA[<p>搬运自 <a href="http://Hexo.io" target="_blank" rel="external">Hexo.io</a> 的标签插件使用样例，以及我自己添加的一部分</p><p>UPDATE 2016/3/9: 添加内容“Github标签”</p><a id="more"></a><hr><p>标签插件和 Front-matter 中的标签不同，它们是用于在文章中快速插入特定内容的插件。</p><h2 id="引用块">引用块</h2><p>在文章中插入引言，可包含作者、来源和标题。</p><p><strong>别号：</strong> quote</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% blockquote [author[, source]] [link] [source_link_title] %&#125;</div><div class="line">content</div><div class="line">&#123;% endblockquote %&#125;</div></pre></td></tr></table></figure><h3 id="样例">样例</h3><p><strong>没有提供参数，则只输出普通的 blockquote</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% blockquote %&#125;</div><div class="line">Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque hendrerit lacus ut purus iaculis feugiat. Sed nec tempor elit, quis aliquam neque. Curabitur sed diam eget dolor fermentum semper at eu lorem.</div><div class="line">&#123;% endblockquote %&#125;</div></pre></td></tr></table></figure><blockquote><p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque hendrerit lacus ut purus iaculis feugiat. Sed nec tempor elit, quis aliquam neque. Curabitur sed diam eget dolor fermentum semper at eu lorem.</p></blockquote><p><strong>引用书上的句子</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% blockquote David Levithan, Wide Awake %&#125;</div><div class="line">Do not just seek happiness for yourself. Seek happiness for all. Through kindness. Through mercy.</div><div class="line">&#123;% endblockquote %&#125;</div></pre></td></tr></table></figure><blockquote><p>Do not just seek happiness for yourself. Seek happiness for all. Through kindness. Through mercy.</p><footer><strong>David Levithan</strong><cite>Wide Awake</cite></footer></blockquote><p><strong>引用 Twitter</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% blockquote @DevDocs https://twitter.com/devdocs/status/356095192085962752 %&#125;</div><div class="line">NEW: DevDocs now comes with syntax highlighting. http://devdocs.io</div><div class="line">&#123;% endblockquote %&#125;</div></pre></td></tr></table></figure><blockquote><p>NEW: DevDocs now comes with syntax highlighting. <a href="http://devdocs.io" target="_blank" rel="external">http://devdocs.io</a></p><footer><strong>@DevDocs</strong><cite><a href="https://twitter.com/devdocs/status/356095192085962752" target="_blank" rel="external">twitter.com/devdocs/status/356095192085962752</a></cite></footer></blockquote><p><strong>引用网络上的文章</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% blockquote Seth Godin http://sethgodin.typepad.com/seths_blog/2009/07/welcome-to-island-marketing.html Welcome to Island Marketing %&#125;</div><div class="line">Every interaction is both precious and an opportunity to delight.</div><div class="line">&#123;% endblockquote %&#125;</div></pre></td></tr></table></figure><blockquote><p>Every interaction is both precious and an opportunity to delight.</p><footer><strong>Seth Godin</strong><cite><a href="http://sethgodin.typepad.com/seths_blog/2009/07/welcome-to-island-marketing.html" target="_blank" rel="external">Welcome to Island Marketing</a></cite></footer></blockquote><h2 id="代码块">代码块</h2><p>在文章中插入代码。</p><p><strong>别名：</strong> code</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% codeblock [title] [lang:language] [url] [link text] %&#125;</div><div class="line">code snippet</div><div class="line">&#123;% endcodeblock %&#125;</div></pre></td></tr></table></figure><h3 id="样例-v2">样例</h3><p><strong>普通的代码块</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% codeblock %&#125;</div><div class="line">alert(&apos;Hello World!&apos;);</div><div class="line">&#123;% endcodeblock %&#125;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">alert(&apos;Hello World!&apos;);</div></pre></td></tr></table></figure><p><strong>指定语言</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% codeblock lang:objc %&#125;</div><div class="line">[rectangle setX: 10 y: 10 width: 20 height: 20];</div><div class="line">&#123;% endcodeblock %&#125;</div></pre></td></tr></table></figure><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[rectangle setX: <span class="number">10</span> y: <span class="number">10</span> width: <span class="number">20</span> height: <span class="number">20</span>];</div></pre></td></tr></table></figure><p><strong>附加说明</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% codeblock Array.map %&#125;</div><div class="line">array.map(callback[, thisArg])</div><div class="line">&#123;% endcodeblock %&#125;</div></pre></td></tr></table></figure><figure class="highlight plain"><figcaption><span>Array.map</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">array.map(callback[, thisArg])</div></pre></td></tr></table></figure><p><strong>附加说明和网址</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&#123;% codeblock _.compact http://underscorejs.org/#compact Underscore.js %&#125;</div><div class="line">_.compact([0, 1, false, 2, &apos;&apos;, 3]);</div><div class="line">=&gt; [1, 2, 3]</div><div class="line">&#123;% endcodeblock %&#125;</div></pre></td></tr></table></figure><figure class="highlight plain"><figcaption><span>_.compact</span><a href="http://underscorejs.org/#compact" target="_blank" rel="external">Underscore.js</a></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">_.compact([0, 1, false, 2, &apos;&apos;, 3]);</div><div class="line">=&gt; [1, 2, 3]</div></pre></td></tr></table></figure><h2 id="反引号代码块">反引号代码块</h2><p>另一种形式的代码块，不同的是它使用三个反引号来包裹。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">``` [language] [title] [url] [link text]</div><div class="line">code snippet</div><div class="line">```</div></pre></td></tr></table></figure><h2 id="pull-quote">Pull Quote</h2><p>在文章中插入 Pull quote。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% pullquote [class] %&#125;</div><div class="line">content</div><div class="line">&#123;% endpullquote %&#125;</div></pre></td></tr></table></figure><h2 id="jsfiddle">jsFiddle</h2><p>在文章中嵌入 jsFiddle。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% jsfiddle shorttag [tabs] [skin] [width] [height] %&#125;</div></pre></td></tr></table></figure><h2 id="gist">Gist</h2><p>在文章中嵌入 Gist。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% gist gist_id [filename] %&#125;</div></pre></td></tr></table></figure><h2 id="iframe">iframe</h2><p>在文章中插入 iframe。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% iframe url [width] [height] %&#125;</div></pre></td></tr></table></figure><h2 id="image">Image</h2><p>在文章中插入指定大小的图片。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% img [class names] /path/to/image [width] [height] [title text [alt text]] %&#125;</div></pre></td></tr></table></figure><h2 id="link">Link</h2><p>在文章中插入链接，并自动给外部链接添加 <code>target=&quot;_blank&quot;</code> 属性。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% link text url [external] [title] %&#125;</div></pre></td></tr></table></figure><h2 id="include-code">Include Code</h2><p>插入 <code>source</code> 文件夹内的代码文件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% include_code [title] [lang:language] path/to/file %&#125;</div></pre></td></tr></table></figure><h2 id="youtube">Youtube</h2><p>在文章中插入 Youtube 视频。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% youtube video_id %&#125;</div></pre></td></tr></table></figure><h2 id="vimeo">Vimeo</h2><p>在文章中插入 Vimeo 视频。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% vimeo video_id %&#125;</div></pre></td></tr></table></figure><h2 id="引用文章">引用文章</h2><p>引用其他文章的链接。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123;% post_path slug %&#125;</div><div class="line">&#123;% post_link slug [title] %&#125;</div></pre></td></tr></table></figure><h2 id="引用资源">引用资源</h2><p>引用文章的资源。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% asset_path slug %&#125;</div><div class="line">&#123;% asset_img slug [title] %&#125;</div><div class="line">&#123;% asset_link slug [title] %&#125;</div></pre></td></tr></table></figure><h2 id="raw">Raw</h2><p>如果您想在文章中插入 Swig 标签，可以尝试使用 Raw 标签，以免发生解析异常。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% raw %&#125;</div><div class="line">content</div><div class="line">&#123;% endraw %&#125;</div></pre></td></tr></table></figure><hr><p>以上内容搬运自<a href="https://raw.githubusercontent.com/hexojs/site/master/source/zh-cn/docs/tag-plugins.md" target="_blank" rel="external">hexo官方文档</a></p><hr><h2 id="mathjax">MathJax</h2><p>插入利用MathJax显示的数学公式，需要安装<code>hexo-math</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;% math %&#125;</div><div class="line">\begin&#123;aligned&#125;</div><div class="line">\dot&#123;x&#125; &amp; = \sigma(y-x) \\</div><div class="line">\dot&#123;y&#125; &amp; = \rho x - y - xz \\</div><div class="line">\dot&#123;z&#125; &amp; = -\beta z + xy</div><div class="line">\end&#123;aligned&#125;</div><div class="line">&#123;% endmath %&#125;</div></pre></td></tr></table></figure><p>$$ \begin{aligned} \dot{x} &amp; = \sigma(y-x) \ \dot{y} &amp; = \rho x - y - xz \ \dot{z} &amp; = -\beta z + xy \end{aligned} $$</p><h2 id="github标签">Github标签</h2><p>插入Github repo的内容，需要安装<code>hexo-github</code>.</p><p>用法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% github user repo referenced_commit [auto_expand = true | false] [width = 100%] %&#125;</div></pre></td></tr></table></figure><p>解释：</p><table><thead><tr><th style="text-align:center">参数</th><th>描述</th></tr></thead><tbody><tr><td style="text-align:center">user</td><td>Github用户名</td></tr><tr><td style="text-align:center">repo</td><td>该用户的repo名</td></tr><tr><td style="text-align:center">commit</td><td>commit的sha1码值</td></tr><tr><td style="text-align:center">auto_expand</td><td>（可选，默认为false）同步后更新timeline</td></tr><tr><td style="text-align:center">width</td><td>（可选，默认100%）控件的宽度，应为一个合法的CSS宽度值</td></tr></tbody></table><p>举例：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% github akfish hexo-math b82e65 %&#125;</div></pre></td></tr></table></figure><div id="badge-container-akfish-hexo-math-b82e65" class="hexo-github" style="width:100%"></div><script src="/hexo-github/badge.js"></script><script type="text/javascript">loadStyle("/hexo-github/style.css"),loadStyle("/hexo-github/octicons/octicons.css"),new Badge("#badge-container-akfish-hexo-math-b82e65","akfish","hexo-math","b82e65",!1)</script><h2 id="bilibili-视频">Bilibili 视频</h2><p>插入来自bilibili的视频，需要安装<code>hexo-tag-bilibili</code>.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&#123;% bilibili [av_id] %&#125;</div><div class="line">or</div><div class="line">&#123;% bilibili [av_id] [page] %&#125;</div></pre></td></tr></table></figure><h2 id="ruby-character-tag">Ruby character tag</h2><p>Ruby标签，需要安装<code>hexo-ruby-character</code>.</p><p><strong>英文</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% ruby Base|top %&#125;</div></pre></td></tr></table></figure><ruby>Base<rp>(</rp><rt>top</rt><rp>)</rp></ruby><p><strong>中文+拼音</strong></p><p>在top域里写中文会被自动转换成拼音。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% ruby 佐天泪子|掀裙狂魔 %&#125;</div></pre></td></tr></table></figure><ruby>佐天泪子<rp>(</rp><rt>xiān qún kuáng mó</rt><rp>)</rp></ruby><p><strong>其他CJK字符</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;% ruby 超電磁砲|レールガン %&#125;</div></pre></td></tr></table></figure><ruby>超電磁砲<rp>(</rp><rt>レールガン</rt><rp>)</rp></ruby>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;搬运自 &lt;a href=&quot;http://Hexo.io&quot;&gt;Hexo.io&lt;/a&gt; 的标签插件使用样例，以及我自己添加的一部分&lt;/p&gt;&lt;p&gt;UPDATE 2016/3/9: 添加内容“Github标签”&lt;/p&gt;
    
    </summary>
    
      <category term="学习" scheme="https://unnamed42.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
      <category term="Hexo" scheme="https://unnamed42.github.io/tags/Hexo/"/>
    
      <category term="插件" scheme="https://unnamed42.github.io/tags/%E6%8F%92%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>DnD非官方版阵营测试</title>
    <link href="https://unnamed42.github.io/2016-01-05-DnD%E9%9D%9E%E5%AE%98%E6%96%B9%E7%89%88%E9%98%B5%E8%90%A5%E6%B5%8B%E8%AF%95.html"/>
    <id>https://unnamed42.github.io/2016-01-05-DnD非官方版阵营测试.html</id>
    <published>2016-01-05T12:14:13.000Z</published>
    <updated>2016-09-25T17:09:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>由于<a href="http://www.wizards.com/default.asp?x=dnd%2Fdnd%2F20001222b" target="_blank" rel="external">官方版</a>的测试规则我还不清楚，因此只能退而求其次找了个替代版，至少我测试起来在官方版和这个版本里是一样的结果。同时，我也是第一次使用JavaScript(之前完全没摸过……)，因此效果会有点渣，希望各位不要介意。</p><p>UPDATE 2016/06/23: 参考<a href="http://maokwen.tk/2016/06/23/mbti/" target="_blank" rel="external">此处</a>更改了结果显示的方式，告别了alert</p><p>UPDATE 2016/06/28: 使用jQuery大幅改进了脚本</p><a id="more"></a><hr><p>测试转载自<a href="http://www.360doc.com/content/13/0511/22/175820_284689475.shtml" target="_blank" rel="external">此</a>，不代表本人任何观点。</p><hr><p>回答下面的问题时，最好把自己代入，然后凭自己的第一感觉去回答，不要想当然地就认为自己会怎么怎么样，有好多事情，我告诉你，你其实做不来滴。嘻嘻……</p><form id="questions"><script type="text/javascript">$(document).ready(function(){$("#submit").click(function(){var p=0,a=0;$("#questions input[name^='q']:checked").each(function(){p+=parseInt($(this).val())}),$("#questions input[name^='p']:checked").each(function(){a+=parseInt($(this).val())}),p=p<8?3:p>16?1:2,a=a<11?3:a>15?1:2;var e="<hr><h3>您的测试结果为：";switch(10*p+a){case 11:e+="Lawful Good 守序善良</h3><p>守序善良的人按照一个好人应该或必须遵循的方式行动。他致力于与邪恶斗争，惩罚邪恶决不宽容。他说真话，守承诺，帮助需要帮助的人，伸张正义直言不公。守序善良的人不喜欢看见有罪者不受惩罚。例如一位面对罪恶挺身而出的圣骑士就是守序善良的代表人物。守序善良是结合了荣誉感和同情心的阵营。已经不能用善良来形容阁下了，也许正义才是最好的形容词，您就是生活在现在的骑士，正气十足，疾恶如仇。可以认真的执行每一件事，可靠，值得信任。</p><p>忠告：不过～您知道吗，骑士在古代是死亡率相当高的一种职业！如果您对很多东西过于较真，会失去很多生活的乐趣，而且水至清则无鱼，多和朋友沟通一下，随和一些，让自己多放松一下，您的预期寿命会大大地延长的。</p>";break;case 21:e+="Neutral Good 中立善良</h3><p>中立善良者尽其所能做着一个好人能做的事情。他致力于帮助别人。他配合国王和大臣们的工作，但并不感到蒙恩于其。中立善良的寻常称谓是“真正善良”。一位根据他人需要施以援助的牧师就是中立善良的代表。中立善良是不带偏见或不违反信念去行善的阵营。<p>同志啊～～表误会，港湾只是想说我们是一个阵营的而已！尽自己的能力帮助他人，是令这个阵营的人显得可爱的一大特点。当然，和LG那些家伙们不同的是，当我们力不能及的时候，我们一般不会干出牺牲自己的蠢事。我们也很少考虑什么社会的进步之类的大问题，我们就帮助身边随手可及的，简单而快乐地活着，顺便作着“好人有好报”的白日梦！</p><p>忠告：帮助别人之前要稍微谨慎一些，这个阵营上当受骗的比率是所有阵营之最，虽然真正被骗得很惨的都是LE的家伙们。</p>";break;case 31:e+="Chaotic Good 混乱善良</h3><p>混乱善良的人按照自己的良心行动，极少考虑别人对他的规范和要求。他以自己的方式处事，但却善良友好且乐善好施。他相信善良及正义，不过认为法律和规章没什么用处，并且憎恨那些胁迫并命令别人的人。他尊序自己的道德准则，这些准则虽然是良善的，但却可能与社会上的准则不相一致。一位劫富济贫的侠盗就属于混乱善良阵营。混乱善良是结合了善良心灵和自由精神的阵营。美丽心灵和令人头疼的个性的结合体。十足的性格令他们不会那么老实地循规蹈矩。说话也常常是一点也不留口德，有的时候也会捉弄一下自己的朋友，总之是充满了创意和活力的一群人。</p><p>忠告：虽然有一颗豆腐心，但是刀子嘴有的时候还是挺可怕的。还有，有的时候还是要稍微尊重一下权威的……</p>";break;case 12:e+="Lawful Neutral 守序中立</h3><p>守序中立的人行动时遵从法律、传统或个人信条的指导。秩序和组织对他来说至关重要。他也许信仰某些私人法则，并按某种信条或道德标准生活；他也可能信仰适用于所有人的秩序，并且喜欢稳固强大有组织的政府。一位按照命令毫不留情地拷问罪犯的狱卒就属于守序中立阵营。守序中立的寻常称谓是“真正守序”，是注重荣誉却不狂热盲目的阵营。《80天环绕地球》里面的主人公一开始就是那样的人，还有那些特别遵从纪律和法令的人。你相信总结出规矩并让大多数人都遵守的规矩可以使你的生活更加的轻松，即使这些规矩对你带来的些许的不便，你也认为与他们相比带来的好处可以忽略不及。</p><p>忠告：大哥，军队的生活最适合你这种人了。不过个性这种东西还是最好发扬一下，要是淹没到了人群中，有的时候也不是那么理想呢。当然如果你只是想做“革命机器上的一颗螺丝钉”我也不好说什么了，不过还是建议你看看梦工厂的《A.NT Z》</p>";break;case 22:e+="True Neutral 绝对中立</h3><p>大部分绝对中立者是因其没有特别的坚信和偏爱而成中立。在善良与邪恶、秩序与混乱之间他们并不特别遵循其中某一者，但他们并不致力于维持事物中立的状态。这样的人认为善良比邪恶要好，他们也更愿意有善良而非邪恶的邻居和统治者。尽管如此，他却并不承诺在任何情况或全体方式中亲身支援良善。另一方面，某些绝对中立的人物委身于中庸的哲学观点。他们认为善良、邪恶、秩序、混乱都是偏见和危险的极端观点。他们提倡中立之路，认为从长远看它是最好最平衡的道路。绝对中立是行动自然不持偏见强迫的阵营。其实绝对中立不是TN，不过反正你也不在乎，处在这个阵营的，不是随风飘舞的墙头草，就是超然世外的高人。走自己的路，让别人去说吧。唉，反正人数非常的少……</p><p>忠告：这种阵营的人一般不需要什么忠告，他们可以很自由地转换到其他的阵营去！</p>";break;case 32:e+="Chaotic Neutral 混乱中立</h3><p>混乱中立的人按自己一时的兴致行动。他是一个完全的个人主义者。他重视自己的自由权利，但并不致力于保护别人的自由。他蔑视权威，愤恨约束并且挑战传统，但他不会向无政府运动那样有意瓦解组织。如果这么做，他必须把自己的阵营转成善良(希望解放他人)或是邪恶(使异己受苦)。不过，混乱中立者的行为也许很难预测，但他的举止并非完全随机的，他从桥上走过去的可能性和从桥上跳下去的可能性大小并不相等。一位靠着自己的小聪明来谋生的吟游诗人就属于混乱中立阵营。混乱中立的寻常称谓是“真正无序”，是真正自由于社会约束和对改良社会有着空想的阵营，追求自由，奔放。毕竟人生到这个世界上不是为了受苦的，而是为了享受和创造的。相信这是这个阵营绝大多数人的心声吧？不会循规蹈矩，也不会束缚自己，挺好的生活方式呢！</p><p>忠告：多练练怎么与人配合吧，现在的社会对合作要求比较高的，还有就是别干太出格的事。</p>";break;case 13:e+="Lawful Evil 守序邪恶</h3><p>守序邪恶的人有计划地谋求他想要的东西，此行为受到他行为准则的限制，但并不顾忌受其伤害的人。他关心传统、忠诚和秩序，但不关心自由、尊严和生命。他按规则行动，但没有怜悯和同情。他觉得待在统治阶层里很舒服，愿意支配别人，但也乐意为别人服务。他处罚谴责别人并不是根据他们的行为而是根据种族、信仰、祖国或社会阶层。他不愿违反法律或承诺，这种不愿部分是因为他的天性，部分是因为他需要秩序来保护他免受道德上的反对。某些守序邪恶者有特别的禁忌，比如不冷血嗜杀(但让属下去做)或不伤害儿童(如果可能的话)。他们认为这些良心上的原则使自己比一般不合人道的恶人水准高。像一个诡计多端扩展自己势力并压迫领土内平民的贵族就是守序邪恶的绝好代表。某些守序邪恶的人或生物狂热的效忠于邪恶，就好像十字军效忠于良善一样。伤害别人是他们这么做的目的，传播邪恶本身也是他们乐于如此的原因。他们也可能认为行恶是对某种邪恶神明或主人的责任的一部分。守序邪恶是一个有方法有意图并且能常常有所成就的邪恶阵营，为提高自己的地位而不断地努力着，当我有一个朋友告诉我她是LE的时候，真的吓了我一跳，不过后来想想，也没有什么的，挺正常的，毕竟还是遵纪守法的好公民，除了没有什么同情心，稍微冷漠了一点，有一点贪小便宜，也没什么大的毛病了。</p><p>忠告：法律这种东西，不仅仅建立在“合理”的基础上，而且最早地建立在“合情”的基础之上。这个社会的竞争绝对没有你想象的那样残酷，温情还是居多的，好好享受吧！</p>";break;case 23:e+="Neutral Evil 中立邪恶</h3><p>中立邪恶者做任何可能不受或逃脱惩罚的事。他完全为自己着想，眼里只有自身的利益，纯粹而简单。他不在乎被他杀死的人，无论是因为利益、消遣还是便利。他对秩序并无偏爱，但如果遵从法律会使他得利，他就会照做；但如果撕毁协议能使他获得更大的利益，他也会毫不犹豫地背约。那些情报贩子，以及通过抢掠和凶杀来得到他想要的东西的罪犯就是中立邪恶的代表人物。中立邪恶代表着无关对象的邪恶，因此又被称为是“真正邪恶”。价值观其实也没什么的，人类本来就是一个社会性和个体性并存的生物，注重个体的发展也没什么不好的。</p><p>忠告：不过，老大，有的时候也要稍微考虑一下别人的立场吧。忘掉生活中的一些不快，把心放宽，和我一起大声地念：HA.KUNA. MA.TA.TA.</p>";break;case 33:e+="Chaotic Evil 混乱邪恶</h3><p>混乱邪恶的人做任何他的欲望、恨意和破坏欲所驱使他做的事。他性情暴躁、恶毒，独断专行、手段粗暴并且行为无常。他无情残忍，肆无忌惮地夺取任何他可以夺取的东西。这样的人被视作社会的毒瘤。值得庆幸的是，他毫无计划，所有他参加的和形成的群体都组织极差。一般而言，唯有强迫和暴力才能使混乱邪恶的人在一起工作，只有真正的强者才能居于首领地位。而他一旦露出衰弱的迹象，就会被取而代之。一个疯狂追求复仇和破坏的法师就是混乱邪恶的代表人物。混乱邪恶所毁灭的，不仅仅是美丽和生命，而且还有维持着美丽和生命的秩序。老大，有个性，真的非常有个性，你们是所有人中最有创意的一种人了，从某种角度来说，社会是你们所推动的！</p><p>忠告：你们也是不需要忠告的一类人……不过，也许你们再重新认识一下这个社会会比较好一点……</p>"}$("#result").html(e)})})</script><p><strong>第一卷</strong></p><ol><li>当年，苏格拉底因为他的学说太那个了，被指控为“异端”和“误导年轻人”。长老会审判的结果是让他服毒。其实他当时是可以逃亡的，正如几十年后他的弟子柏拉图所作的那样，那个时候柏拉图面对指控就跑路了。可惜当时苏格拉底认为——遵从法律是一个国家公民应尽的职责和义务，哪怕这个法律现在还有缺陷。所以这个家伙就biu~的一声死掉了。这就是哲学上著名的“苏格拉底之死”。你认为这个家伙：<br><input checked name="q1" type="radio" value="2"> A. 为信念而死，值得敬佩。<br><input name="q1" type="radio" value="1"> B. 信念正确，行为可笑，理想主义得过了头！<br><input name="q1" type="radio" value="0"> C. 他……大脑进水了吗？看来他的学说确实够那个的啦……<br></li><br><li>在法国大革命期间，由于社会的动荡，雅各宾派政权颁发了一条法令，叫《惩治嫌疑犯条例》。这个条例和先进大多数的法律不同的地方是它采用的是“有罪推定”，就是说，如果一个嫌疑人无法证明他是无罪的，那么他就被认定有罪——和现金的“无罪推定”正好相反。结果是在条例的作用之下，社会治安迅速地好转，当然也死了不少无辜的人。所以你认为，在社会状况非常恶化的情况之下，是否应该使用“有罪推定”来改善治安状况？<br><input checked name="q2" type="radio" value="2"> A. 呵呵！有杀错，无放过。保证大多数人的利益最正确！<br><input name="q2" type="radio" value="1"> B. 视情况而定吧，如果情况真的不可收拾，我不反对……<br><input name="q2" type="radio" value="0"> C. 绝对不应以无辜者的鲜血来换来这种恐怖的安宁！<br></li><br><li>“少数服从多数”是现今常用的规则，你认为这样的规则：<br><input checked name="q3" type="radio" value="2"> A. 很好，保障大多数人的利益是非常重要的……<br><input name="q3" type="radio" value="1"> B. 还可以吧，反正我会尽量站在大多数人一边……<br><input name="q3" type="radio" value="0"> C. 不公平！少数人的利益和个性被忽视和掩盖了，而且最糟糕的是，“真理往往在少数人手中”……<br></li><br><li>“伟人之所以伟大，是因为我们都是跪着看他们”……<br><input checked name="q4" type="radio" value="2"> A. 并不是这样，伟人们确实有他们值得敬仰的地方。<br><input name="q4" type="radio" value="1"> B. 不太清楚，这句话有一定的道理吧？<br><input name="q4" type="radio" value="0"> C. 我也可以成为伟人的，其实成功并不是那么的遥不可及……<br></li><br><li>“二战中犯下战争罪行的德军士兵辩解说，是命令让他那么作的，如果他不执行命令，就会被军法处置，你认为这些士兵："<br><input checked name="q5" type="radio" value="2"> A. 情有可原，身为小兵其实挺无奈的。但是下命令的那个混蛋真他妈的该死。<br><input name="q5" type="radio" value="1"> B. 我也不太清楚，也不想体会那种情景<br><input name="q5" type="radio" value="0"> C. 任何有独立思想的成年人都不能以命令为借口为自己的行为进行推脱。（这也是国际法中明确说明的！）<br></li><br><li>“当你处在一个十字路口，面前是红灯，但是你前面却没有一辆车通行，你是否会穿越红灯呢？"<br><input checked name="q6" type="radio" value="2"> A. 绝对不会！我会严格遵守交通规则！<br><input name="q6" type="radio" value="1"> B. 有急事的时候会过去。<br><input name="q6" type="radio" value="0"> C. 规矩是死的，人是活的……<br></li><br><li>“当病人生不如死的时候，他提出安乐死，如果你是医生，你是否会帮助他？"<br><input checked name="q7" type="radio" value="2"> A. 这是犯罪！我不会杀人的！<br><input name="q7" type="radio" value="1"> B. 说不好……<br><input name="q7" type="radio" value="0"> C. 我会尽可能地帮助他。<br></li><br><li>“当你的好朋友沉浸在一项不好的生活，比如说网络游戏中，你想要劝她，你会怎么样？"<br><input checked name="q8" type="radio" value="2"> A. 好言相劝，毕竟是朋友。<br><input name="q8" type="radio" value="1"> B. 不知道！<br><input name="q8" type="radio" value="0"> C. 狠狠地骂她一顿，好好地刺激她一下，要不就打醒她！喝！<br></li><br><li>“你和你的朋友之间有了某个误会，如果你把真相说出来，她一定会非常的自责，但是如果你不说出真相，你自己又觉得非常的委屈："<br><input checked name="q9" type="radio" value="2"> A. 我忍，习惯了就好了！<br><input name="q9" type="radio" value="1"> B. 随遇而安，有可能真相被别人先说出来呢！<br><input name="q9" type="radio" value="0"> C. 绝不能让自己受到委屈，让她内疚而死吧……<br></li><br><li>“当你发现你和其他人的意见都不大相同的时候，你会："<br><input checked name="q10" type="radio" value="2"> A. 反复检查自己的意见，看看自己的意见是不是有什么问题。<br><input name="q10" type="radio" value="1"> B. 当作什么也没有发生好了<br><input name="q10" type="radio" value="0"> C. 他们全都错了，我是正确的！<br></li><br><li>““只要动机是好的，手段无所谓。”你是否赞同这句话？"<br><input checked name="q11" type="radio" value="2"> A. 你疯了吗，那样子会天下大乱的！<br><input name="q11" type="radio" value="1"> B. 有的时候稍微地犯规一下也没有什么的。<br><input name="q11" type="radio" value="0"> C. 本来就是这个样子的嘛！<br></li><br><li>“发生雪崩了，有两个人被困在了山上，发动n多人去搜救，可是这个时候，山上仍然有危险，可能会让更多的人遇险。如果你是总指挥，你可以接受多少人因为营救这两个人而送命？"<br><input checked name="q12" type="radio" value="2"> A. 嗯，你们安息吧，我不能因为两个人，而把几百号人置于危险之中。<br><input name="q12" type="radio" value="1"> B. 大家小心点，注意自己的安全，如果有人出现伤亡，马上就闪……<br><input name="q12" type="radio" value="0"> C. 每一个人的生命都是无价的，要不惜一切的代价……（美国大片里面的常见台词）<br></li><br><li>“城管和联合执法的在驱除道边上卖红薯的小贩，你会认为："<br><input checked name="q13" type="radio" value="2"> A. 维护市容，就应该这样！<br><input name="q13" type="radio" value="1"> B. 与我无关！<br><input name="q13" type="radio" value="0"> C. 人家也要糊口啊，挺可怜的呢！<br></li></ol><p><strong>第二卷</strong></p><ol><li>“你是否曾经无缘无故地欺负过小动物？（男生请从十岁之后开始计算。）"<br><input checked name="p1" type="radio" value="2"> A. 决不，我从来没有这么干过。<br><input name="p1" type="radio" value="1"> B. 有的时候心情不好，就会……不过一般我还是反对这么干的……<br><input name="p1" type="radio" value="0"> C. 我擅长用放大镜烧死蚂蚁，捕捉蜻蜓，走到道边看见狗都想踢两脚，当然不是太大的那种！<br></li><br><li>“曹操著名的那句“宁可我负天下人，不教天下人负我。”<br><input checked name="p2" type="radio" value="2"> A. 太偏激了<br><input name="p2" type="radio" value="1"> B. 有的时候，为了自保，也无可厚非，但是把这个东西当成信念就有点太那个啦……<br><input name="p2" type="radio" value="0"> C. 哼哼，这个世界本来就是那样的，人不为己，天诛地灭。<br></li><br><li>“你认为复仇和宽恕哪一个更加合适？"<br><input checked name="p3" type="radio" value="2"> A. 宽恕是美德，怨怨向报何时了<br><input name="p3" type="radio" value="1"> B. 不知道，希望不会发生这种事情<br><input name="p3" type="radio" value="0"> C. 宽恕是纵容，正是因为有了这么多虚伪的家伙，才会有越来越多的无法无天的家伙，敢惹我的，我十倍与之！<br></li><br><li>“当你因为某种原因陷入重大失败，进入人生的低潮时，你会怎么想："<br><input checked name="p4" type="radio" value="2"> A. 是我的实力还不够强，基本上是我自己的责任。<br><input name="p4" type="radio" value="1"> B. 非吾不能，天亡吾也！<br><input name="p4" type="radio" value="0"> C. 都是他们这些小人，处处算计于我，真该死～～～～～～～～～～～～～～～<br></li><br><li>“如果你以前被乞丐（假）骗过钱，你是否还会再看见乞丐，或者有人向你寻求帮助（要几块钱什么的，现在挺常见的），你是否会给予帮助？"<br><input checked name="p5" type="radio" value="2"> A. 万一那个人确实需要帮助呢？我不能因为以前别人骗了我就拒绝帮助一个困境中的人！<br><input name="p5" type="radio" value="1"> B. 我不知道，如果那个人看上去真的非常可怜的话，我可能会给钱的，但我认为他可能是骗子！<br><input name="p5" type="radio" value="0"> C. 滚！你这样的家伙我见得太多了！找民政部门去！<br></li><br><li>“卓别林的戏剧，欧亨利的小说，王尔德的童话，你的感觉是……（别和我说你一个都不知道！）"<br><input checked name="p6" type="radio" value="2"> A. 流泪<br><input name="p6" type="radio" value="1"> B. 大笑<br><input name="p6" type="radio" value="0"> C. 无聊<br></li><br><li>“我们在小学接受的教育都是在公共汽车上要让座，当车上有不应该站着的人站着的时候，如老人，而你是坐着的，你的反映是："<br><input checked name="p7" type="radio" value="2"> A. 假装下车，站起来，用身子挡着座，让该坐的人坐下！<br><input name="p7" type="radio" value="1"> B. 站起来，大声招呼对方坐下，然后虚伪地笑一笑……<br><input name="p7" type="radio" value="0"> C. 象大多数的年轻人一样，让小学的教育被素质教育所代替吧……<br></li><br><li>“当你为一个目标而努力了很久，但是却失败了，而这是你的最好的朋友却成功的时候，你心里酸酸的感觉能持续多久呢？"<br><input checked name="p8" type="radio" value="2"> A. 5分钟，然后真心地为朋友而高兴。<br><input name="p8" type="radio" value="1"> B. 一天，然后和她心存芥蒂。<br><input name="p8" type="radio" value="0"> C. 你们的友谊可能会就此而冲淡！<br></li><br><li>“你给朋友送礼物的时候，一般会："<br><input checked name="p9" type="radio" value="2"> A. 买两份，因为我只送我自己最喜欢的东西，所以自己都忍不住要留一份！<br><input name="p9" type="radio" value="1"> B. 例行公事，没好好考虑过。<br><input name="p9" type="radio" value="0"> C. 把用不到的东西送给别人吧～～～<br></li><br><li>“一个浑身是血而且赃兮兮的人向你求助，你能忍住恶心帮助这个人吗？（学医的话请以自己从医之前的行为做参考。）"<br><input checked name="p10" type="radio" value="2"> A. 义不容辞<br><input name="p10" type="radio" value="1"> B. 有点恶心<br><input name="p10" type="radio" value="0"> C. ～～～～～～～～滚！找别人去！<br></li><br><li>“神灯精灵在你的面前献身，满足你三个愿望。你可能会想到（注意，不是许愿，仅仅是想到）不为你自己的愿望吗？"<br><input checked name="p11" type="radio" value="2"> A. 世界和平？我所关心的人？<br><input name="p11" type="radio" value="1"> B. 在巨大的惊喜面前，大脑一片空白！<br><input name="p11" type="radio" value="0"> C. 正在阐心竭虑计算如何许愿才能让自己的利益最大化！<br></li><br><li>“你认为有可能在人类中消除犯罪吗？"<br><input checked name="p12" type="radio" value="2"> A. 总有一天的，等到……<br><input name="p12" type="radio" value="1"> B. 不知道，谁也所不清，也许有一天“犯罪”这个词的意义会发生改变？<br><input name="p12" type="radio" value="0"> C. 你睡醒了没，是不是有一点发烧？<br></li><br><li>“道边上有一健康成年男子在乞讨，对此你的看法是："<br><input checked name="p13" type="radio" value="2"> A. 是不是有什么迫不得已的情况？<br><input name="p13" type="radio" value="1"> B. 哀其不幸，怒其不争，这是社会的问题，与我无关！<br><input name="p13" type="radio" value="0"> C. 人渣，垃圾，怎么警察也不管一下？<br></li><br><li>“如果三天后就是世界末日，且只有你一个人知道人类世界会在三天之后灭绝了，你会怎么样？"<br><input checked name="p14" type="radio" value="2"> A. 尽自己的可能拯救这个世界，包括让应该知道这个信息的人知道。<br><input name="p14" type="radio" value="1"> B. 用不打扰其他人的方式尽情享受这几天，也一定要结束自己的处女（男）生涯，当然是在不伤害别人的基础上……<br><input name="p14" type="radio" value="0"> C. 哼哼哼哼，别人我管不了了，三天，我要做到无憾的三天，哼哼……（睁着充血的眼睛出去了……）<br></li><br></ol><div align="center"><br><button id="submit" class="button button-inverse button-rounded" type="button">提交</button></div><div id="result"></div></form>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;由于&lt;a href=&quot;http://www.wizards.com/default.asp?x=dnd%2Fdnd%2F20001222b&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官方版&lt;/a&gt;的测试规则我还不清楚，因此只能退而求其次找了个替代版，至少我测试起来在官方版和这个版本里是一样的结果。同时，我也是第一次使用JavaScript(之前完全没摸过……)，因此效果会有点渣，希望各位不要介意。&lt;/p&gt;&lt;p&gt;UPDATE 2016/06/23: 参考&lt;a href=&quot;http://maokwen.tk/2016/06/23/mbti/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;此处&lt;/a&gt;更改了结果显示的方式，告别了alert&lt;/p&gt;&lt;p&gt;UPDATE 2016/06/28: 使用jQuery大幅改进了脚本&lt;/p&gt;
    
    </summary>
    
      <category term="杂项" scheme="https://unnamed42.github.io/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="测试" scheme="https://unnamed42.github.io/tags/%E6%B5%8B%E8%AF%95/"/>
    
      <category term="DnD" scheme="https://unnamed42.github.io/tags/DnD/"/>
    
  </entry>
  
  <entry>
    <title>随笔杂谈</title>
    <link href="https://unnamed42.github.io/2015-12-23-%E9%9A%8F%E7%AC%94%E6%9D%82%E8%B0%88.html"/>
    <id>https://unnamed42.github.io/2015-12-23-随笔杂谈.html</id>
    <published>2015-12-23T04:46:39.000Z</published>
    <updated>2016-10-05T18:17:26.000Z</updated>
    
    <content type="html"><![CDATA[<p>曾经多次，在夜深人静适合一个人思考钻死胡同的时候，酝酿过写这么个东西的想法；可惜这种想法往往不能留存过夜。第二天一觉起来神清气爽，似乎所有烦恼与抑郁症状都不翼而飞了，这种想法也就随之消散在脑海里，化作飞灰。但大量飞灰也有沉积起来形成星体的时候，于是你们现在看到了这份鬼话连篇的随笔杂谈。</p><a id="more"></a><p>在夜里，一个人独自思考，比较容易钻死胡同，积聚大量的负面情绪。此时只有你一个人独自徜徉在精神的海洋里，无论是捕捞到了五彩缤纷的海洋特产还是抽筋溺水一命呜呼都只有你一个人知道，所有的收获与损失都只能压积在心底，除非你精神分裂有另一个你和你一同嬉戏。但这是打发睡前漫长时间的方法，我乐此不疲。</p><p>说了这么多，就是想说这些东西堆积在我脑海里很久了，久到不吐不快的地步。自认优雅乃是行为准则的我自然不好去叨扰别人向他/她/它倾倒我积累起来的苦水，现在还没有谁能让我放心对其倾诉的地步，因为我觉得我肯定会在对方那里获得一个“你丫谁啊”的评价（在此诚征女朋友一名）。既然如此我就放在这里罢，当做是一次我自己对自己的谈话。</p><p>事情要从高考那时候说起：当时因为奇怪过敏病症躺在医院里的我，拿起手机向教育机构发起了查询请求，然后获得了一个令人心痛的590. 虽然我自己并不清楚自己能爬到什么样的高度，但我觉得590是不能够描述它的。看到590的我，感到浑身一麻：完了。</p><p>其实对这样的结果我早有预感：我没能评析诗经，语文自然不会好好评析我；我因为带有绝对值的数列递推而手忙脚乱，数学自然也不会给我好脸色看。怎么样呢？590，咎由自取。</p><p>但过去就是过去；你远大于普朗克长度的体型自然不能展示量子特性，你当然不能像光子一样搞个延迟选择改变历史路径。590就是590, 除非我愿意去像那谁一样读个高四高五高六去刷分。然而当时已经心灰意冷，“我才懒得去想这么多！该怎样就怎样吧！”</p><p>于是就报了一个糊里糊涂的志愿，度过了一个莫名其妙的大一。报志愿的时候十分的淡漠，好像黄文睿那不是我的名字一样。填了5个志愿进了第二个，填了5个专业没有一个要我的，哪怕是物理系也没有。进了一个我始料未及的专业，打了我个猝不及防。</p><p>这样的结果就是，高考完的暑假被拖着去走亲访友报个“喜”，重复着一遍又一遍对他们来说陌生的大学的名字，复述着一遍又一遍我打心底里不愿意去的专业，偏偏他们认为这就是我竭尽全力跳龙门的高度，嘴里“不错不错有前途”地说着。哼哼。</p><p>连带着陪同三位学神的帝都游我也是不能尽兴。人家秒解的题我不能秒解，人家随口而出的定理公式我听不懂，人家的随手取得的校荐我拿不到。结果就是人家搞出来的大新闻我要老老实实坐在下面学习一个。当时的我充斥着对自己的怀疑：我真的配得上和这样人均630+的人一起去玩耍？他们三位一路上对各种学校名人趣闻了如指掌，一路上带着的都是他们应得的“我是明日之星”的自豪与傲气。我呢？我能干啥？我只能听听，笑笑，表示我来了。</p><p>曾经是怎样期盼着大学的呢？一个知识的海洋，名师益友共同前行。但真正踏入之后就发现远远不是那么回事。强行建立的认同感，MOBA玩到傻的同学，依然像高中一样的授课方式，没事拉着你强行出观众的学校活动。我非常，非常，非常的失望，不论是对同学，对老师，对舍友，对学校，对教材，对生活环境，最重要的，对自己。当时哪怕是考再好一点，是不是就能进入到一个更高的平台，去和更好的人一起谈笑风生呢？</p><p>“母校”的地位并不能被拿来当挡箭牌，更何况我心中并没有把这里当做母校。课程水就是水，不能因为有几个上课精彩的老师就说好，正如不能因为有几个老师讲课烂就说烂一样。高等数学仿佛是择人而噬的恶魔，工程图学是吃人吐X光的黑洞，线性代数就是挥之不去减命折寿的梦魇，老师上课的精彩也不能掩盖学生们对知识本身的惧怕。至于其他的就更加糟糕，英语课如同玩耍（也许正应如此？），C语言课程简直是浪费生命。这是大学？这是985？简直是纸老虎。</p><p>大一就这么混过去了。我一直是以常态而学习，但他们却说着“学霸”调笑，仿佛有一条深沟横亘在我和他之间，仿佛我们就不是同一个物种。也许他们没办法理解我，就像我没办法理解为什么LoL有那么大的吸引力一样。更可怕的是，有那么一个糟糕的室友。我对他已经远远超出“不满”的程度，要是杀人不犯法的话我早就……</p><p>幸而我能够“脱颖而出”，走出了那个在我看来是一个深坑神坑的地方。我来到了曾经是我志愿的专业，又一次将其填在志愿表上。我当时想着，不肯录取我的地方，至少平均水平也得比我高上那么一点吧？</p><p>可惜，现实击碎了我的想法，它狠狠地打了我的脸，生疼。又一次感到了失望，心累。同样的内容在不同的地方上演。我感觉，是我错了？广受嘲笑的晋惠帝也许就是我，我想让所有人都吃的上肉糜，时间地点内容人物不同而已，其内核分毫不差。 俗话说不吐不快。吐了，也没能快了多少。火气易去，郁气难消。努力吧。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;曾经多次，在夜深人静适合一个人思考钻死胡同的时候，酝酿过写这么个东西的想法；可惜这种想法往往不能留存过夜。第二天一觉起来神清气爽，似乎所有烦恼与抑郁症状都不翼而飞了，这种想法也就随之消散在脑海里，化作飞灰。但大量飞灰也有沉积起来形成星体的时候，于是你们现在看到了这份鬼话连篇的随笔杂谈。&lt;/p&gt;
    
    </summary>
    
      <category term="杂项" scheme="https://unnamed42.github.io/categories/%E6%9D%82%E9%A1%B9/"/>
    
    
      <category term="情感叙事" scheme="https://unnamed42.github.io/tags/%E6%83%85%E6%84%9F%E5%8F%99%E4%BA%8B/"/>
    
  </entry>
  
  <entry>
    <title>C与C++的不同</title>
    <link href="https://unnamed42.github.io/2015-12-19-C%E4%B8%8EC-%E7%9A%84%E4%B8%8D%E5%90%8C.html"/>
    <id>https://unnamed42.github.io/2015-12-19-C与C-的不同.html</id>
    <published>2015-12-19T14:44:41.000Z</published>
    <updated>2017-03-10T12:34:38.000Z</updated>
    
    <content type="html"><![CDATA[<p>UPDATE 2017/03/10: 填了一部分</p><a id="more"></a><hr><p>由于本人才疏学浅造成的错误希望各位在评论中<strong>心平气和</strong>地指正。</p><hr><h2 id="auto-关键字">auto 关键字</h2><p>在C语言中，这个关键字用于声明变量的生存期为自动，即将不在任何类、结构、枚举、联合和函数中定义的变量视为全局变量，而在函数中定义的变量视为局部变量。这个关键字不怎么多写，因为函数内局部变量默认就是<code>auto</code>的，与程序员预期相符合。C++98标准中<code>auto</code>关键字与C语言中的相同；而自C++11以来，<code>auto</code>的语义被修改，原来代表 “automatic” 的语义被废弃，该关键字转而用于两种情况：声明变量时根据初始化表达式自动推断该变量的类型、声明函数时函数返回值的占位符。</p><p>C++ <code>auto</code>用法举例：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">template</span> &lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">U</span>&gt;</span></div><div class="line"><span class="title">auto</span> <span class="title">add</span>(<span class="title">T</span> <span class="title">t</span>, <span class="title">U</span> <span class="title">u</span>) -&gt; <span class="title">decltype</span>(<span class="title">t</span> + <span class="title">u</span>) // <span class="title">add</span>的返回类型与<span class="title">operator</span>+(<span class="title">T</span>, <span class="title">U</span>)的相同</div><div class="line">&#123;</div><div class="line">    <span class="keyword">return</span> t + u;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="built_in">std</span>::<span class="built_in">vector</span>&lt;type&gt; func()&#123;</div><div class="line">    <span class="comment">//something here</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">auto</span> a = func();  <span class="comment">// a的类型与func的返回值类型相同</span></div></pre></td></tr></table></figure><p>之所以上面返回类型需要使用<code>auto</code>占位，是因为你的类型推导式用到了函数参数<code>t</code>和<code>u</code>，而编译器读到返回类型推导式<code>decltype(t + u)</code>的时候<code>t</code>和<code>u</code>还没声明，也就用不了，形成了循环依赖。除了这种格式，还可以使用<code>decltype(*(T*)0 + *(U*)0)</code>这样的格式，虽然更难看。</p><h2 id="类型别名">类型别名</h2><p>类型别名用于避免又臭又长的变量声明（比如函数指针），以及保证可移植性（比如<code>stdint.h</code>里的<code>int32_t</code>保证是32位带符号整型）等等情况下。</p><p>C和C++均支持<code>typedef</code>的类型别名，并且都不允许<code>typedef</code>类型别名声明中出现<code>static</code>. <code>typedef</code>声明的作用域如同一个变量声明，在C++中多了类从而类中的<code>typedef</code>声明也多了访问权限控制。</p><p>在C++中多出了模板，而<code>typedef</code>不支持模板，定义的类型别名只能是模板实例化之后的类型。若要对模板进行类型别名声明新的模板，就要使用<code>using</code>关键字。</p><p><code>using</code>的使用方式如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Simple using alias</span></div><div class="line"><span class="keyword">using</span> alias_name = type_id;</div><div class="line"></div><div class="line"><span class="comment">// For template alias</span></div><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">template</span>-parameter-<span class="built_in">list</span>&gt;</div><div class="line"><span class="keyword">using</span> alias_name = type_id;</div></pre></td></tr></table></figure><p>举个例子：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></div><div class="line"><span class="title">struct</span> <span class="title">Alloc</span> &#123; &#125;;</div><div class="line"></div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>&gt;</span></div><div class="line"><span class="title">using</span> <span class="title">Vec</span> = <span class="title">vector</span>&lt;T, Alloc&lt;T&gt;&gt;; <span class="comment">// type-id is vector&lt;T, Alloc&lt;T&gt;&gt;</span></div><div class="line"></div><div class="line">Vec&lt;<span class="keyword">int</span>&gt; v; <span class="comment">// Vec&lt;int&gt; is the same as vector&lt;int, Alloc&lt;int&gt;&gt;</span></div></pre></td></tr></table></figure><h2 id="布尔类型">布尔类型</h2><p>C在C99标准之前没有内置布尔类型，因此只能通过<code>typedef int bool</code>的方式模拟；C99及以后在C语言中引入了布尔类型，其关键字是<code>_Bool</code>. 如果想要像C++那样使用布尔类型的话，包含头文件<code>stdbool.h</code>.</p><p>C++自带布尔类型，关键字是<code>bool</code>.</p><h2 id="数组">数组</h2><p>就定长数组（编译期可确定其长度）而言，C和C++毫无区别。而C99引入了变长数组(<a href="https://en.wikipedia.org/wiki/Variable-length_array" target="_blank" rel="external">Variadic Length Array</a>, VLA)之后，一切就变得不一样了。</p><p>就行为上来说，VLA相当于自动帮你使用了<code>malloc</code>和<code>free</code>, 只是开辟的空间在栈上罢了。同时对数组引入了新的语法（一般用在函数声明的参数列表里面），来描述新引入的VLA. 比如<code>int[*]</code>代表这是一个<code>int</code>的VLA, <code>int[static 10]</code>代表这是一个至少有10个<code>int</code>的VLA(该语法有利于优化).</p><p>C++中没有VLA, 如果一定要长度可变的数组那么使用<code>std::vector</code>; 要封装原生数组使用C++11引入的<code>std::array</code>.</p><h2 id="泛型">泛型</h2><p>这里的泛型是针对C11引入的<code>_Generic</code>的直译。</p><p>在C11之前，我们无法在C语言中写一个针对所有数据类型都可用的算法（比如针对任何类型的数组都可用的排序函数），所能做的只有全部转换成<code>void*</code>然后提供一个自定义的处理函数，通过这样拐弯抹角的方式来实现泛型。一个典型的例子就是<code>stdlib.h</code>里的<code>qsort</code>, 其原型定义如下：</p><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">void qsort( void *ptr, size_t count, size_t size,</div><div class="line">            int (*comp)(const void *, const void *) );</div></pre></td></tr></table></figure><p>在C11中提供了<code>_Generic</code>的功能，它能根据传入参数的类型来决定对应的操作。如下就是一个<code>_Generic</code>的例子，可以根据传入的参数到底是<code>long double</code>还是<code>float</code>来决定调用的函数到底是<code>cbrtl</code>还是<code>cbrtf</code>. 如果提供的类型无一满足，那么会使用<code>default</code>条目定义的规则。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> cbrt(X) _Generic((X), \</span></div><div class="line">                         long double: cbrtl, \</div><div class="line">                         default: cbrt, \</div><div class="line">                         float: cbrtf \</div><div class="line">                        )(X)</div></pre></td></tr></table></figure><p>在C++中，语言自带的重载和模板特性就不知道比C高到哪里去了，虽然会有<a href="https://en.wikipedia.org/wiki/Name_mangling" target="_blank" rel="external">Name Mangling</a>使ABI不稳定这种副作用。</p><h2 id="struct">struct</h2><p>在C中，<code>struct</code>只能内含数据类型，不能包有函数和<code>static</code>成员。但C99之后也有一些C++没有的特性，比如<a href="https://en.wikipedia.org/wiki/Flexible_array_member" target="_blank" rel="external">Flexible array member</a>（其实这个特性在进标准之前就有很多类似手法了），<a href="http://en.cppreference.com/w/c/language/compound_literal" target="_blank" rel="external">compound literal</a>和<a href="http://en.cppreference.com/w/c/language/struct_initialization" target="_blank" rel="external">designated initialization</a>（这两个不光可用于<code>struct</code>）。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">test</span> &#123;</span></div><div class="line">    <span class="keyword">int</span> i;</div><div class="line">    <span class="keyword">char</span> c;</div><div class="line">&#125; test;</div><div class="line"><span class="comment">// compound literal</span></div><div class="line">test t1 = (test)&#123;<span class="number">0</span>, <span class="string">'0'</span>&#125;;</div><div class="line"><span class="comment">// designated initialization</span></div><div class="line">test t2 = &#123;.c = <span class="string">'0'</span>, .i = <span class="number">0</span>&#125;;</div></pre></td></tr></table></figure><p>这种缺乏导致C不能很方便地写出很“面向对象”的代码。成员函数和<a href="https://en.wikipedia.org/wiki/Virtual_method_table" target="_blank" rel="external">vtable</a>可以手动添加<code>struct</code>的函数指针成员来实现，<a href="http://stackoverflow.com/a/351745" target="_blank" rel="external">假装自己有OOP的样子</a>；而OOP中的继承特性就不太好写了。方法、成员的继承可以通过复制粘贴来实现，但基类可以指向子类，虚函数这些语义怎么办呢？</p><p>为了保持与C的兼容，C++让<a href="http://en.cppreference.com/w/cpp/concept/PODType" target="_blank" rel="external">简单的</a><code>struct</code>, <code>class</code>, <code>union</code>保持C风格，让它们能够与C传统的<code>malloc</code>, <code>memmove</code>等函数交互。</p><p>此外，在C中<code>struct</code>, <code>union</code>, <code>enum</code>的类型名称和变量名、函数名等等是区别对待的，即使二者重名也是可以的。因此<code>typedef struct tag tag</code>这样的语句很有必要，如果不写那么声明一个<code>tag</code>结构体一定要使用<code>struct tag var</code>而不是<code>tag var</code>. 在C++中你可以认为是自动插入了这样的<code>typedef</code>语句。</p><h2 id="空指针">空指针</h2><p>C语言中，任何类型的两个空指针值相等。宏定义<code>NULL</code>的值具体取决于实现。C99中规定<code>NULL</code>应该是从整数类型的<code>0</code>显式或隐式地转换而来。</p><p>C++出于兼容C的考虑保留了<code>NULL</code>, 其内容可能是：</p><ul><li>整数类型的右值(rvalue)常量表达式，该值为0 (C++11之前)</li><li>整数类型的纯右值(prvalue)常量表达式，该值为0; 或是<code>std::nullptr_t</code>类型的纯右值 (C++11到C++14)</li><li>值为0的整型字面值，或是或是<code>std::nullptr_t</code>类型的纯右值 (C++14起)</li></ul><p>C++引入新的关键字<code>nullptr</code>来代表空指针，来解决之前<code>0</code>同时具有整数0和空指针语义的问题。例如如下的程序：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstddef&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></div><div class="line"> </div><div class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">F</span>, <span class="title">class</span> <span class="title">A</span>&gt;</span></div><div class="line"><span class="title">void</span> <span class="title">Fwd</span>(<span class="title">F</span> <span class="title">f</span>, <span class="title">A</span> <span class="title">a</span>)</div><div class="line">&#123;</div><div class="line">    f(a);</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">g</span><span class="params">(<span class="keyword">int</span>* i)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Function g called\n"</span>;</div><div class="line">&#125;</div><div class="line"> </div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    g(<span class="literal">NULL</span>);           <span class="comment">// Fine</span></div><div class="line">    g(<span class="number">0</span>);              <span class="comment">// Fine</span></div><div class="line"> </div><div class="line">    Fwd(g, <span class="literal">nullptr</span>);   <span class="comment">// Fine</span></div><div class="line"><span class="comment">//  Fwd(g, NULL);  // ERROR: No function g(int)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>在上面的程序中，<code>Fwd(g,NULL)</code>并不是如想象中一般地调用了<code>g(int*)</code>，反而去寻找<code>g(int)</code>的重载。使用<code>nullptr</code>就不会出现这样的问题。</p><p>二者<code>NULL</code>最原始的宏定义都在<code>stddef.h</code>(或<code>cstddef</code>)里。</p><h2 id="类型转换">类型转换</h2><p>C支持隐式和显式的两种转换，隐式的由编译器自动完成，显式的只有<code>(type)expression</code>这一种方式。</p><p>C++兼容C的类型转换方式，但它引入了对象机制后更加复杂。首先为了与C兼容保留了上面的转换方式，同时引入了等价的<code>type(expression)</code>方式。除此之外，还存在<code>static_cast</code>, <code>const_cast</code>, <code>dynamic_cast</code>, <code>reinterpret_cast</code>这四种。从理论上来说，<code>(type) expression</code>和<code>type(expression)</code>都是以上几种<code>XXXX_cast</code>的组合。在C++中，类型转换推荐使用<code>XXXX_cast</code>的形式。</p><p>由于C++里面的构造函数和自定义转换函数，隐式转换可能会发生在各种意想不到的地方。关于类型转换的知识十分繁杂，具体详见<a href="http://en.cppreference.com/w/cpp/language/implicit_cast" target="_blank" rel="external">C++隐式类型转换</a>、<a href="http://en.cppreference.com/w/c/language/conversion" target="_blank" rel="external">C隐式类型转换</a>。</p><h2 id="指针和内存管理">指针和内存管理</h2><p>这部分主要就是体现出C++强于C的地方了。涉及到动态内存管理，大家都只能向操作系统申请空间，到时候都得释放，但是C++能够玩出花来。利用类封装加上<a href="https://en.wikipedia.org/wiki/Resource_acquisition_is_initialization" target="_blank" rel="external">RAII</a>机制，C++标准库实现了智能指针，一个是基于引用计数的<a href="http://en.cppreference.com/w/cpp/memory/shared_ptr" target="_blank" rel="external"><code>shared_ptr</code></a>, 另一个是独享资源所有权的<a href="http://en.cppreference.com/w/cpp/memory/unique_ptr" target="_blank" rel="external"><code>unique_ptr</code></a>, 利用这两样工具，基本能摆脱手动<code>delete</code>的烦恼。</p><h2 id="异常处理">异常处理</h2><p>C语言没有什么方便的异常处理机制，一般是在每个可能出异常的地方套上个if-else, 异常来临时<code>exit</code>, 申请的资源通过在<code>atexit</code>注册的函数来处理。或者使用<code>setjmp</code>和<code>longjmp</code>.</p><p>在C++中有现在满地都是的 try-catch 流，使用这个的时候需要时刻留心，保证代码的异常安全性。同时，在异常发生时使用原生指针管理的内存如果不在catch块处理那么内存就这么泄露了。</p><h2 id="参考资料">参考资料</h2><p>auto部分：</p><ol><li><p><a href="http://en.cppreference.com/w/cpp/language/auto" target="_blank" rel="external">http://en.cppreference.com/w/cpp/language/auto</a></p></li><li><p><a href="http://en.cppreference.com/w/cpp/keyword" target="_blank" rel="external">http://en.cppreference.com/w/cpp/keyword</a></p></li></ol><p>类型别名部分：</p><ol><li><p><a href="http://en.cppreference.com/w/cpp/language/typedef" target="_blank" rel="external">http://en.cppreference.com/w/cpp/language/typedef</a></p></li><li><p><a href="http://en.cppreference.com/w/c/language/typedef" target="_blank" rel="external">http://en.cppreference.com/w/c/language/typedef</a></p></li><li><p><a href="http://en.cppreference.com/w/cpp/language/type_alias" target="_blank" rel="external">http://en.cppreference.com/w/cpp/language/type_alias</a></p></li></ol><p>布尔类型部分：</p><ol><li><a href="https://en.wikipedia.org/wiki/C99" target="_blank" rel="external">https://en.wikipedia.org/wiki/C99</a></li></ol><p>泛型部分：</p><ol><li><a href="http://en.cppreference.com/w/c/language/generic" target="_blank" rel="external">http://en.cppreference.com/w/c/language/generic</a></li></ol><p>空指针部分：</p><ol><li><p><a href="https://en.wikipedia.org/wiki/Null_pointer" target="_blank" rel="external">https://en.wikipedia.org/wiki/Null_pointer</a></p></li><li><p><a href="http://en.cppreference.com/w/cpp/language/nullptr" target="_blank" rel="external">http://en.cppreference.com/w/cpp/language/nullptr</a></p></li><li><p><a href="http://en.cppreference.com/w/cpp/types/NULL" target="_blank" rel="external">http://en.cppreference.com/w/cpp/types/NULL</a></p></li></ol><p>类型转换部分：</p><ol><li><a href="http://stackoverflow.com/a/332086" target="_blank" rel="external">http://stackoverflow.com/a/332086</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;UPDATE 2017/03/10: 填了一部分&lt;/p&gt;
    
    </summary>
    
      <category term="学习" scheme="https://unnamed42.github.io/categories/%E5%AD%A6%E4%B9%A0/"/>
    
    
  </entry>
  
  <entry>
    <title>Leetcode 8 String to Integer(atoi)</title>
    <link href="https://unnamed42.github.io/2015-12-06-Leetcode-8-String-to-Integer-atoi.html"/>
    <id>https://unnamed42.github.io/2015-12-06-Leetcode-8-String-to-Integer-atoi.html</id>
    <published>2015-12-05T16:09:09.000Z</published>
    <updated>2016-10-05T18:18:29.000Z</updated>
    
    <content type="html"><![CDATA[<p>一个不难但是坑的题的题解——《论健壮性》</p><a id="more"></a><p>题目如下：</p><blockquote><p>Implement atoi to convert a string to an integer.</p><p><strong>Hint</strong>: Carefully consider all possible input cases. If you want a challenge, please do not see below and ask yourself what are the possible input cases.</p><p><strong>Notes</strong>: It is intended for this problem to be specified vaguely (ie, no given input specs). You are responsible to gather all the input requirements up front.</p></blockquote><hr><p>本题让我们实现标准库<code>stdlib.h</code>里的<code>atoi</code>函数。</p><p>收录这个题的解法并不是因为它有多么难，而是给大家展示一下要满足算法健壮性是多么地不容易。</p><p>首先，由于我以前写过一个简单版本的<code>atoi</code>, 因此第一版轻车熟路地就出来了：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">myAtoi</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> sign=<span class="number">1</span>,l=<span class="built_in">strlen</span>(str),res=<span class="number">0</span>;    <span class="comment">//使用l记录长度然后用 i&lt;l 能够比使用 s[i]!='\0' 要快</span></div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">    <span class="keyword">if</span>(str[<span class="number">0</span>]==<span class="string">'-'</span>)</div><div class="line">        sign=<span class="number">-1</span>,i=<span class="number">1</span>;</div><div class="line">    <span class="keyword">for</span>(;i&lt;l;i++)&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="string">'0'</span>&lt;=str[i]&amp;&amp;str[i]&lt;=<span class="string">'9'</span>)&#123;</div><div class="line">            res*=<span class="number">10</span>;</div><div class="line">            res+=str[i]-<span class="string">'0'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sign*res;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>在这个版本里，考虑了各种因素：首位的符号可能是数字也可能是负号；<code>str</code>字符串里一些可能的乱七八糟非数字的字符，这种情况下我们只处理前面合法的数字部分。我信心满满地提交了，然后它告诉我：</p><p><code>myAtoi(&quot;+1&quot;)==1</code></p><p>…于是修改成了这个版本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">myAtoi</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> sign=<span class="number">1</span>,l=<span class="built_in">strlen</span>(str),res=<span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">    <span class="keyword">switch</span>(str[<span class="number">0</span>])&#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'-'</span>:sign=<span class="number">-1</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'+'</span>:i=<span class="number">1</span>;<span class="keyword">break</span>;    <span class="comment">//无论str[0]是'+'还是'-' i都是1,就让case穿透吧，我少写一句</span></div><div class="line">        <span class="keyword">default</span>:<span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(;i&lt;l;i++)&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="string">'0'</span>&lt;=str[i]&amp;&amp;str[i]&lt;=<span class="string">'9'</span>)&#123;</div><div class="line">            res*=<span class="number">10</span>;</div><div class="line">            res+=str[i]-<span class="string">'0'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sign*res;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>然后它告诉我：</p><p><code>myAtoi(&quot; 123&quot;)==123</code></p><p>我之后做了个测试，发现数字之后的空格视为非法字符，比如<code>myAtoi(&quot; 1 2 3 &quot;)==1</code>. ……于是修改成了这个版本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">myAtoi</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> sign=<span class="number">1</span>,l=<span class="built_in">strlen</span>(str),res=<span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">    <span class="keyword">switch</span>(str[<span class="number">0</span>])&#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'-'</span>:sign=<span class="number">-1</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'+'</span>:i=<span class="number">1</span>;<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">' '</span>:</div><div class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;l<span class="number">-1</span>;i++)&#123;</div><div class="line">                <span class="keyword">if</span>(str[i+<span class="number">1</span>]!=<span class="string">' '</span>)</div><div class="line">                    <span class="keyword">return</span> myAtoi(str+i+<span class="number">1</span>);    <span class="comment">//跳过开头所有的空格，然后递归处理</span></div><div class="line">            &#125;</div><div class="line">        <span class="keyword">default</span>:<span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(;i&lt;l;i++)&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="string">'0'</span>&lt;=str[i]&amp;&amp;str[i]&lt;=<span class="string">'9'</span>)&#123;</div><div class="line">            res*=<span class="number">10</span>;</div><div class="line">            res+=str[i]-<span class="string">'0'</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sign*res;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>然后它告诉我：</p><p><code>myAtoi(&quot;2147483648&quot;)==2147483647</code></p><p>也就是说，如果正数溢出返回<code>INT_MAX</code>; 负数溢出返回<code>INT_MIN</code>.</p><p>………于是改成了下面这个最终版本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">myAtoi</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span>* str)</span> </span>&#123;</div><div class="line">    <span class="keyword">int</span> sign=<span class="number">1</span>,l=<span class="built_in">strlen</span>(str),res=<span class="number">0</span>;</div><div class="line">    <span class="keyword">int</span> i=<span class="number">0</span>;</div><div class="line">    <span class="keyword">switch</span>(str[<span class="number">0</span>])&#123;</div><div class="line">        <span class="keyword">case</span> <span class="string">'-'</span>:sign=<span class="number">-1</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">'+'</span>:i=<span class="number">1</span>;<span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> <span class="string">' '</span>:</div><div class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;l<span class="number">-1</span>;i++)&#123;</div><div class="line">                <span class="keyword">if</span>(str[i+<span class="number">1</span>]!=<span class="string">' '</span>)</div><div class="line">                    <span class="keyword">return</span> myAtoi(str+i+<span class="number">1</span>);</div><div class="line">            &#125;</div><div class="line">        <span class="keyword">default</span>:<span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(;i&lt;l;i++)&#123;</div><div class="line">        <span class="keyword">if</span>(<span class="string">'0'</span>&lt;=str[i]&amp;&amp;str[i]&lt;=<span class="string">'9'</span>)&#123;</div><div class="line">            <span class="comment">/* In case that res*=10 overflows */</span></div><div class="line">            <span class="keyword">if</span>(res&gt;INT_MAX/<span class="number">10</span>&amp;&amp;res&gt;<span class="number">0</span>)</div><div class="line">                <span class="keyword">return</span> sign==<span class="number">1</span>?INT_MAX:INT_MIN;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                res*=<span class="number">10</span>;</div><div class="line">            <span class="comment">/* In case that res+=str[i]-'0' overflows */</span></div><div class="line">            <span class="keyword">int</span> digit=str[i]-<span class="string">'0'</span>;<span class="comment">//避免反复计算str[i]-'0'</span></div><div class="line">            <span class="keyword">if</span>(res&gt;INT_MAX-digit&amp;&amp;res&gt;<span class="number">0</span>)</div><div class="line">                <span class="keyword">return</span> sign==<span class="number">1</span>?INT_MAX:INT_MIN;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                res+=digit;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> sign*res;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>然后，提交，判断——终于通过了，不容易啊。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;一个不难但是坑的题的题解——《论健壮性》&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="https://unnamed42.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Leetcode" scheme="https://unnamed42.github.io/tags/Leetcode/"/>
    
      <category term="算法" scheme="https://unnamed42.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Leetcode 102 Binary Tree Level Order Traversal</title>
    <link href="https://unnamed42.github.io/2015-12-05-Leetcode-102-Binary-Tree-Level-Order-Traversal.html"/>
    <id>https://unnamed42.github.io/2015-12-05-Leetcode-102-Binary-Tree-Level-Order-Traversal.html</id>
    <published>2015-12-05T15:50:00.000Z</published>
    <updated>2016-10-05T18:18:46.000Z</updated>
    
    <content type="html"><![CDATA[<p>Leetcode 102 的题解</p><a id="more"></a><p>题目如下：</p><blockquote><p>Given a binary tree, return the level order traversal of its nodes’ values. (ie, from left to right, level by level).</p><p>For example: Given binary tree <code>{3,9,20,#,#,15,7}</code>,</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">  3</div><div class="line"> / \</div><div class="line">9  20</div><div class="line">  /  \</div><div class="line"> 15   7</div></pre></td></tr></table></figure>return its level order traversal as:<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">  [3],</div><div class="line">  [9,20],</div><div class="line">  [15,7]</div><div class="line">]</div></pre></td></tr></table></figure></blockquote><hr><p>由于C语言写出来更加复杂，需要开辟动态数组存放结果，所以我选用了C++, 因为它有<code>std::vector</code>.</p><p>如果只是涉及到树的层次遍历，那我还是会的；但本题不光涉及到层次遍历，还要在输出里面包含“层次”的信息，这就有点麻烦了。刚开始，我想到的是设计一个计数变量<code>i</code>, 如果$2^{n-1}-1 \lt i \le 2^n-1$, 那么就位于第$n$层（尽管不一定是满二叉树，但让<code>i</code>把空指针数也记录进去就可以了），但这样显然把问题弄得更复杂了。</p><p>后来，考虑到层次遍历入队的时候，当前层的节点数等于队列中的节点数，那么这个问题就好办了：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 树节点是这样的：</div><div class="line"> * struct TreeNode &#123;</div><div class="line"> *     int val;</div><div class="line"> *     TreeNode *left;</div><div class="line"> *     TreeNode *right;</div><div class="line"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</div><div class="line"> * &#125;;</div><div class="line"> */</div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">vector</span>;</div><div class="line"><span class="keyword">using</span> <span class="built_in">std</span>::<span class="built_in">queue</span>;</div><div class="line"></div><div class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; levelOrder(TreeNode* root) &#123;</div><div class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; res;<span class="built_in">queue</span>&lt;TreeNode*&gt; q;</div><div class="line">        <span class="keyword">if</span>(root==<span class="literal">NULL</span>)</div><div class="line">            <span class="keyword">return</span> res;</div><div class="line">        q.push(root);</div><div class="line">        <span class="keyword">while</span>(!q.empty())&#123;</div><div class="line">            <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; lvl;<span class="keyword">int</span> size=q.size();</div><div class="line">            <span class="keyword">for</span>(;size&gt;<span class="number">0</span>;size--)&#123;</div><div class="line">                root=q.front();</div><div class="line">                lvl.push_back(root-&gt;val);</div><div class="line">                q.pop();</div><div class="line">                <span class="keyword">if</span>(root-&gt;left!=<span class="literal">NULL</span>)</div><div class="line">                    q.push(root-&gt;left);</div><div class="line">                <span class="keyword">if</span>(root-&gt;right!=<span class="literal">NULL</span>)</div><div class="line">                    q.push(root-&gt;right);</div><div class="line">            &#125;</div><div class="line">            res.push_back(lvl);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> res;</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure><p>Over.</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Leetcode 102 的题解&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="https://unnamed42.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Leetcode" scheme="https://unnamed42.github.io/tags/Leetcode/"/>
    
      <category term="算法" scheme="https://unnamed42.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>Leetcode 26 Remove Duplicates from Sorted Array</title>
    <link href="https://unnamed42.github.io/2015-12-05-Leetcode-26-Remove-Duplicates-from-Sorted-Array.html"/>
    <id>https://unnamed42.github.io/2015-12-05-Leetcode-26-Remove-Duplicates-from-Sorted-Array.html</id>
    <published>2015-12-05T15:28:29.000Z</published>
    <updated>2016-10-05T18:19:07.000Z</updated>
    
    <content type="html"><![CDATA[<p>Leetcode 26 的题解</p><a id="more"></a><p>题目如下：</p><blockquote><p>Given a sorted array, remove the duplicates in place such that each element appear only once and return the new length.</p><p>Do not allocate extra space for another array, you must do this in place with constant memory.</p><p>For example, Given input array <code>nums = [1,1,2]</code>,</p><p>Your function should return <code>length = 2</code>, with the first two elements of nums being 1 and 2 respectively. It doesn’t matter what you leave beyond the new length.</p></blockquote><hr><p>最直接的做法是（如果能忽略掉不允许额外空间的题目要求的话）将每个独一无二的元素放入新数组中，然后将这些元素放回：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">removeDuplicates</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(numsSize&lt;=<span class="number">1</span>)</div><div class="line">        <span class="keyword">return</span> numsSize;</div><div class="line">    <span class="keyword">int</span> unique[numsSize];</div><div class="line">    unique[<span class="number">0</span>]=nums[<span class="number">0</span>];</div><div class="line">    <span class="keyword">int</span> index=<span class="number">1</span>;    <span class="comment">//表示下标，但同时我们也发现它表示unique数组的有效长度</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;numsSize;i++)&#123;</div><div class="line">        <span class="keyword">if</span>(nums[index]==nums[i])</div><div class="line">            contiune;</div><div class="line">        unique[index++]=nums[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;index;i++)</div><div class="line">        nums[i]=unique[i];</div><div class="line">    <span class="keyword">return</span> index;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>虽然这是个时间$O(n)$的算法，但我们同时也用了$O(n)$的空间。能不能不使用额外空间？</p><p>考虑到独一无二的元素个数总是不多于总元素个数，因此我们在<code>nums</code>里循环遍历的时候，把<code>nums</code>的前半部分当做这里的<code>unique</code>数组是可行的。修改如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">removeDuplicates</span><span class="params">(<span class="keyword">int</span>* nums, <span class="keyword">int</span> numsSize)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span>(numsSize &lt;= <span class="number">1</span>)</div><div class="line">        <span class="keyword">return</span> numsSize;</div><div class="line">    <span class="keyword">int</span> index = <span class="number">0</span>;              <span class="comment">//表示下标，但同时也表示有效长度</span></div><div class="line">    <span class="keyword">int</span> temp = nums[<span class="number">0</span>] - <span class="number">1</span>;     <span class="comment">//为保证nums[0]不被跳过处理</span></div><div class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numsSize ; i++)&#123;</div><div class="line">        <span class="keyword">if</span>(temp == nums[i])&#123;</div><div class="line">            <span class="keyword">continue</span>;</div><div class="line">        &#125;</div><div class="line">        temp = nums[i];</div><div class="line">        nums[index++] = nums[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> index;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>于是，我们满足了题目的要求，未使用额外空间。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Leetcode 26 的题解&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="https://unnamed42.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="Leetcode" scheme="https://unnamed42.github.io/tags/Leetcode/"/>
    
      <category term="算法" scheme="https://unnamed42.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>位运算技巧</title>
    <link href="https://unnamed42.github.io/2015-12-04-%E4%BD%8D%E8%BF%90%E7%AE%97%E6%8A%80%E5%B7%A7.html"/>
    <id>https://unnamed42.github.io/2015-12-04-位运算技巧.html</id>
    <published>2015-12-04T05:10:02.000Z</published>
    <updated>2016-10-28T11:36:00.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>深坑待填！</strong></p><p>本文翻译自<a href="https://graphics.stanford.edu/~seander/bithacks.html" target="_blank" rel="external">这篇文章</a>，原作者Sean Eron Anderson. 如果有翻译错误的地方，欢迎指正。另外，由于年代久远，文中给出的链接可能已经失效。</p><p>UPDATE 2016/09/30: 继续翻译，并改进已翻译文本</p><a id="more"></a><hr><h2 id="开头语">开头语</h2><p>本文所有代码片段皆属公有（除非特别指明）——您想怎么用就怎么用。所有的文本皆属Sean Eron Anderson版权所有（1997-2005）。本着希望帮助他人的想法，我将代码及其解释公之于众，但若要这些代码用于特定目的，请记住我并未明显或隐含地保证其可用和适用性。截止于2005年五月5日，所有代码均经过了完整的测试，并经上千人阅览。此外，卡内基·梅隆大学计算机学院院长<a href="http://www-2.cs.cmu.edu/~bryant/" target="_blank" rel="external">Randal Bryant教授</a>使用他的轮子<a href="http://www-2.cs.cmu.edu/~uclid/" target="_blank" rel="external">uclid代码测试系统</a>进行了测试，测试内容几乎涵盖了所有方面。他没有覆盖到的情况，我已经在32位机器上针对所有可能输入补充测试了一遍。<strong>对于第一个找到我代码里正当bug的人，我将给予他10美元的奖金（通过支票或PayPal）。如果将这笔钱转交慈善机构的话，增至20美元。</strong></p><h2 id="关于操作统计的说明">关于操作统计的说明</h2><p>统计本文算法中操作数量的时候，所有C语言运算符皆看做是一次操作。不涉及写入内存的中间过程，不在统计范围内。当然，这种统计方式只能是对真实的机器指令和CPU时间的一个近似。在此假定所有的操作耗费相同的时间。这虽然与真实情况不符，但的确是CPU发展努力的方向。一个代码样本在不同系统上运行时间会有很多细微的差别，可能是缓存大小、内存带宽、指令集等等因素造成的。总之，拿去跑一跑是确定方法之间快慢的最好方法，所以在实际机器上测试的时候，我所说的仅供参考。</p><h2 id="获取一个整数的正负号">获取一个整数的正负号</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> v;        <span class="comment">//我们想知道v的符号</span></div><div class="line"><span class="keyword">int</span> sign;     <span class="comment">//用来存放结果</span></div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// CHAR_BIT 代表一字节(byte)是多少位(bit)（一般是8）</span></div><div class="line">sign = -(v &lt; <span class="number">0</span>);  <span class="comment">//如果v&lt;0，得到-1，否则是0</span></div><div class="line"><span class="comment">// 或者，为了避免在用标记寄存器的CPU (IA32) 上使用转移指令：</span></div><div class="line">sign = -(<span class="keyword">int</span>)((<span class="keyword">unsigned</span> <span class="keyword">int</span>)((<span class="keyword">int</span>)v) &gt;&gt; (<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * CHAR_BIT - <span class="number">1</span>));</div><div class="line"><span class="comment">// 或者，这样可以少一个机器指令（但牺牲了可移植性）：</span></div><div class="line">sign = v &gt;&gt; (<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * CHAR_BIT - <span class="number">1</span>);</div></pre></td></tr></table></figure><p>最后一个表达式，对于32位整数求得<code>sign = v &gt;&gt; 31</code>，这比直接求法<code>sign = -(v &lt; 0)</code>少了一个操作。该方法之所以可行，是因为当我们把有符号整数向右移位时，最左边一位的值被复制到了其他位上。对一个有符号整数来说，最左边一位是1表示是负数，其他情况是0；所有位上全是1代表<code>-1</code>. 可惜的是，上述行为是与架构相关的。（译注：带符号数负数的左移在C99标准中属于未定义行为）</p><p>另外，如果你希望<code>sign</code>的结果是<code>1</code>或<code>-1</code>的话：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sign = +<span class="number">1</span> | (v &gt;&gt; (<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * CHAR_BIT - <span class="number">1</span>));  <span class="comment">// v &lt; 0得到 -1, 其余情况是 +1</span></div></pre></td></tr></table></figure><p>其次，你希望结果是<code>-1</code>, <code>0</code>或<code>1</code>的话：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">sign = (v != <span class="number">0</span>) | -(<span class="keyword">int</span>)((<span class="keyword">unsigned</span> <span class="keyword">int</span>)((<span class="keyword">int</span>)v) &gt;&gt; (<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * CHAR_BIT - <span class="number">1</span>));</div><div class="line"><span class="comment">// 或者使用速度更快但移植性差的：</span></div><div class="line">sign = (v != <span class="number">0</span>) | (v &gt;&gt; (<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * CHAR_BIT - <span class="number">1</span>));  <span class="comment">// -1, 0, or +1</span></div><div class="line"><span class="comment">// 或者使用可移植的，简洁的，（也许）更快的：</span></div><div class="line">sign = (v &gt; <span class="number">0</span>) - (v &lt; <span class="number">0</span>); <span class="comment">// -1, 0, or +1</span></div></pre></td></tr></table></figure><p>此外，如果你想知道一个数是不是非负的，返回结果是<code>+1</code>或者<code>0</code>, 使用：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sign = <span class="number">1</span> ^ ((<span class="keyword">unsigned</span> <span class="keyword">int</span>)v &gt;&gt; (<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * CHAR_BIT - <span class="number">1</span>)); <span class="comment">// v &lt; 0得到0, 其余是1</span></div></pre></td></tr></table></figure><p>作者注：</p><ul><li>2003年3月7日，Angus Duggan指出1989 ANSI C标准规定有符号整型的右移运算结果取决于具体实现，因此在某些系统上靠右移的方法可能失效。</li><li>为了使代码可移植性更好，2005年9月28日，Toby Speight建议我使用 CHAR_BIT 而不是指定一个字节8位长。2006年3月4日，Angus推荐了上面的使用了类型转换的方法，它可移植性更好。</li><li>2009年9月12日，Rohit Garg给出了检测非负数的方法。</li></ul><h2 id="检测两个整数是否异号">检测两个整数是否异号</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> x, y;               <span class="comment">// 待检测的两个数</span></div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">bool</span> f = ((x ^ y) &lt; <span class="number">0</span>); <span class="comment">// 当且仅当x与y符号相反的时候为真</span></div></pre></td></tr></table></figure><p>作者注：</p><ul><li>2009年11月26日的时候Manfred Weis建议我加上这个条目。</li></ul><h2 id="不利用分支来计算整数的绝对值">不利用分支来计算整数的绝对值</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> v;           <span class="comment">// 我们现在要求v的绝对值</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> r;  <span class="comment">// 输出结果</span></div><div class="line"><span class="keyword">int</span> <span class="keyword">const</span> mask = v &gt;&gt; <span class="keyword">sizeof</span>(<span class="keyword">int</span>) * CHAR_BIT - <span class="number">1</span>;</div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r = (v + mask) ^ mask;</div></pre></td></tr></table></figure><p>另一个专利所有的变体：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r = (v ^ mask) - mask;</div></pre></td></tr></table></figure><p>某些CPU没有绝对值指令（或者编译器未能使用到它）。在分支指令开销很大的机器上，上面的表达式能够比直接求法<code>r = (v &lt; 0) ? -(unsigned)v : v</code>快很多，尽管操作的数量一样。</p><p>作者注：</p><ul><li>2003年3月7日，Angus Duggan指出1989 ANSI C标准规定有符号整型的右移运算结果取决于具体实现，因此在某些系统上靠右移的方法可能失效。我拜读了ANSI C, 其中并没有要求将数值表示为补码，所以说这也可能是方法失效的原因（在那些逐渐退出历史舞台的老爷机上仍然采用反码表示）。</li><li>2004年3月14日，Keith H. Duggar告诉了我上面的变体，比我刚开始想出来的那个<code>r=(+1|(v&gt;&gt;(sizeof(int)*CHAR_BIT-1)))*v</code>要好，因为少用了个乘法。不幸的是，那个方法于2000年6月6日由Vladimir Yu Volkonsky在美国申请了专利，归属于Sun Microsystems.</li><li>2006年8月13日，Yuriy Kaminskiy告诉我专利可能失效因为在专利申请之前它就已经被发布出去了，比如早在1996年11月9日Agner Fog就已经发表的<a href="http://www.goof.com/pcg/doc/pentopt.txt" target="_blank" rel="external">How to Optimize for the Pentium Processor</a>. Yuriy还告诉我那篇文档在1997年翻译成了俄文，而Vladimir可能读过。此外，互联网档案也有个指向它的<a href="http://web.archive.org/web/19961201174141/www.x86.org/ftp/articles/pentopt/PENTOPT.TXT" target="_blank" rel="external">旧链接</a>。</li><li>2007年1月30日，Peter Kankowski对我分享了他受Microsoft Visual C++编译器输出启发而想到的<a href="http://smallcode.weblogs.us/2007/01/31/microsoft-probably-uses-the-abs-function-patented-by-sun/" target="_blank" rel="external">绝对值版本</a>。该方法被拿来作为本题的主要解决方案。</li><li>2007年12月6日，Hai Jin抱怨说结果是有符号的，所以计算大多数负数绝对值的时候结果还是负的。</li><li>2008年4月15日，Andrew Shapira指出那个直接求法可能会溢出，因为缺少一个<code>(unsigned)</code>的类型转换。为了尽可能满足移植性要求，他给我的改进求法是<code>(v &lt; 0) ? (1 + ((unsigned)(-1-v))) : (unsigned)v</code>.</li><li>2008年7月9日，Vincent Lefèvre引用ISO C99标准说服了我，让把上面那个删掉，因为即使不是使用补码的机器<code>-(unsigned)v</code>也能得到正确的结果。计算<code>-(unsigned)v</code>的时候，首先加上<code>2**N</code>来将负值<code>v</code>转化成无符号值，得到<code>v</code>的补码表示（记做<code>U</code>）。然后，取<code>U</code>的相反数，得到结果：<code>-U = 0 - U = 2**N - U = 2**N - (v + 2**N) = -v = abs(v)</code>.</li></ul><p>译注：2**N 表示 $2^N$.</p><h2 id="不利用分支来计算两个整数的最大-max-最小-min-值">不利用分支来计算两个整数的最大(max)最小(min)值</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> x;</div><div class="line"><span class="keyword">int</span> y;  <span class="comment">// 我们要计算x, y的最大最小值</span></div><div class="line"><span class="keyword">int</span> r;  <span class="comment">// 存放结果</span></div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r = y ^ ((x ^ y) &amp; -(x &lt; y)); <span class="comment">// min(x, y)</span></div></pre></td></tr></table></figure><p>这个世界上还有使用条件分支非常耗费时间的老爷机，而且没有条件移动指令。在这些机器上上面的方法可能会比直接求法<code>r = (x &lt; y) ? x : y</code>要快，尽管位运算解法涉及了两个以上的指令（虽然一般说来，直接解法是最好的）。 解法证明如下：如果<code>x &lt; y</code>, 那么<code>-(x &lt; y)</code>的各二进制位就全是1, 所以<code>r = y ^ ((x ^ y) &amp; -(x &lt; y)) = y ^ ((x ^ y) &amp; ~0 = y ^ x ^ y = x</code>. 另外，如果<code>x &gt;= y</code>, 那么<code>-(x &lt; y)</code>就全是0, 所以<code>r = y ^ ((x ^ y) &amp; 0) = y</code>. 在某些机器上，计算<code>(x &lt; y)</code>要得到0或1的话需要分支指令，因此该解法不具备任何优势。</p><p>求最大值的话，使用：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r = x ^ ((x ^ y) &amp; -(x &lt; y)); <span class="comment">// max(x, y)</span></div></pre></td></tr></table></figure><h3 id="快而脏的解法">快而脏的解法</h3><p>如果你知道<code>INT_MIN &lt;= x - y &lt;= INT_MAX</code>的话，那你就可以用下面这种解法，由于它只需要计算一次<code>(x - y)</code>所以会快一点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">r = y + ((x - y) &amp; ((x - y) &gt;&gt; (<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * CHAR_BIT - <span class="number">1</span>))); <span class="comment">// min(x, y)</span></div><div class="line">r = x - ((x - y) &amp; ((x - y) &gt;&gt; (<span class="keyword">sizeof</span>(<span class="keyword">int</span>) * CHAR_BIT - <span class="number">1</span>))); <span class="comment">// max(x, y)</span></div></pre></td></tr></table></figure><p>由于1989 ANSI C未规定有符号数右移的结果，所以该解法不可移植。如果溢出时抛出异常，那么减法时<code>x</code>与<code>y</code>的值就是无符号型或者被转换成无符号型来防止不必要的异常抛出。然而这里右移运算需要一个有符号的操作数，使得右移负数时填充1，所以这里转换成有符号整型。</p><p>作者注：</p><ul><li>2003年3月7日，Angus Duggan指出右移的可移植性问题。</li><li>2005年5月3日，Randal E. Bryant警告我说需要一个<code>INT_MIN &lt;= x - y &lt;= INT_MAX</code>的前提条件，并给出了一个慢而脏的修改版本。以上只在这个快而脏的解法里考虑了。</li><li>2005年7月6日，Nigel Horspoon观察到在奔腾上，由于gcc对<code>(x &lt; y)</code>的求值问题，它生成了和直接解法一样的代码。</li><li>2008年7月9日，Vincent Lefèvre指出<code>r = y + ((x - y) &amp; -(x &lt; y))</code>里的减法有潜在的溢出风险(这是我前一版的代码)。</li><li>2009年6月2日，Timothy B. Terriberry建议我使用异或而不是加减来避免溢出的危险。</li></ul><h2 id="检测一个数是不是2的次幂">检测一个数是不是2的次幂</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v; <span class="comment">// 要检测的数是v</span></div><div class="line"><span class="keyword">bool</span> f;         <span class="comment">// 存放结果</span></div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f = (v &amp; (v - <span class="number">1</span>)) == <span class="number">0</span>;</div></pre></td></tr></table></figure><p>注意<code>0</code>并不是2的多少次幂，因此做如下修改：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">f = v &amp;&amp; !(v &amp; (v - <span class="number">1</span>));</div></pre></td></tr></table></figure><h2 id="符号扩展">符号扩展</h2><h3 id="从给定位宽扩展">从给定位宽扩展</h3><p>符号扩展对于内建类型来说是自动的，比如从<code>char</code>到<code>int</code>. 但是，假设你有一个以<code>b</code>位补码表示的有符号整数<code>x</code>, 你想把<code>x</code>转换成<code>int</code>型的，此时存储空间大于<code>b</code>位。只是简单地复制的话，当<code>x</code>是正数的时候还可以，是负数的时候就不对了，必须进行符号扩展。例如，假设我们只用4位来存储数字，那么<code>-3</code>表示成二进制就是<code>1101</code>. 如果用8位来存，那么就是<code>11111101</code>. 当扩展一个负数的时候需要将扩展的高位全赋为1， 这就是符号扩展。在C语言里，符号扩展就是小事一桩，因为可以在<code>struct</code>或<code>union</code>里使用位域。例如，要将5位长整数扩展到<code>int</code>型：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> x; <span class="comment">// 将它从5位长转换到int</span></div><div class="line"><span class="keyword">int</span> r; <span class="comment">// 存放结果</span></div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">struct</span> &#123;</span><span class="keyword">signed</span> <span class="keyword">int</span> x:<span class="number">5</span>;&#125; s;</div><div class="line">r = s.x = x;</div></pre></td></tr></table></figure><p>下面是一个使用了相同语言特性的C++模板函数，仅用一个操作，就能从b位长扩展（尽管编译器生成的肯定不止这么点）：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T, <span class="keyword">unsigned</span> B&gt;</div><div class="line"><span class="function"><span class="keyword">inline</span> T <span class="title">signextend</span><span class="params">(<span class="keyword">const</span> T x)</span></span></div><div class="line">&#123;</div><div class="line">  <span class="class"><span class="keyword">struct</span> &#123;</span>T x:B;&#125; s;</div><div class="line">  <span class="keyword">return</span> s.x = x;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">int</span> r = signextend&lt;<span class="keyword">signed</span> <span class="keyword">int</span>,<span class="number">5</span>&gt;(x);  <span class="comment">// 从5位长的x扩展到int型的r</span></div></pre></td></tr></table></figure><p>作者注：</p><ul><li>2005年5月2日，John Byrd发现了代码里一处拼写错误（都是HTML的锅）。</li><li>2006年3月4日，Pat Wood指出ANSI C标准要求位域需要关键字<code>signed</code>来表示有符号数，否则其符号未定义。</li></ul><h3 id="从不定长位宽扩展">从不定长位宽扩展</h3><p>有时我们需要扩展的数并不知道它的位长<code>b</code>. 或者我们用的是一门没有位域特性的语言，比如 Java.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> b; <span class="comment">// 表示x的位长</span></div><div class="line"><span class="keyword">int</span> x;      <span class="comment">// 扩展这个b位长的数x</span></div><div class="line"><span class="keyword">int</span> r;      <span class="comment">// 存放结果</span></div><div class="line"><span class="keyword">int</span> <span class="keyword">const</span> m = <span class="number">1U</span> &lt;&lt; (b - <span class="number">1</span>); <span class="comment">// 如果给出b的话，位掩码可以提前算出来</span></div><div class="line"></div><div class="line">x = x &amp; ((<span class="number">1U</span> &lt;&lt; b) - <span class="number">1</span>);  <span class="comment">// 如果x的b位以上已经是0的话，跳过这一步</span></div><div class="line">r = (x ^ m) - m;</div></pre></td></tr></table></figure><p>上面的代码需要四次操作，但如果位宽给定的话，我们就只需要两个高效率的操作（假设高位已经全是0）。</p><p>一个牺牲了可移植性的稍快点的方法如下，这种方法并不要求<code>x</code>的<code>b</code>位以上的数字是0:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> <span class="keyword">const</span> m = CHAR_BIT * <span class="keyword">sizeof</span>(x) - b;</div><div class="line">r = (x &lt;&lt; m) &gt;&gt; m;</div></pre></td></tr></table></figure><p>作者注：</p><ul><li>2004年6月13日，Sean A. Irvine希望我能在本页加上这些符号扩展的方法。他给了我最初的版本<code>m = (1 &lt;&lt; (b - 1)) - 1; r = -(x &amp; ~m) | x</code>, 后来被我优化成了<code>m = 1U &lt;&lt; (b - 1); r = -(x &amp; m) | x</code>.</li><li>然而2007年5月11日，Shay Green给了我上面解法里的版本，比我的还少一次操作。</li><li>2008年10月15日，Vipin Sharma给我改进建议，考虑到了<code>x</code>的高位可能有<code>1</code>的情况。</li><li>2009年12月31日，Chris Pirazzi, 建议我加上下面要讲的那种解法。</li></ul><h3 id="从不定长位宽扩展-3次操作">从不定长位宽扩展，3次操作</h3><p>下面讲的这个解法可能在某些机器上较慢，因为它需要乘除法。该版本需要4次操作。如果你知道位宽<code>b</code>比1大，请使用<code>r = (x * multipliers[b]) / multipliers[b]</code>完成这种类型的符号扩展，它仅需3次操作，一次查表。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> b; <span class="comment">// 表示x的位长</span></div><div class="line"><span class="keyword">int</span> x;      <span class="comment">// 扩展这个b位长的数x</span></div><div class="line"><span class="keyword">int</span> r;      <span class="comment">// 存放结果</span></div><div class="line"></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> M(B) (1U &lt;&lt; ((sizeof(x) * CHAR_BIT) - B)) <span class="comment">// CHAR_BIT=bits/byte</span></span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> <span class="keyword">const</span> multipliers[] = </div><div class="line">&#123;</div><div class="line">  <span class="number">0</span>,     M(<span class="number">1</span>),  M(<span class="number">2</span>),  M(<span class="number">3</span>),  M(<span class="number">4</span>),  M(<span class="number">5</span>),  M(<span class="number">6</span>),  M(<span class="number">7</span>),</div><div class="line">  M(<span class="number">8</span>),  M(<span class="number">9</span>),  M(<span class="number">10</span>), M(<span class="number">11</span>), M(<span class="number">12</span>), M(<span class="number">13</span>), M(<span class="number">14</span>), M(<span class="number">15</span>),</div><div class="line">  M(<span class="number">16</span>), M(<span class="number">17</span>), M(<span class="number">18</span>), M(<span class="number">19</span>), M(<span class="number">20</span>), M(<span class="number">21</span>), M(<span class="number">22</span>), M(<span class="number">23</span>),</div><div class="line">  M(<span class="number">24</span>), M(<span class="number">25</span>), M(<span class="number">26</span>), M(<span class="number">27</span>), M(<span class="number">28</span>), M(<span class="number">29</span>), M(<span class="number">30</span>), M(<span class="number">31</span>),</div><div class="line">  M(<span class="number">32</span>)</div><div class="line">&#125;; <span class="comment">// (如果大于64位，继续添加)</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> <span class="keyword">const</span> divisors[] = </div><div class="line">&#123;</div><div class="line">  <span class="number">1</span>,    ~M(<span class="number">1</span>),  M(<span class="number">2</span>),  M(<span class="number">3</span>),  M(<span class="number">4</span>),  M(<span class="number">5</span>),  M(<span class="number">6</span>),  M(<span class="number">7</span>),</div><div class="line">  M(<span class="number">8</span>),  M(<span class="number">9</span>),  M(<span class="number">10</span>), M(<span class="number">11</span>), M(<span class="number">12</span>), M(<span class="number">13</span>), M(<span class="number">14</span>), M(<span class="number">15</span>),</div><div class="line">  M(<span class="number">16</span>), M(<span class="number">17</span>), M(<span class="number">18</span>), M(<span class="number">19</span>), M(<span class="number">20</span>), M(<span class="number">21</span>), M(<span class="number">22</span>), M(<span class="number">23</span>),</div><div class="line">  M(<span class="number">24</span>), M(<span class="number">25</span>), M(<span class="number">26</span>), M(<span class="number">27</span>), M(<span class="number">28</span>), M(<span class="number">29</span>), M(<span class="number">30</span>), M(<span class="number">31</span>),</div><div class="line">  M(<span class="number">32</span>)</div><div class="line">&#125;; <span class="comment">// (同上)</span></div><div class="line"><span class="meta">#<span class="meta-keyword">undef</span> M</span></div><div class="line"></div><div class="line">r = (x * multipliers[b]) / divisors[b];</div></pre></td></tr></table></figure><p>下面的这个变体并不可移植，但在使用算数右移的架构上，能保留符号，应该能快一点。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> s = -b; <span class="comment">// 或者:  sizeof(x) * CHAR_BIT - b;</span></div><div class="line">r = (x &lt;&lt; s) &gt;&gt; s;</div></pre></td></tr></table></figure><p>作者注：</p><ul><li>2005年5月3日Randal E. Bryant发现了早期版本里的一个bug(把<code>multipliers[]</code>用作了<code>divisors[]</code>)，导致了当<code>x=1,b=1</code>的时候出错。</li></ul><h2 id="选择性地置位清零-不利用分支">选择性地置位清零，不利用分支</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">bool</span> f;         <span class="comment">// 表示条件</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> m; <span class="comment">// 位掩码</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> w; <span class="comment">// 待修改的输入：if (f) w |= m; else w &amp;= ~m;</span></div><div class="line"></div><div class="line">w ^= (-f ^ w) &amp; m;</div><div class="line"></div><div class="line"><span class="comment">// 或，针对超标量CPU架构：</span></div><div class="line">w = (w &amp; ~m) | (-f &amp; m);</div></pre></td></tr></table></figure><p>作者注：</p><ul><li>在某些架构上，没有条件分支要强于使用多两倍的操作数量来计算分支。例如，据非正式测试显示，在AMD Athlon™ XP 2100+上能快上5-10%. Intel Core 2 Duo运行超标量版比普通版快了约16%.</li><li>2003年12月11日，Glenn Slayden告诉了我第一个版本。</li><li>2007年4月3日，Marco Yu告诉了我超标量版并于两天后指出了两个拼写错误。</li></ul><h2 id="选择性地取负-不利用分支">选择性地取负，不利用分支</h2><p>如果你希望仅当条件为假的时候取负，下面是不涉及条件分支的版本：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">bool</span> fDontNegate;  <span class="comment">// 标识我们什么时候不对v取反</span></div><div class="line"><span class="keyword">int</span> v;             <span class="comment">// 待操作的数v</span></div><div class="line"><span class="keyword">int</span> r;             <span class="comment">// result = fDontNegate ? v : -v;</span></div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r = (fDontNegate ^ (fDontNegate - <span class="number">1</span>)) * v;</div></pre></td></tr></table></figure><p>如果你希望当条件为真时操作：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">bool</span> fNegate;  <span class="comment">// 标识我们什么时候对v取反</span></div><div class="line"><span class="keyword">int</span> v;         <span class="comment">// 待操作的数v</span></div><div class="line"><span class="keyword">int</span> r;         <span class="comment">// result = fNegate ? -v : v;</span></div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r = (v ^ -fNegate) + fNegate;</div></pre></td></tr></table></figure><p>作者注：</p><ul><li>2009年6月2日，Avraham Plotnitzky建议我加上第一个版本。</li><li>我又想避免使用乘法，因此在2009年6月8日想出了第二个版本。</li><li>2009年11月26日，Alfonso De Gregorio指出我丢了几个括号，并收到了bug奖励。</li></ul><h2 id="根据掩码合并两个数">根据掩码合并两个数</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> a;    <span class="comment">// 合并未屏蔽位</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> b;    <span class="comment">// 合并屏蔽位</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> mask; <span class="comment">// 1表示要合并b的对应位; 0针对a.</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> r;    <span class="comment">// (a &amp; ~mask) | (b &amp; mask) 的结果</span></div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r = a ^ ((a ^ b) &amp; mask);</div></pre></td></tr></table></figure><p>相比合并两个数的直接解法，我的比它少了一个操作。如果掩码是常量的话，这种方法不占任何优势。</p><p>作者注：</p><ul><li>2006年2月9日，Ron Jeffery给了我这个。</li></ul><h2 id="统计数位中1的个数">统计数位中1的个数</h2><h3 id="简单粗暴的解法">简单粗暴的解法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v; <span class="comment">// 待统计的数</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> c; <span class="comment">// 用来累加计数</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; v; v &gt;&gt;= <span class="number">1</span>)</div><div class="line">&#123;</div><div class="line">  c += v &amp; <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>这种解法每一位一次循环，直到没有<code>1</code>. 所以对一个只有最高位是<code>1</code>的32位数来说，它会循环32次。</p><h3 id="查表法">查表法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> BitsSetTable256[<span class="number">256</span>] = </div><div class="line">&#123;</div><div class="line">#   define B2(n) n,     n+<span class="number">1</span>,     n+<span class="number">1</span>,     n+<span class="number">2</span></div><div class="line">#   define B4(n) B2(n), B2(n+<span class="number">1</span>), B2(n+<span class="number">1</span>), B2(n+<span class="number">2</span>)</div><div class="line">#   define B6(n) B4(n), B4(n+<span class="number">1</span>), B4(n+<span class="number">1</span>), B4(n+<span class="number">2</span>)</div><div class="line">    B6(<span class="number">0</span>), B6(<span class="number">1</span>), B6(<span class="number">1</span>), B6(<span class="number">2</span>)</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v; <span class="comment">// 待统计的数</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> c; <span class="comment">// 统计1的个数</span></div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">c = BitsSetTable256[v &amp; <span class="number">0xff</span>] + </div><div class="line">    BitsSetTable256[(v &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>] + </div><div class="line">    BitsSetTable256[(v &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>] + </div><div class="line">    BitsSetTable256[v &gt;&gt; <span class="number">24</span>];</div></pre></td></tr></table></figure><p>或者:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> * p = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *) &amp;v;</div><div class="line">c = BitsSetTable256[p[<span class="number">0</span>]] + </div><div class="line">    BitsSetTable256[p[<span class="number">1</span>]] + </div><div class="line">    BitsSetTable256[p[<span class="number">2</span>]] +</div><div class="line">    BitsSetTable256[p[<span class="number">3</span>]];</div></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 用算法来初始化数组</span></div><div class="line">BitsSetTable256[<span class="number">0</span>] = <span class="number">0</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++)</div><div class="line">&#123;</div><div class="line">  BitsSetTable256[i] = (i &amp; <span class="number">1</span>) + BitsSetTable256[i / <span class="number">2</span>];</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>作者注：</p><ul><li>2009年7月14日Hallvard Furuseth建议我使用宏来生成表。</li></ul><h3 id="brian-kernighan的方法">Brian Kernighan的方法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v;</div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> c;</div><div class="line"><span class="keyword">for</span> (c = <span class="number">0</span>; v; c++)</div><div class="line">&#123;</div><div class="line">  v &amp;= v - <span class="number">1</span>; <span class="comment">// 清除最低非0位</span></div><div class="line">&#125;</div></pre></td></tr></table></figure><p>这种方法的循环次数和<code>1</code>的个数一样多。所以如果有一个只有最高位是<code>1</code>的数，只会循环一次。</p><p>作者注：</p><ul><li>该方法发表于1988, <em>the C Programming Language 2nd Ed</em> (作者Brian W. Kernighan和Dennis M. Ritchie). 书中练习2-9提到了这种方法。</li><li>2006年4月19日，Don Knuth指出这种方法是由Peter Wegner在 <em>CACM 3</em> (1960), 322第一次发表。（同时也由Derrick Lehmer指出该方法在1964年Beckenbach编过的一本书里发表过。）</li></ul><h3 id="针对14-24-或32位长数字-使用64位指令集">针对14, 24, 或32位长数字，使用64位指令集</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v;</div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> c;</div><div class="line"></div><div class="line"><span class="comment">// 针对至多14位长的v:</span></div><div class="line">c = (v * <span class="number">0x200040008001</span>ULL &amp; <span class="number">0x111111111111111</span>ULL) % <span class="number">0xf</span>;</div><div class="line"></div><div class="line"><span class="comment">// 针对至多24位长的v:</span></div><div class="line">c =  ((v &amp; <span class="number">0xfff</span>) * <span class="number">0x1001001001001</span>ULL &amp; <span class="number">0x84210842108421</span>ULL) % <span class="number">0x1f</span>;</div><div class="line">c += (((v &amp; <span class="number">0xfff000</span>) &gt;&gt; <span class="number">12</span>) * <span class="number">0x1001001001001</span>ULL &amp; <span class="number">0x84210842108421</span>ULL) </div><div class="line">     % <span class="number">0x1f</span>;</div><div class="line"></div><div class="line"><span class="comment">// 针对至多32位长的v:</span></div><div class="line">c =  ((v &amp; <span class="number">0xfff</span>) * <span class="number">0x1001001001001</span>ULL &amp; <span class="number">0x84210842108421</span>ULL) % <span class="number">0x1f</span>;</div><div class="line">c += (((v &amp; <span class="number">0xfff000</span>) &gt;&gt; <span class="number">12</span>) * <span class="number">0x1001001001001</span>ULL &amp; <span class="number">0x84210842108421</span>ULL) % </div><div class="line">     <span class="number">0x1f</span>;</div><div class="line">c += ((v &gt;&gt; <span class="number">24</span>) * <span class="number">0x1001001001001</span>ULL &amp; <span class="number">0x84210842108421</span>ULL) % <span class="number">0x1f</span>;</div></pre></td></tr></table></figure><p>该方法需要能快速求余的64位CPU才能高效率。14位长的只需要3次操作；24位的需要10次；32位15次。</p><p>作者注：</p><ul><li>Rich Schroeppel最初原创了针对9位的求法，类似于我这里的14位的方法；详见<a href="http://www.inwap.com/pdp10/hbaker/hakmem/hakmem.html" target="_blank" rel="external">Beeler, M., Gosper, R. W., and Schroeppel, R. HAKMEM. MIT AI Memo 239, Feb. 29, 1972.</a>的Programming Hacks部分。它启发了Sean Anderson(译注：作者自己), 并想出了上面的几种方法。</li><li>2005年5月3日，Randal E. Bryant找出了一堆bug.</li><li>2007年2月1日，Bruce Dawson对12位方法做了微调，使之变成了现在的14位版本。</li></ul><h3 id="并行方法">并行方法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v; <span class="comment">// 要统计v(32位数值)</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> c; <span class="comment">// 存放结果</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> S[] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">8</span>, <span class="number">16</span>&#125;; <span class="comment">// 二进制魔法数字</span></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> B[] = &#123;<span class="number">0x55555555</span>, <span class="number">0x33333333</span>, <span class="number">0x0F0F0F0F</span>, <span class="number">0x00FF00FF</span>, <span class="number">0x0000FFFF</span>&#125;;</div><div class="line"></div><div class="line">c = v - ((v &gt;&gt; <span class="number">1</span>) &amp; B[<span class="number">0</span>]);</div><div class="line">c = ((c &gt;&gt; S[<span class="number">1</span>]) &amp; B[<span class="number">1</span>]) + (c &amp; B[<span class="number">1</span>]);</div><div class="line">c = ((c &gt;&gt; S[<span class="number">2</span>]) + c) &amp; B[<span class="number">2</span>];</div><div class="line">c = ((c &gt;&gt; S[<span class="number">3</span>]) + c) &amp; B[<span class="number">3</span>];</div><div class="line">c = ((c &gt;&gt; S[<span class="number">4</span>]) + c) &amp; B[<span class="number">4</span>];</div></pre></td></tr></table></figure><p>数组<code>B</code>表示为二进制，就是：</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">B[0] = 0x55555555 = 01010101 01010101 01010101 01010101</div><div class="line">B[1] = 0x33333333 = 00110011 00110011 00110011 00110011</div><div class="line">B[2] = 0x0F0F0F0F = 00001111 00001111 00001111 00001111</div><div class="line">B[3] = 0x00FF00FF = 00000000 11111111 00000000 11111111</div><div class="line">B[4] = 0x0000FFFF = 00000000 00000000 11111111 11111111</div></pre></td></tr></table></figure><p>对于大点的数据，我们可以延长魔法数字<code>B</code>和<code>S</code>来适配。如果数字有<code>k</code>位，数组<code>S</code>和<code>B</code>就应该有$\lceil \lg(k) \rceil$个元素，而且我们要写出关于<code>c</code>的同样多个数的表达式。对于一个32位长的<code>v</code>, 进行了16次操作。</p><p>对于一个32位整数<code>v</code>的最佳解法是：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">v = v - ((v &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555</span>);                    <span class="comment">// 用v来存储中间值</span></div><div class="line">v = (v &amp; <span class="number">0x33333333</span>) + ((v &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x33333333</span>);     <span class="comment">// 同上</span></div><div class="line">c = ((v + (v &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0xF0F0F0F</span>) * <span class="number">0x1010101</span>) &gt;&gt; <span class="number">24</span>; <span class="comment">// 计数</span></div></pre></td></tr></table></figure><p>该解法只用了12次操作，与查表法的相同，并避免使用额外内存和缓存未命中表的情况。该解法混合了上面并行法和更前面的使用乘法的解法（使用64位指令集的那个解法），然而它并没有用到64位指令集。统计在并行部分完成，计数求和由乘以<code>0x1010101</code>并右移24位完成。</p><p>一个最佳通用解法如下，它最多支持到128位（参数化表示为<code>T</code>）：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">v = v - ((v &gt;&gt; <span class="number">1</span>) &amp; (T)~(T)<span class="number">0</span>/<span class="number">3</span>);                           <span class="comment">// 中间值</span></div><div class="line">v = (v &amp; (T)~(T)<span class="number">0</span>/<span class="number">15</span>*<span class="number">3</span>) + ((v &gt;&gt; <span class="number">2</span>) &amp; (T)~(T)<span class="number">0</span>/<span class="number">15</span>*<span class="number">3</span>);      <span class="comment">// 同上</span></div><div class="line">v = (v + (v &gt;&gt; <span class="number">4</span>)) &amp; (T)~(T)<span class="number">0</span>/<span class="number">255</span>*<span class="number">15</span>;                      <span class="comment">// 同上</span></div><div class="line">c = (T)(v * ((T)~(T)<span class="number">0</span>/<span class="number">255</span>)) &gt;&gt; (<span class="keyword">sizeof</span>(T) - <span class="number">1</span>) * CHAR_BIT; <span class="comment">// 计数</span></div></pre></td></tr></table></figure><p>作者注：</p><ul><li>更多信息见Ian Ashdown的<a href="http://groups.google.com/groups?q=reverse+bits&amp;num=100&amp;hl=en&amp;group=comp.graphics.algorithms&amp;imgsafe=off&amp;safe=off&amp;rnum=2&amp;ic=1&amp;selm=4fulhm%248dn%40atlas.uniserve.com" target="_blank" rel="external">贴子</a>。</li><li>最佳解法是2005年10月5日由Andrew Shapira告诉我的；他在<a href="http://www.amd.com/us-en/assets/content_type/white_papers_and_tech_docs/25112.PDF" target="_blank" rel="external">Software Optimization Guide for AMD Athlon™ 64 and Opteron™ Processors</a>的187-188页找到了它。</li><li>2005年12月14日Charlie Gordon给了我一个能优化掉一次操作的建议。</li><li>2005年12月30日Don Clugston从中整理出了三种方法。</li><li>我接受了建议后又犯了几个拼写错误，于2006年1月8日由Eric Cole指出。此后，他给了上面那个通用解法的建议。</li><li>2007年4月5日，Al Williams告知我在最开始的方法里有一句冗余代码。</li></ul><h3 id="从最高位到指定位">从最高位到指定位</h3><p>下面给出求从最高位到指定位<code>1</code>的个数（rank）的解法：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uint64_t</span> v;       <span class="comment">// 待计算的数v</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> pos; <span class="comment">// 指定的位置</span></div><div class="line"><span class="keyword">uint64_t</span> r;       <span class="comment">// 存放结果</span></div><div class="line"></div><div class="line"><span class="comment">// 将给定位置以下的数字删除.</span></div><div class="line">r = v &gt;&gt; (<span class="keyword">sizeof</span>(v) * CHAR_BIT - pos);</div><div class="line"><span class="comment">// 并行计算</span></div><div class="line"><span class="comment">// r = (r &amp; 0x5555...) + ((r &gt;&gt; 1) &amp; 0x5555...);</span></div><div class="line">r = r - ((r &gt;&gt; <span class="number">1</span>) &amp; ~<span class="number">0U</span>L/<span class="number">3</span>);</div><div class="line"><span class="comment">// r = (r &amp; 0x3333...) + ((r &gt;&gt; 2) &amp; 0x3333...);</span></div><div class="line">r = (r &amp; ~<span class="number">0U</span>L/<span class="number">5</span>) + ((r &gt;&gt; <span class="number">2</span>) &amp; ~<span class="number">0U</span>L/<span class="number">5</span>);</div><div class="line"><span class="comment">// r = (r &amp; 0x0f0f...) + ((r &gt;&gt; 4) &amp; 0x0f0f...);</span></div><div class="line">r = (r + (r &gt;&gt; <span class="number">4</span>)) &amp; ~<span class="number">0U</span>L/<span class="number">17</span>;</div><div class="line"><span class="comment">// r = r % 255;</span></div><div class="line">r = (r * (~<span class="number">0U</span>L/<span class="number">255</span>)) &gt;&gt; ((<span class="keyword">sizeof</span>(v) - <span class="number">1</span>) * CHAR_BIT);</div></pre></td></tr></table></figure><p>作者注：</p><ul><li>2009年11月21日，Juha Järvi给了我这个下面问题的镜像问题。</li></ul><h3 id="已知rank求出位数">已知rank求出位数</h3><p>下面的64位代码计算出从左至右第<code>r</code>个<code>1</code>. 也就是说，从最高位向右统计1的个数，直到得到rank<code>r</code>, 返回对应的这个位。如果给出的rank超出了范围，返回<code>64</code>. 代码可以针对32位或者从左往右计算做出修改。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">uint64_t</span> v;          <span class="comment">// 待计算的数v</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> r;      <span class="comment">// 输入rank, 范围是1~64.</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> s;      <span class="comment">// 输出rank对应的位数</span></div><div class="line"><span class="keyword">uint64_t</span> a, b, c, d; <span class="comment">// 中间变量</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> t;      <span class="comment">// 位数统计</span></div><div class="line"></div><div class="line"><span class="comment">// 对64位整数做并行处理，中间结果都存储起来</span></div><div class="line"><span class="comment">// a = (v &amp; 0x5555...) + ((v &gt;&gt; 1) &amp; 0x5555...);</span></div><div class="line">a =  v - ((v &gt;&gt; <span class="number">1</span>) &amp; ~<span class="number">0U</span>L/<span class="number">3</span>);</div><div class="line"><span class="comment">// b = (a &amp; 0x3333...) + ((a &gt;&gt; 2) &amp; 0x3333...);</span></div><div class="line">b = (a &amp; ~<span class="number">0U</span>L/<span class="number">5</span>) + ((a &gt;&gt; <span class="number">2</span>) &amp; ~<span class="number">0U</span>L/<span class="number">5</span>);</div><div class="line"><span class="comment">// c = (b &amp; 0x0f0f...) + ((b &gt;&gt; 4) &amp; 0x0f0f...);</span></div><div class="line">c = (b + (b &gt;&gt; <span class="number">4</span>)) &amp; ~<span class="number">0U</span>L/<span class="number">0x11</span>;</div><div class="line"><span class="comment">// d = (c &amp; 0x00ff...) + ((c &gt;&gt; 8) &amp; 0x00ff...);</span></div><div class="line">d = (c + (c &gt;&gt; <span class="number">8</span>)) &amp; ~<span class="number">0U</span>L/<span class="number">0x101</span>;</div><div class="line">t = (d &gt;&gt; <span class="number">32</span>) + (d &gt;&gt; <span class="number">48</span>);</div><div class="line"><span class="comment">// 开始不使用条件分支的计算</span></div><div class="line">s  = <span class="number">64</span>;</div><div class="line"><span class="comment">// if (r &gt; t) &#123;s -= 32; r -= t;&#125;</span></div><div class="line">s -= ((t - r) &amp; <span class="number">256</span>) &gt;&gt; <span class="number">3</span>; r -= (t &amp; ((t - r) &gt;&gt; <span class="number">8</span>));</div><div class="line">t  = (d &gt;&gt; (s - <span class="number">16</span>)) &amp; <span class="number">0xff</span>;</div><div class="line"><span class="comment">// if (r &gt; t) &#123;s -= 16; r -= t;&#125;</span></div><div class="line">s -= ((t - r) &amp; <span class="number">256</span>) &gt;&gt; <span class="number">4</span>; r -= (t &amp; ((t - r) &gt;&gt; <span class="number">8</span>));</div><div class="line">t  = (c &gt;&gt; (s - <span class="number">8</span>)) &amp; <span class="number">0xf</span>;</div><div class="line"><span class="comment">// if (r &gt; t) &#123;s -= 8; r -= t;&#125;</span></div><div class="line">s -= ((t - r) &amp; <span class="number">256</span>) &gt;&gt; <span class="number">5</span>; r -= (t &amp; ((t - r) &gt;&gt; <span class="number">8</span>));</div><div class="line">t  = (b &gt;&gt; (s - <span class="number">4</span>)) &amp; <span class="number">0x7</span>;</div><div class="line"><span class="comment">// if (r &gt; t) &#123;s -= 4; r -= t;&#125;</span></div><div class="line">s -= ((t - r) &amp; <span class="number">256</span>) &gt;&gt; <span class="number">6</span>; r -= (t &amp; ((t - r) &gt;&gt; <span class="number">8</span>));</div><div class="line">t  = (a &gt;&gt; (s - <span class="number">2</span>)) &amp; <span class="number">0x3</span>;</div><div class="line"><span class="comment">// if (r &gt; t) &#123;s -= 2; r -= t;&#125;</span></div><div class="line">s -= ((t - r) &amp; <span class="number">256</span>) &gt;&gt; <span class="number">7</span>; r -= (t &amp; ((t - r) &gt;&gt; <span class="number">8</span>));</div><div class="line">t  = (v &gt;&gt; (s - <span class="number">1</span>)) &amp; <span class="number">0x1</span>;</div><div class="line"><span class="comment">// if (r &gt; t) s--;</span></div><div class="line">s -= ((t - r) &amp; <span class="number">256</span>) &gt;&gt; <span class="number">8</span>;</div><div class="line">s = <span class="number">65</span> - s;</div></pre></td></tr></table></figure><p>如果分支在你的CPU上速度很快的话，取消使用注释里的条件语句进行替换。</p><h2 id="奇偶校验">奇偶校验</h2><p>译注：信息是以比特流的方式传输的，类似<code>01000001</code>. 在传输过程中，有可能会发生错误，比如，我们存储了<code>01000001</code>，但是取出来却是<code>01000000</code>，即低位由0变成了1。为了检测到这种错误，我们可以通过“奇偶校验”来实现。假如，我们存储的数据是一个字节，8个比特位，那我们就可以计算每个字节比特位是<code>1</code>的个数，如果是偶数个<code>1</code>，那么，我们就把第九个位设为<code>1</code>，如果是奇数个<code>1</code>，那么就把第九个位设为<code>0</code>，这样连续9个字节比特位为<code>1</code>的位数肯定是奇数。这种方法叫做“奇校验”，“偶校验”和此类似。当然，在实际应用中，也可以把一个字节的前7位作为数据位，最后一个为作为校验位。</p><h3 id="简单粗暴的解法-v2">简单粗暴的解法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v;       <span class="comment">// 待检验的数v</span></div><div class="line"><span class="keyword">bool</span> parity = <span class="literal">false</span>;  <span class="comment">// 存放结果，奇数个为true</span></div><div class="line"></div><div class="line"><span class="keyword">while</span> (v)</div><div class="line">&#123;</div><div class="line">  parity = !parity;</div><div class="line">  v = v &amp; (v - <span class="number">1</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>该解法使用了类似于前述Brian Kernigan解法的思路，消耗时间与二进制<code>1</code>的数量成正比。</p><h3 id="查表法-v2">查表法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">bool</span> ParityTable256[<span class="number">256</span>] = </div><div class="line">&#123;</div><div class="line">#   define P2(n) n, n^<span class="number">1</span>, n^<span class="number">1</span>, n</div><div class="line">#   define P4(n) P2(n), P2(n^<span class="number">1</span>), P2(n^<span class="number">1</span>), P2(n)</div><div class="line">#   define P6(n) P4(n), P4(n^<span class="number">1</span>), P4(n^<span class="number">1</span>), P4(n)</div><div class="line">    P6(<span class="number">0</span>), P6(<span class="number">1</span>), P6(<span class="number">1</span>), P6(<span class="number">0</span>)</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> b;  <span class="comment">// 待计算的数b</span></div><div class="line"><span class="keyword">bool</span> parity = ParityTable256[b];</div><div class="line"></div><div class="line"><span class="comment">// 针对32位长的数：</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v;</div><div class="line">v ^= v &gt;&gt; <span class="number">16</span>;</div><div class="line">v ^= v &gt;&gt; <span class="number">8</span>;</div><div class="line"><span class="keyword">bool</span> parity = ParityTable256[v &amp; <span class="number">0xff</span>];</div><div class="line"></div><div class="line"><span class="comment">// 变体：</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> * p = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *) &amp;v;</div><div class="line">parity = ParityTable256[p[<span class="number">0</span>] ^ p[<span class="number">1</span>] ^ p[<span class="number">2</span>] ^ p[<span class="number">3</span>]];</div></pre></td></tr></table></figure><p>作者注：</p><ul><li>2005年5月3日Randal E. Bryant支持我加上那个很直接的解法（最后那个变体）。</li><li>2005年9月27日，Bruce Rawles找到了几个表名的拼写错误，并因此收到了$10的找bug奖金。</li><li>2006年10月9日，Fabrice Bellard给了我上面的32位长的版本，它只需一次查表，原来的版本需要4次查表，更慢。</li><li>2009年7月14日Hallvard Furuseth建议我使用宏来生成表。</li></ul><h3 id="使用64位指令集的乘法和求余">使用64位指令集的乘法和求余</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> b;  <span class="comment">// 待计算的数b</span></div><div class="line"><span class="keyword">bool</span> parity = (((b * <span class="number">0x0101010101010101</span>ULL) &amp; <span class="number">0x8040201008040201</span>ULL) % <span class="number">0x1FF</span>) &amp; <span class="number">1</span>;</div></pre></td></tr></table></figure><p>上面的方法大概需要4次操作，但只对整字节有效。</p><h3 id="使用一次乘法">使用一次乘法</h3><p>以下方法能仅用8次操作处理一个32位长的数值，而且只用了一次乘法。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v; <span class="comment">// 32-bit word</span></div><div class="line">v ^= v &gt;&gt; <span class="number">1</span>;</div><div class="line">v ^= v &gt;&gt; <span class="number">2</span>;</div><div class="line">v = (v &amp; <span class="number">0x11111111</span>U) * <span class="number">0x11111111</span>U;</div><div class="line"><span class="keyword">return</span> (v &gt;&gt; <span class="number">28</span>) &amp; <span class="number">1</span>;</div></pre></td></tr></table></figure><p>对于64位长的，8次操作也足够：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">long</span> <span class="keyword">long</span> v; <span class="comment">// 64-bit word</span></div><div class="line">v ^= v &gt;&gt; <span class="number">1</span>;</div><div class="line">v ^= v &gt;&gt; <span class="number">2</span>;</div><div class="line">v = (v &amp; <span class="number">0x1111111111111111</span>UL) * <span class="number">0x1111111111111111</span>UL;</div><div class="line"><span class="keyword">return</span> (v &gt;&gt; <span class="number">60</span>) &amp; <span class="number">1</span>;</div></pre></td></tr></table></figure><p>作者注：</p><ul><li>Andrew Shapira想出了这个方法并于2007年9月2日给了我。</li></ul><h3 id="并行法">并行法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v;</div><div class="line">v ^= v &gt;&gt; <span class="number">16</span>;</div><div class="line">v ^= v &gt;&gt; <span class="number">8</span>;</div><div class="line">v ^= v &gt;&gt; <span class="number">4</span>;</div><div class="line">v &amp;= <span class="number">0xf</span>;</div><div class="line"><span class="keyword">return</span> (<span class="number">0x6996</span> &gt;&gt; v) &amp; <span class="number">1</span>;</div></pre></td></tr></table></figure><p>以上方法需要大概9次操作，对32位的有效。对于整字节也可以删掉<code>unsigned int v</code>后面的两行来优化到只用5次操作。该方法首先使用移位和异或对v的每段（每段8bit）进行处理，异或后只取后4个bit, 然后二进制数<code>0110 1001 1001 0110</code>(16进制是<code>0x6996</code>)右移这么多位。这就好像是拿<code>v</code>的后四位去小型的16位奇偶表里去查。<code>v</code>的奇偶结果以二进制<code>1</code>的形式保存并返回。</p><p>作者注：</p><ul><li>感谢Mathew Hendry于2002年12月15日告诉我的移位-查表方法。优化后能少两次操作并且只用了移位和异或。</li></ul><h2 id="交换两个数的值">交换两个数的值</h2><h3 id="使用加减法">使用加减法</h3><p>译注：不要把右值往<code>a</code>, <code>b</code>里代入。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SWAP(a, b) ((&amp;(a) == &amp;(b)) || \</span></div><div class="line">                    (((a) -= (b)), ((b) += (a)), ((a) = (b) - (a))))</div></pre></td></tr></table></figure><p>该方法能不使用额外的临时变量来交换<code>a</code>和<code>b</code>的值。开始的那句是检查<code>a</code>与<code>b</code>是否使用了同一块内存空间，是的话那么该方法结果就不对了（编译器可能会把这个检查优化掉）。如果你开启了溢出异常检测，那么要传递无符号值以避免触发异常。下面的异或方法在某些机器上可能会快一点。不要对浮点数也这么操作，除非你操作的是它们的二进制值。</p><p>作者注：</p><ul><li>2007年6月12日Sanjeev Sivasankaran建议我加上这一条。</li><li>2008年7月9日Vincent Lefèvre指出它有潜在的溢出风险。</li></ul><h3 id="使用异或">使用异或</h3><p>译注：同上。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SWAP(a, b) (((a) ^= (b)), ((b) ^= (a)), ((a) ^= (b)))</span></div></pre></td></tr></table></figure><p>这是一种很古老的，不使用额外临时变量的交换技巧。</p><p>作者注：</p><ul><li>2005年1月20日，Iain A. Fleming指出该方法当作用于同一内存空间的时候失效，比如我当<code>i==j</code>的时候<code>SWAP(a[i], a[j])</code>. 所以为避免这种情况的发生，把宏定义改成<code>(((a) == (b)) || (((a) ^= (b)), ((b) ^= (a)), ((a) ^= (b))))</code>.</li><li>2009年7月14日，Hallvard Furuseth告诉我说，在某些机器上<code>(((a) ^ (b)) &amp;&amp; ((b) ^= (a) ^= (b), (a) ^= (b)))</code>会更快一点，因为<code>(a) ^ (b)</code>的值能重复利用。</li></ul><h3 id="交换指定的某几个二进制位">交换指定的某几个二进制位</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> i, j; <span class="comment">// 给定位置</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> n;    <span class="comment">// 想交换多少位</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> b;    <span class="comment">// 被交换数b</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> r;    <span class="comment">// 交换结果</span></div><div class="line"></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> x = ((b &gt;&gt; i) ^ (b &gt;&gt; j)) &amp; ((<span class="number">1U</span> &lt;&lt; n) - <span class="number">1</span>); <span class="comment">// 中间变量</span></div><div class="line">r = b ^ ((x &lt;&lt; i) | (x &lt;&lt; j));</div></pre></td></tr></table></figure><p>举个例子，假如我们有个数<code>b = 00101111</code>(二进制表示)，我们想把它里面从<code>i = 1</code>开始的连续<code>n = 3</code>位与从<code>j = 5</code>开始的连续<code>n</code>位交换，其结果应该是<code>r = 11100011</code>(二进制表示)。</p><p>该方法的思路与异或法相似。<code>x</code>用于保存我们想要交换的那几位，然后这几位的值被赋值为它们自己与<code>x</code>的异或结果。当然，如果序列超出范围其结果未定义。</p><p>作者注：</p><ul><li>2009年7月14日，Hallvard Furuseth建议我把<code>1 &lt;&lt; n</code>改成<code>1U &lt;&lt; n</code>来强行赋值为无符号型来避免对意外地有符号数移位。</li></ul><h2 id="倒置二进制位">倒置二进制位</h2><h3 id="直接解法">直接解法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v;     <span class="comment">// 待处理的数v</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> r = v; <span class="comment">// r存放结果</span></div><div class="line"><span class="keyword">int</span> s = <span class="keyword">sizeof</span>(v) * CHAR_BIT - <span class="number">1</span>; <span class="comment">// 最后一步的额外处理</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> (v &gt;&gt;= <span class="number">1</span>; v; v &gt;&gt;= <span class="number">1</span>)</div><div class="line">&#123;</div><div class="line">  r &lt;&lt;= <span class="number">1</span>;</div><div class="line">  r |= v &amp; <span class="number">1</span>;</div><div class="line">  s--;</div><div class="line">&#125;</div><div class="line">r &lt;&lt;= s; <span class="comment">// 当v的最高位是0的时候移位</span></div></pre></td></tr></table></figure><p>作者注：</p><ul><li>2004年10月15日，Michael Hoisie指出最初版本有一个bug.</li><li>2005年5月3日Randal E. Bryant建议我删掉一个冗余操作。2005年5月18日Behdad Esfabod给了我一个小建议，它能减少一次循环。</li><li>2007年2月6日，Liyong Zhou给了我点建议，使得循环只在<code>v</code>不是0的时候运行，而不是对每一位都循环一次。</li></ul><h3 id="查表法-v3">查表法</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> BitReverseTable256[<span class="number">256</span>] = </div><div class="line">&#123;</div><div class="line">#   define R2(n)     n,     n + <span class="number">2</span>*<span class="number">64</span>,     n + <span class="number">1</span>*<span class="number">64</span>,     n + <span class="number">3</span>*<span class="number">64</span></div><div class="line">#   define R4(n) R2(n), R2(n + <span class="number">2</span>*<span class="number">16</span>), R2(n + <span class="number">1</span>*<span class="number">16</span>), R2(n + <span class="number">3</span>*<span class="number">16</span>)</div><div class="line">#   define R6(n) R4(n), R4(n + <span class="number">2</span>*<span class="number">4</span> ), R4(n + <span class="number">1</span>*<span class="number">4</span> ), R4(n + <span class="number">3</span>*<span class="number">4</span> )</div><div class="line">    R6(<span class="number">0</span>), R6(<span class="number">2</span>), R6(<span class="number">1</span>), R6(<span class="number">3</span>)</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v; <span class="comment">// 32位值，每次倒置8位</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> c; <span class="comment">// v倒置的结果</span></div><div class="line"></div><div class="line"><span class="comment">// Option 1:</span></div><div class="line">c = (BitReverseTable256[v &amp; <span class="number">0xff</span>] &lt;&lt; <span class="number">24</span>) | </div><div class="line">    (BitReverseTable256[(v &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xff</span>] &lt;&lt; <span class="number">16</span>) | </div><div class="line">    (BitReverseTable256[(v &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xff</span>] &lt;&lt; <span class="number">8</span>) |</div><div class="line">    (BitReverseTable256[(v &gt;&gt; <span class="number">24</span>) &amp; <span class="number">0xff</span>]);</div><div class="line"></div><div class="line"><span class="comment">// Option 2:</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> * p = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *) &amp;v;</div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> * q = (<span class="keyword">unsigned</span> <span class="keyword">char</span> *) &amp;c;</div><div class="line">q[<span class="number">3</span>] = BitReverseTable256[p[<span class="number">0</span>]]; </div><div class="line">q[<span class="number">2</span>] = BitReverseTable256[p[<span class="number">1</span>]]; </div><div class="line">q[<span class="number">1</span>] = BitReverseTable256[p[<span class="number">2</span>]]; </div><div class="line">q[<span class="number">0</span>] = BitReverseTable256[p[<span class="number">3</span>]];</div></pre></td></tr></table></figure><p>第一个方法要用17次操作，第二种需要12次，如果你的CPU能够快速读取和存储数据的话。</p><p>作者注：</p><ul><li>2009年7月14日Hallvard Furuseth建议我使用宏来生成表。</li></ul><h3 id="倒置一比特-仅用3次操作-使用64位的乘法和求余">倒置一比特，仅用3次操作（使用64位的乘法和求余）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> b; <span class="comment">// reverse this (8-bit) byte</span></div><div class="line"> </div><div class="line">b = (b * <span class="number">0x0202020202</span>ULL &amp; <span class="number">0x010884422010</span>ULL) % <span class="number">1023</span>;</div></pre></td></tr></table></figure><p>乘法操作生成了五分相互独立的拷贝，每份8位，并合并成一个64位值。将该值分为每十位一组，与操作选出哪些位在组中正确的（倒置）位上。乘法和与运算从原数据拷贝到这里来，所以每个组中一定会有一个原数据。比特位的倒置位置与它们在组中的相对位置相同。最后，求得模<code>2^10 - 1</code>的余数，即能把每组中的选中的比特位聚合到一起。它们相互不会覆盖，所以求余操作的底层操作就像逻辑或操作一样。</p><p>该方法见于<a href="http://www.inwap.com/pdp10/hbaker/hakmem/hakmem.html" target="_blank" rel="external">Beeler, M., Gosper, R. W., and Schroeppel, R. HAKMEM. MIT AI Memo 239, Feb. 29, 1972.</a>的Programming Hacks部分。</p><h3 id="倒置一比特-仅用4次操作-使用64位的乘法-不使用除法">倒置一比特，仅用4次操作（使用64位的乘法，不使用除法）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">char</span> b; <span class="comment">// reverse this byte</span></div><div class="line"> </div><div class="line">b = ((b * <span class="number">0x80200802</span>ULL) &amp; <span class="number">0x0884422110</span>ULL) * <span class="number">0x0101010101</span>ULL &gt;&gt; <span class="number">32</span>;</div></pre></td></tr></table></figure><p>下面就是该方法的原理展示，使用<code>a</code>,<code>b</code>,<code>c</code>,<code>d</code>,<code>e</code>,<code>f</code>,<code>g</code>,<code>h</code>来表示该比特的各个位。注意第一次乘法是如何将这个数拷贝多份的。以及最后一次乘法是如何将这几个位合并到从右往左数第五个比特中去的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">                                                                                        abcd efgh (-&gt; hgfe dcba)</div><div class="line">*                                                      1000 0000  0010 0000  0000 1000  0000 0010 (0x80200802)</div><div class="line">-------------------------------------------------------------------------------------------------</div><div class="line">                                            0abc defg  h00a bcde  fgh0 0abc  defg h00a  bcde fgh0</div><div class="line">&amp;                                           0000 1000  1000 0100  0100 0010  0010 0001  0001 0000 (0x0884422110)</div><div class="line">-------------------------------------------------------------------------------------------------</div><div class="line">                                            0000 d000  h000 0c00  0g00 00b0  00f0 000a  000e 0000</div><div class="line">*                                           0000 0001  0000 0001  0000 0001  0000 0001  0000 0001 (0x0101010101)</div><div class="line">-------------------------------------------------------------------------------------------------</div><div class="line">                                            0000 d000  h000 0c00  0g00 00b0  00f0 000a  000e 0000</div><div class="line">                                 0000 d000  h000 0c00  0g00 00b0  00f0 000a  000e 0000</div><div class="line">                      0000 d000  h000 0c00  0g00 00b0  00f0 000a  000e 0000</div><div class="line">           0000 d000  h000 0c00  0g00 00b0  00f0 000a  000e 0000</div><div class="line">0000 d000  h000 0c00  0g00 00b0  00f0 000a  000e 0000</div><div class="line">-------------------------------------------------------------------------------------------------</div><div class="line">0000 d000  h000 dc00  hg00 dcb0  hgf0 dcba  hgfe dcba  hgfe 0cba  0gfe 00ba  00fe 000a  000e 0000</div><div class="line">&gt;&gt; 32</div><div class="line">-------------------------------------------------------------------------------------------------</div><div class="line">                                            0000 d000  h000 dc00  hg00 dcb0  hgf0 dcba  hgfe dcba</div><div class="line">&amp;                                                                                       1111 1111</div><div class="line">-------------------------------------------------------------------------------------------------</div><div class="line">                                                                                        hgfe dcba</div></pre></td></tr></table></figure><p>最后两步可以合并，因为某些处理器的寄存器可以按照字节来读写；只用乘法，然后寄存器存储高位的32位，再取低八位，这样就只要6次操作。</p><p>该方法于2001年7月13日由Sean Anderson创造而出。</p><h3 id="倒置一比特-仅用7次操作-不使用64位">倒置一比特，仅用7次操作（不使用64位）</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">b = ((b * <span class="number">0x0802</span>LU &amp; <span class="number">0x22110</span>LU) | (b * <span class="number">0x8020</span>LU &amp; <span class="number">0x88440</span>LU)) * <span class="number">0x10101</span>LU &gt;&gt; <span class="number">16</span>;</div></pre></td></tr></table></figure><p>注意要把结果赋值给或转换到<code>unsigned char</code>以去除不需要的垃圾位。</p><p>作者注：</p><ul><li>2001年7月13日，该方法由Sean Anderson创造而出。</li><li>2002年1月3日，Mike Keith指出并修正了拼写错误。</li></ul><h3 id="倒置n位-并行法-使用-5-lg-n-次操作">倒置N位，并行法，使用 5*lg(N) 次操作</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> v; <span class="comment">// 32-bit word to reverse bit order</span></div><div class="line"></div><div class="line"><span class="comment">// swap odd and even bits</span></div><div class="line">v = ((v &gt;&gt; <span class="number">1</span>) &amp; <span class="number">0x55555555</span>) | ((v &amp; <span class="number">0x55555555</span>) &lt;&lt; <span class="number">1</span>);</div><div class="line"><span class="comment">// swap consecutive pairs</span></div><div class="line">v = ((v &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x33333333</span>) | ((v &amp; <span class="number">0x33333333</span>) &lt;&lt; <span class="number">2</span>);</div><div class="line"><span class="comment">// swap nibbles ... </span></div><div class="line">v = ((v &gt;&gt; <span class="number">4</span>) &amp; <span class="number">0x0F0F0F0F</span>) | ((v &amp; <span class="number">0x0F0F0F0F</span>) &lt;&lt; <span class="number">4</span>);</div><div class="line"><span class="comment">// swap bytes</span></div><div class="line">v = ((v &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0x00FF00FF</span>) | ((v &amp; <span class="number">0x00FF00FF</span>) &lt;&lt; <span class="number">8</span>);</div><div class="line"><span class="comment">// swap 2-byte long pairs</span></div><div class="line">v = ( v &gt;&gt; <span class="number">16</span>             ) | ( v               &lt;&lt; <span class="number">16</span>);</div></pre></td></tr></table></figure><p>下面的变体依然是$O(\lg N)$的，不过它需要更多次操作来倒置<code>v</code>. 它好在即时计算常量来减少内存使用。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> s = <span class="keyword">sizeof</span>(v) * CHAR_BIT; <span class="comment">// bit位数，必须是2的次幂</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> mask = ~<span class="number">0</span>;</div><div class="line"><span class="keyword">while</span> ((s &gt;&gt;= <span class="number">1</span>) &gt; <span class="number">0</span>) </div><div class="line">&#123;</div><div class="line">  mask ^= (mask &lt;&lt; s);</div><div class="line">  v = ((v &gt;&gt; s) &amp; mask) | ((v &lt;&lt; s) &amp; ~mask);</div><div class="line">&#125;</div></pre></td></tr></table></figure><p>以上方法非常适合于N很大的情形。对于64位或以上的整数，还得按照套路加几行，否则只有低32位被倒置。</p><p>作者注：</p><ul><li>更多内容详见Dr. Dobb’s Journal 1983, Edwin Freed关于Binary Magic Numbers的文章。</li><li>2005年9月13日，Ken Raeburn推荐给我第二种变体。</li><li>2006年3月19日，Veldmeijer提出第一种方法的最后一行可以不使用与运算。</li></ul><h2 id="求余除法">求余除法</h2><h3 id="不使用除法-计算关于-1-s-的余数">不使用除法，计算关于 1&lt;&lt;s 的余数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> n;          <span class="comment">// 被除数</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> s;</div><div class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> d = <span class="number">1U</span> &lt;&lt; s; <span class="comment">// So d will be one of: 1, 2, 4, 8, 16, 32, ...</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> m;                <span class="comment">// m will be n % d</span></div><div class="line">m = n &amp; (d - <span class="number">1</span>);</div></pre></td></tr></table></figure><p>大部分程序员很早就知道这个技巧了，为了完整性我将其添加进来。</p><h3 id="不使用除法-计算关于-1-s-1-的余数">不使用除法，计算关于 (1&lt;&lt;s) - 1 的余数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> n;                      <span class="comment">// 被除数</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> s;                <span class="comment">// s &gt; 0</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> d = (<span class="number">1</span> &lt;&lt; s) - <span class="number">1</span>; <span class="comment">// so d is either 1, 3, 7, 15, 31, ...).</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> m;                      <span class="comment">// n % d goes here.</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> (m = n; n &gt; d; n = m)</div><div class="line">&#123;</div><div class="line">  <span class="keyword">for</span> (m = <span class="number">0</span>; n; n &gt;&gt;= s)</div><div class="line">  &#123;</div><div class="line">    m += n &amp; d;</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">// m值域为[0,d], 但m是余数所以m为d时赋值为0</span></div><div class="line">m = m == d ? <span class="number">0</span> : m;</div></pre></td></tr></table></figure><p>求关于 $2^N-1$ 的余数需要 $5 + (4 + 5 \lceil {N \over s} \rceil) \cdot \lceil \lg{N \over s} \rceil$ 次操作，其中<code>N</code>是被除数的位数。也就是说，时间复杂度为$O(\lg N)$.</p><p>作者注：</p><ul><li>该方法于2001年8月15日由Sean Anderson想出。</li><li>在2004年6月17日Sean A. Irvine指正之前，我错误地评论说可以在最末尾使用<code>m = ((m + 1) &amp; d) - 1;</code>.</li><li>2005年4月25日，Michael Miller指出代码中一处拼写错误。</li></ul><h3 id="不使用除法-并行计算关于-1-s-1-的余数">不使用除法，并行计算关于 (1&lt;&lt;s) - 1 的余数</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// The following is for a word size of 32 bits!</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> M[] = </div><div class="line">&#123;</div><div class="line">  <span class="number">0x00000000</span>, <span class="number">0x55555555</span>, <span class="number">0x33333333</span>, <span class="number">0xc71c71c7</span>,</div><div class="line">  <span class="number">0x0f0f0f0f</span>, <span class="number">0xc1f07c1f</span>, <span class="number">0x3f03f03f</span>, <span class="number">0xf01fc07f</span>, </div><div class="line">  <span class="number">0x00ff00ff</span>, <span class="number">0x07fc01ff</span>, <span class="number">0x3ff003ff</span>, <span class="number">0xffc007ff</span>,</div><div class="line">  <span class="number">0xff000fff</span>, <span class="number">0xfc001fff</span>, <span class="number">0xf0003fff</span>, <span class="number">0xc0007fff</span>,</div><div class="line">  <span class="number">0x0000ffff</span>, <span class="number">0x0001ffff</span>, <span class="number">0x0003ffff</span>, <span class="number">0x0007ffff</span>, </div><div class="line">  <span class="number">0x000fffff</span>, <span class="number">0x001fffff</span>, <span class="number">0x003fffff</span>, <span class="number">0x007fffff</span>,</div><div class="line">  <span class="number">0x00ffffff</span>, <span class="number">0x01ffffff</span>, <span class="number">0x03ffffff</span>, <span class="number">0x07ffffff</span>,</div><div class="line">  <span class="number">0x0fffffff</span>, <span class="number">0x1fffffff</span>, <span class="number">0x3fffffff</span>, <span class="number">0x7fffffff</span></div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> Q[][<span class="number">6</span>] = </div><div class="line">&#123;</div><div class="line">  &#123; <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>,  <span class="number">0</span>&#125;, &#123;<span class="number">16</span>,  <span class="number">8</span>,  <span class="number">4</span>,  <span class="number">2</span>,  <span class="number">1</span>,  <span class="number">1</span>&#125;, &#123;<span class="number">16</span>,  <span class="number">8</span>,  <span class="number">4</span>,  <span class="number">2</span>,  <span class="number">2</span>,  <span class="number">2</span>&#125;,</div><div class="line">  &#123;<span class="number">15</span>,  <span class="number">6</span>,  <span class="number">3</span>,  <span class="number">3</span>,  <span class="number">3</span>,  <span class="number">3</span>&#125;, &#123;<span class="number">16</span>,  <span class="number">8</span>,  <span class="number">4</span>,  <span class="number">4</span>,  <span class="number">4</span>,  <span class="number">4</span>&#125;, &#123;<span class="number">15</span>,  <span class="number">5</span>,  <span class="number">5</span>,  <span class="number">5</span>,  <span class="number">5</span>,  <span class="number">5</span>&#125;,</div><div class="line">  &#123;<span class="number">12</span>,  <span class="number">6</span>,  <span class="number">6</span>,  <span class="number">6</span> , <span class="number">6</span>,  <span class="number">6</span>&#125;, &#123;<span class="number">14</span>,  <span class="number">7</span>,  <span class="number">7</span>,  <span class="number">7</span>,  <span class="number">7</span>,  <span class="number">7</span>&#125;, &#123;<span class="number">16</span>,  <span class="number">8</span>,  <span class="number">8</span>,  <span class="number">8</span>,  <span class="number">8</span>,  <span class="number">8</span>&#125;,</div><div class="line">  &#123; <span class="number">9</span>,  <span class="number">9</span>,  <span class="number">9</span>,  <span class="number">9</span>,  <span class="number">9</span>,  <span class="number">9</span>&#125;, &#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;, &#123;<span class="number">11</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">11</span>, <span class="number">11</span>&#125;,</div><div class="line">  &#123;<span class="number">12</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">12</span>, <span class="number">12</span>&#125;, &#123;<span class="number">13</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">13</span>, <span class="number">13</span>&#125;, &#123;<span class="number">14</span>, <span class="number">14</span>, <span class="number">14</span>, <span class="number">14</span>, <span class="number">14</span>, <span class="number">14</span>&#125;,</div><div class="line">  &#123;<span class="number">15</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">15</span>, <span class="number">15</span>&#125;, &#123;<span class="number">16</span>, <span class="number">16</span>, <span class="number">16</span>, <span class="number">16</span>, <span class="number">16</span>, <span class="number">16</span>&#125;, &#123;<span class="number">17</span>, <span class="number">17</span>, <span class="number">17</span>, <span class="number">17</span>, <span class="number">17</span>, <span class="number">17</span>&#125;,</div><div class="line">  &#123;<span class="number">18</span>, <span class="number">18</span>, <span class="number">18</span>, <span class="number">18</span>, <span class="number">18</span>, <span class="number">18</span>&#125;, &#123;<span class="number">19</span>, <span class="number">19</span>, <span class="number">19</span>, <span class="number">19</span>, <span class="number">19</span>, <span class="number">19</span>&#125;, &#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;,</div><div class="line">  &#123;<span class="number">21</span>, <span class="number">21</span>, <span class="number">21</span>, <span class="number">21</span>, <span class="number">21</span>, <span class="number">21</span>&#125;, &#123;<span class="number">22</span>, <span class="number">22</span>, <span class="number">22</span>, <span class="number">22</span>, <span class="number">22</span>, <span class="number">22</span>&#125;, &#123;<span class="number">23</span>, <span class="number">23</span>, <span class="number">23</span>, <span class="number">23</span>, <span class="number">23</span>, <span class="number">23</span>&#125;,</div><div class="line">  &#123;<span class="number">24</span>, <span class="number">24</span>, <span class="number">24</span>, <span class="number">24</span>, <span class="number">24</span>, <span class="number">24</span>&#125;, &#123;<span class="number">25</span>, <span class="number">25</span>, <span class="number">25</span>, <span class="number">25</span>, <span class="number">25</span>, <span class="number">25</span>&#125;, &#123;<span class="number">26</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">26</span>, <span class="number">26</span>&#125;,</div><div class="line">  &#123;<span class="number">27</span>, <span class="number">27</span>, <span class="number">27</span>, <span class="number">27</span>, <span class="number">27</span>, <span class="number">27</span>&#125;, &#123;<span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>, <span class="number">28</span>&#125;, &#123;<span class="number">29</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">29</span>, <span class="number">29</span>&#125;,</div><div class="line">  &#123;<span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>, <span class="number">30</span>&#125;, &#123;<span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>, <span class="number">31</span>&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> R[][<span class="number">6</span>] = </div><div class="line">&#123;</div><div class="line">  &#123;<span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>, <span class="number">0x00000000</span>&#125;,</div><div class="line">  &#123;<span class="number">0x0000ffff</span>, <span class="number">0x000000ff</span>, <span class="number">0x0000000f</span>, <span class="number">0x00000003</span>, <span class="number">0x00000001</span>, <span class="number">0x00000001</span>&#125;,</div><div class="line">  &#123;<span class="number">0x0000ffff</span>, <span class="number">0x000000ff</span>, <span class="number">0x0000000f</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>, <span class="number">0x00000003</span>&#125;,</div><div class="line">  &#123;<span class="number">0x00007fff</span>, <span class="number">0x0000003f</span>, <span class="number">0x00000007</span>, <span class="number">0x00000007</span>, <span class="number">0x00000007</span>, <span class="number">0x00000007</span>&#125;,</div><div class="line">  &#123;<span class="number">0x0000ffff</span>, <span class="number">0x000000ff</span>, <span class="number">0x0000000f</span>, <span class="number">0x0000000f</span>, <span class="number">0x0000000f</span>, <span class="number">0x0000000f</span>&#125;,</div><div class="line">  &#123;<span class="number">0x00007fff</span>, <span class="number">0x0000001f</span>, <span class="number">0x0000001f</span>, <span class="number">0x0000001f</span>, <span class="number">0x0000001f</span>, <span class="number">0x0000001f</span>&#125;,</div><div class="line">  &#123;<span class="number">0x00000fff</span>, <span class="number">0x0000003f</span>, <span class="number">0x0000003f</span>, <span class="number">0x0000003f</span>, <span class="number">0x0000003f</span>, <span class="number">0x0000003f</span>&#125;,</div><div class="line">  &#123;<span class="number">0x00003fff</span>, <span class="number">0x0000007f</span>, <span class="number">0x0000007f</span>, <span class="number">0x0000007f</span>, <span class="number">0x0000007f</span>, <span class="number">0x0000007f</span>&#125;,</div><div class="line">  &#123;<span class="number">0x0000ffff</span>, <span class="number">0x000000ff</span>, <span class="number">0x000000ff</span>, <span class="number">0x000000ff</span>, <span class="number">0x000000ff</span>, <span class="number">0x000000ff</span>&#125;,</div><div class="line">  &#123;<span class="number">0x000001ff</span>, <span class="number">0x000001ff</span>, <span class="number">0x000001ff</span>, <span class="number">0x000001ff</span>, <span class="number">0x000001ff</span>, <span class="number">0x000001ff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x000003ff</span>, <span class="number">0x000003ff</span>, <span class="number">0x000003ff</span>, <span class="number">0x000003ff</span>, <span class="number">0x000003ff</span>, <span class="number">0x000003ff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x000007ff</span>, <span class="number">0x000007ff</span>, <span class="number">0x000007ff</span>, <span class="number">0x000007ff</span>, <span class="number">0x000007ff</span>, <span class="number">0x000007ff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x00000fff</span>, <span class="number">0x00000fff</span>, <span class="number">0x00000fff</span>, <span class="number">0x00000fff</span>, <span class="number">0x00000fff</span>, <span class="number">0x00000fff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x00001fff</span>, <span class="number">0x00001fff</span>, <span class="number">0x00001fff</span>, <span class="number">0x00001fff</span>, <span class="number">0x00001fff</span>, <span class="number">0x00001fff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x00003fff</span>, <span class="number">0x00003fff</span>, <span class="number">0x00003fff</span>, <span class="number">0x00003fff</span>, <span class="number">0x00003fff</span>, <span class="number">0x00003fff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x00007fff</span>, <span class="number">0x00007fff</span>, <span class="number">0x00007fff</span>, <span class="number">0x00007fff</span>, <span class="number">0x00007fff</span>, <span class="number">0x00007fff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x0000ffff</span>, <span class="number">0x0000ffff</span>, <span class="number">0x0000ffff</span>, <span class="number">0x0000ffff</span>, <span class="number">0x0000ffff</span>, <span class="number">0x0000ffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x0001ffff</span>, <span class="number">0x0001ffff</span>, <span class="number">0x0001ffff</span>, <span class="number">0x0001ffff</span>, <span class="number">0x0001ffff</span>, <span class="number">0x0001ffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x0003ffff</span>, <span class="number">0x0003ffff</span>, <span class="number">0x0003ffff</span>, <span class="number">0x0003ffff</span>, <span class="number">0x0003ffff</span>, <span class="number">0x0003ffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x0007ffff</span>, <span class="number">0x0007ffff</span>, <span class="number">0x0007ffff</span>, <span class="number">0x0007ffff</span>, <span class="number">0x0007ffff</span>, <span class="number">0x0007ffff</span>&#125;,</div><div class="line">  &#123;<span class="number">0x000fffff</span>, <span class="number">0x000fffff</span>, <span class="number">0x000fffff</span>, <span class="number">0x000fffff</span>, <span class="number">0x000fffff</span>, <span class="number">0x000fffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x001fffff</span>, <span class="number">0x001fffff</span>, <span class="number">0x001fffff</span>, <span class="number">0x001fffff</span>, <span class="number">0x001fffff</span>, <span class="number">0x001fffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x003fffff</span>, <span class="number">0x003fffff</span>, <span class="number">0x003fffff</span>, <span class="number">0x003fffff</span>, <span class="number">0x003fffff</span>, <span class="number">0x003fffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x007fffff</span>, <span class="number">0x007fffff</span>, <span class="number">0x007fffff</span>, <span class="number">0x007fffff</span>, <span class="number">0x007fffff</span>, <span class="number">0x007fffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x00ffffff</span>, <span class="number">0x00ffffff</span>, <span class="number">0x00ffffff</span>, <span class="number">0x00ffffff</span>, <span class="number">0x00ffffff</span>, <span class="number">0x00ffffff</span>&#125;,</div><div class="line">  &#123;<span class="number">0x01ffffff</span>, <span class="number">0x01ffffff</span>, <span class="number">0x01ffffff</span>, <span class="number">0x01ffffff</span>, <span class="number">0x01ffffff</span>, <span class="number">0x01ffffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x03ffffff</span>, <span class="number">0x03ffffff</span>, <span class="number">0x03ffffff</span>, <span class="number">0x03ffffff</span>, <span class="number">0x03ffffff</span>, <span class="number">0x03ffffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x07ffffff</span>, <span class="number">0x07ffffff</span>, <span class="number">0x07ffffff</span>, <span class="number">0x07ffffff</span>, <span class="number">0x07ffffff</span>, <span class="number">0x07ffffff</span>&#125;,</div><div class="line">  &#123;<span class="number">0x0fffffff</span>, <span class="number">0x0fffffff</span>, <span class="number">0x0fffffff</span>, <span class="number">0x0fffffff</span>, <span class="number">0x0fffffff</span>, <span class="number">0x0fffffff</span>&#125;,</div><div class="line">  &#123;<span class="number">0x1fffffff</span>, <span class="number">0x1fffffff</span>, <span class="number">0x1fffffff</span>, <span class="number">0x1fffffff</span>, <span class="number">0x1fffffff</span>, <span class="number">0x1fffffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x3fffffff</span>, <span class="number">0x3fffffff</span>, <span class="number">0x3fffffff</span>, <span class="number">0x3fffffff</span>, <span class="number">0x3fffffff</span>, <span class="number">0x3fffffff</span>&#125;, </div><div class="line">  &#123;<span class="number">0x7fffffff</span>, <span class="number">0x7fffffff</span>, <span class="number">0x7fffffff</span>, <span class="number">0x7fffffff</span>, <span class="number">0x7fffffff</span>, <span class="number">0x7fffffff</span>&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> n;       <span class="comment">// numerator</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> s; <span class="comment">// s &gt; 0</span></div><div class="line"><span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> d = (<span class="number">1</span> &lt;&lt; s) - <span class="number">1</span>; <span class="comment">// so d is either 1, 3, 7, 15, 31, ...).</span></div><div class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> m;       <span class="comment">// n % d goes here.</span></div><div class="line"></div><div class="line">m = (n &amp; M[s]) + ((n &gt;&gt; s) &amp; M[s]);</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">const</span> <span class="keyword">unsigned</span> <span class="keyword">int</span> * q = &amp;Q[s][<span class="number">0</span>], * r = &amp;R[s][<span class="number">0</span>]; m &gt; d; q++, r++)</div><div class="line">&#123;</div><div class="line">  m = (m &gt;&gt; *q) + (m &amp; *r);</div><div class="line">&#125;</div><div class="line">m = m == d ? <span class="number">0</span> : m; <span class="comment">// OR, less portably: m = m &amp; -((signed)(m - d) &gt;&gt; s);</span></div></pre></td></tr></table></figure><p>该方法求关于 $2^N-1$ 的余数至多需要 $O(\lg N)$ 时间，其中<code>N</code>是被除数位长（以上代码是针对32位的）。所需操作次数至多是 $12 + 9 \lceil \lg N \rceil$. 如果你能在编译器知道除数的话，就能去掉表，只需提取相关条目并做循环展开。该方法很容易能扩展到更长位宽。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;深坑待填！&lt;/strong&gt;&lt;/p&gt;&lt;p&gt;本文翻译自&lt;a href=&quot;https://graphics.stanford.edu/~seander/bithacks.html&quot;&gt;这篇文章&lt;/a&gt;，原作者Sean Eron Anderson. 如果有翻译错误的地方，欢迎指正。另外，由于年代久远，文中给出的链接可能已经失效。&lt;/p&gt;&lt;p&gt;UPDATE 2016/09/30: 继续翻译，并改进已翻译文本&lt;/p&gt;
    
    </summary>
    
      <category term="编程" scheme="https://unnamed42.github.io/categories/%E7%BC%96%E7%A8%8B/"/>
    
    
      <category term="算法" scheme="https://unnamed42.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
  </entry>
  
</feed>
